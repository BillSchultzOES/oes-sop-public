<!DOCTYPE html>
<html>

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>OES Standard Operating Procedures for The Design and Statistical Analysis of Experiments</title>
  <meta name="description" content="These are the current standard operating procedures for statistical analysis of the Office of Evaluation Sciences in the GSA">
  <meta name="generator" content="bookdown &lt;!--bookdown:version--&gt; and GitBook 2.6.7">

  <meta property="og:title" content="OES Standard Operating Procedures for The Design and Statistical Analysis of Experiments">
  <meta property="og:type" content="book">
  
  
  <meta property="og:description" content="These are the current standard operating procedures for statistical analysis of the Office of Evaluation Sciences in the GSA">
  <meta name="github-repo" content="gsa-oes/sop">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="OES Standard Operating Procedures for The Design and Statistical Analysis of Experiments">
  
  <meta name="twitter:description" content="These are the current standard operating procedures for statistical analysis of the Office of Evaluation Sciences in the GSA">
  

<meta name="author" content="Jake Bowers, Ryan T. Moore, Miles Williams, and Bill Schultz">


<meta name="date" content="2024-05-29">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="statistical-priorities.html">
<link rel="next" href="randomization-choices.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet">







<script src="libs/clipboard/clipboard.min.js"></script>
<link href="libs/primer-tooltips/build.css" rel="stylesheet">
<link href="libs/klippy/css/klippy.min.css" rel="stylesheet">
<script src="libs/klippy/js/klippy.min.js"></script>
<script src="libs/kePrint/kePrint.js"></script>
<link href="libs/lightable/lightable.css" rel="stylesheet">

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.cpp, pre.sql, pre.stan, pre.stata, pre.python, pre.bash');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}
</script>
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
.row { display: flex; }
.collapse { display: none; }
.in { display:block }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>
<script>
function unrolltab(evt, tabName) {
  var i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  document.getElementById(tabName).style.display = "block";
  evt.currentTarget.className += " active";
}
</script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-V94NLBS86Q"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag("js", new Date());

gtag("config", "G-V94NLBS86Q");
</script>
<script>gtag("event", "view_item");</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/katex.min.css" data-external="1"></head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The OES SOP</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#purposes-of-this-document"><i class="fa fa-check"></i>Purposes of this document</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#nature-and-limitations-of-this-document"><i class="fa fa-check"></i>Nature and limitations of this document</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#we-mostly-focus-on-randomized-field-experiments."><i class="fa fa-check"></i>We (mostly) focus on randomized field experiments.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#we-mostly-present-examples-using-r"><i class="fa fa-check"></i>We (mostly) present examples using R</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#structure-of-the-document"><i class="fa fa-check"></i>Structure of the document</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#help-us-improve-our-work"><i class="fa fa-check"></i>Help us improve our work!</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-document"><i class="fa fa-check"></i>About this document</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="using-tests-to-inform-policy.html"><a href="using-tests-to-inform-policy.html"><i class="fa fa-check"></i><b>1</b> Using Tests to Inform Policy</a></li>
<li class="chapter" data-level="2" data-path="statistical-priorities.html"><a href="statistical-priorities.html"><i class="fa fa-check"></i><b>2</b> Statistical priorities</a><ul>
<li class="chapter" data-level="2.1" data-path="statistical-priorities.html"><a href="statistical-priorities.html#statistical-power"><i class="fa fa-check"></i><b>2.1</b> Statistical Power</a></li>
<li class="chapter" data-level="2.2" data-path="statistical-priorities.html"><a href="statistical-priorities.html#controlled-error-rates"><i class="fa fa-check"></i><b>2.2</b> Controlled Error Rates</a></li>
<li class="chapter" data-level="2.3" data-path="statistical-priorities.html"><a href="statistical-priorities.html#unbiased-estimators"><i class="fa fa-check"></i><b>2.3</b> Unbiased Estimators</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="design-based-statistical-inference.html"><a href="design-based-statistical-inference.html"><i class="fa fa-check"></i><b>3</b> Design Based Statistical Inference</a><ul>
<li class="chapter" data-level="3.1" data-path="design-based-statistical-inference.html"><a href="design-based-statistical-inference.html#randinfex"><i class="fa fa-check"></i><b>3.1</b> An example using simulated data</a><ul>
<li class="chapter" data-level="3.1.1" data-path="design-based-statistical-inference.html"><a href="design-based-statistical-inference.html#how-do-we-calculate-randomization-based-standard-errors"><i class="fa fa-check"></i><b>3.1.1</b> How do we calculate randomization-based standard errors?</a></li>
<li class="chapter" data-level="3.1.2" data-path="design-based-statistical-inference.html"><a href="design-based-statistical-inference.html#how-do-we-calculate-randomization-based-confidence-intervals"><i class="fa fa-check"></i><b>3.1.2</b> How do we calculate randomization-based confidence intervals?</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="design-based-statistical-inference.html"><a href="design-based-statistical-inference.html#summary-what-does-a-design-based-approach-mean-for-policy-evaluation"><i class="fa fa-check"></i><b>3.2</b> Summary: What does a design based approach mean for policy evaluation?</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="randomization-choices.html"><a href="randomization-choices.html"><i class="fa fa-check"></i><b>4</b> Randomization Choices</a><ul>
<li class="chapter" data-level="4.1" data-path="randomization-choices.html"><a href="randomization-choices.html#coin-flipping-randomization-versus-urn-drawing-randomization"><i class="fa fa-check"></i><b>4.1</b> Coin flipping randomization versus urn-drawing randomization</a></li>
<li class="chapter" data-level="4.2" data-path="randomization-choices.html"><a href="randomization-choices.html#urn-drawing-or-complete-randomization-into-2-or-more-groups"><i class="fa fa-check"></i><b>4.2</b> Urn-drawing or complete randomization into 2 or more groups</a></li>
<li class="chapter" data-level="4.3" data-path="randomization-choices.html"><a href="randomization-choices.html#factorial-designs"><i class="fa fa-check"></i><b>4.3</b> Factorial Designs</a></li>
<li class="chapter" data-level="4.4" data-path="randomization-choices.html"><a href="randomization-choices.html#block-random-assignment"><i class="fa fa-check"></i><b>4.4</b> Block Random Assignment</a><ul>
<li class="chapter" data-level="4.4.1" data-path="randomization-choices.html"><a href="randomization-choices.html#the-benefits-of-blocking"><i class="fa fa-check"></i><b>4.4.1</b> The benefits of blocking</a></li>
<li class="chapter" data-level="4.4.2" data-path="randomization-choices.html"><a href="randomization-choices.html#using-only-a-few-covariates-to-create-blocks"><i class="fa fa-check"></i><b>4.4.2</b> Using only a few covariates to create blocks</a></li>
<li class="chapter" data-level="4.4.3" data-path="randomization-choices.html"><a href="randomization-choices.html#multivariate-blocking-using-many-covariates"><i class="fa fa-check"></i><b>4.4.3</b> Multivariate blocking using many covariates</a></li>
<li class="chapter" data-level="4.4.4" data-path="randomization-choices.html"><a href="randomization-choices.html#disadvantages-to-consider"><i class="fa fa-check"></i><b>4.4.4</b> Disadvantages to consider</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="randomization-choices.html"><a href="randomization-choices.html#cluster-random-assignment"><i class="fa fa-check"></i><b>4.5</b> Cluster random assignment</a></li>
<li class="chapter" data-level="4.6" data-path="randomization-choices.html"><a href="randomization-choices.html#other-designs"><i class="fa fa-check"></i><b>4.6</b> Other designs</a></li>
<li class="chapter" data-level="4.7" data-path="randomization-choices.html"><a href="randomization-choices.html#assessing-randomization-balance-testing"><i class="fa fa-check"></i><b>4.7</b> Assessing randomization (balance testing)</a><ul>
<li class="chapter" data-level="4.7.1" data-path="randomization-choices.html"><a href="randomization-choices.html#what-to-do-with-failed-randomization-assessments"><i class="fa fa-check"></i><b>4.7.1</b> What to do with &#x201C;failed&#x201D; randomization assessments?</a></li>
<li class="chapter" data-level="4.7.2" data-path="randomization-choices.html"><a href="randomization-choices.html#minimizing-the-chances-of-failed-randomization"><i class="fa fa-check"></i><b>4.7.2</b> Minimizing the chances of &#x201C;failed&#x201D; randomization</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="analysis-choices.html"><a href="analysis-choices.html"><i class="fa fa-check"></i><b>5</b> Analysis Choices</a><ul>
<li class="chapter" data-level="5.1" data-path="analysis-choices.html"><a href="analysis-choices.html#completely-or-urn-draw-randomized-trials"><i class="fa fa-check"></i><b>5.1</b> Completely or Urn-Draw Randomized Trials</a><ul>
<li class="chapter" data-level="5.1.1" data-path="analysis-choices.html"><a href="analysis-choices.html#two-arms"><i class="fa fa-check"></i><b>5.1.1</b> Two arms</a></li>
<li class="chapter" data-level="5.1.2" data-path="analysis-choices.html"><a href="analysis-choices.html#multiple-arms"><i class="fa fa-check"></i><b>5.1.2</b> Multiple arms</a></li>
<li class="chapter" data-level="5.1.3" data-path="analysis-choices.html"><a href="analysis-choices.html#multiple-outcomes"><i class="fa fa-check"></i><b>5.1.3</b> Multiple Outcomes</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="analysis-choices.html"><a href="analysis-choices.html#covariance-adjustment-the-use-of-background-information-to-increase-precision"><i class="fa fa-check"></i><b>5.2</b> Covariance adjustment (the use of background information to increase precision)</a><ul>
<li class="chapter" data-level="5.2.1" data-path="analysis-choices.html"><a href="analysis-choices.html#possible-bias-in-the-least-squares-ate-estimator-with-covariates"><i class="fa fa-check"></i><b>5.2.1</b> Possible bias in the least squares ATE estimator with covariates</a></li>
<li class="chapter" data-level="5.2.2" data-path="analysis-choices.html"><a href="analysis-choices.html#illustrating-the-lin-approach-to-covariance-adjustment"><i class="fa fa-check"></i><b>5.2.2</b> Illustrating the Lin Approach to Covariance Adjustment</a></li>
<li class="chapter" data-level="5.2.3" data-path="analysis-choices.html"><a href="analysis-choices.html#the-rosenbaum-approach-to-covariance-adjustment"><i class="fa fa-check"></i><b>5.2.3</b> The Rosenbaum Approach to Covariance Adjustment</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="analysis-choices.html"><a href="analysis-choices.html#how-to-choose-covariates-for-covariance-adjustment"><i class="fa fa-check"></i><b>5.3</b> How to choose covariates for covariance adjustment?</a></li>
<li class="chapter" data-level="5.4" data-path="analysis-choices.html"><a href="analysis-choices.html#blockrandanalysis"><i class="fa fa-check"></i><b>5.4</b> Block-randomized trials</a><ul>
<li class="chapter" data-level="5.4.1" data-path="analysis-choices.html"><a href="analysis-choices.html#testing-binary-outcomes-under-block-randomization-cochran-mantel-haenszel-cmh-test-for-k-x-2-x-2-tables"><i class="fa fa-check"></i><b>5.4.1</b> Testing binary outcomes under block randomization: Cochran-Mantel-Haenszel (CMH) test for K X 2 X 2 tables</a></li>
<li class="chapter" data-level="5.4.2" data-path="analysis-choices.html"><a href="analysis-choices.html#blockrandate"><i class="fa fa-check"></i><b>5.4.2</b> Estimating an overall average treatment effect</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="analysis-choices.html"><a href="analysis-choices.html#clusterrandanalysis"><i class="fa fa-check"></i><b>5.5</b> Cluster-randomized trials</a><ul>
<li class="chapter" data-level="5.5.1" data-path="analysis-choices.html"><a href="analysis-choices.html#bias-when-cluster-size-is-correlated-with-potential-outcomes"><i class="fa fa-check"></i><b>5.5.1</b> Bias when cluster size is correlated with potential outcomes</a></li>
<li class="chapter" data-level="5.5.2" data-path="analysis-choices.html"><a href="analysis-choices.html#incorrect-false-positive-rates-from-tests-and-confidence-intervals"><i class="fa fa-check"></i><b>5.5.2</b> Incorrect false positive rates from tests and confidence intervals</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="poweranalysis.html"><a href="poweranalysis.html"><i class="fa fa-check"></i><b>6</b> Power Analysis</a><ul>
<li class="chapter" data-level="6.1" data-path="poweranalysis.html"><a href="poweranalysis.html#an-example-of-the-off-the-shelf-approach"><i class="fa fa-check"></i><b>6.1</b> An example of the off-the-shelf approach</a></li>
<li class="chapter" data-level="6.2" data-path="poweranalysis.html"><a href="poweranalysis.html#an-example-of-the-simulation-approach"><i class="fa fa-check"></i><b>6.2</b> An example of the simulation approach</a></li>
<li class="chapter" data-level="6.3" data-path="poweranalysis.html"><a href="poweranalysis.html#when-to-use-which-approach"><i class="fa fa-check"></i><b>6.3</b> When to use which approach</a></li>
<li class="chapter" data-level="6.4" data-path="poweranalysis.html"><a href="poweranalysis.html#additional-examples-of-the-simulation-approach"><i class="fa fa-check"></i><b>6.4</b> Additional examples of the simulation approach</a><ul>
<li class="chapter" data-level="6.4.1" data-path="poweranalysis.html"><a href="poweranalysis.html#a-two-by-two-design-with-interaction"><i class="fa fa-check"></i><b>6.4.1</b> A two-by-two design with interaction</a></li>
<li class="chapter" data-level="6.4.2" data-path="poweranalysis.html"><a href="poweranalysis.html#covariate-adjustment-with-the-lin-estimator"><i class="fa fa-check"></i><b>6.4.2</b> Covariate adjustment with the Lin estimator</a></li>
<li class="chapter" data-level="6.4.3" data-path="poweranalysis.html"><a href="poweranalysis.html#incorporating-declaredesign-into-oes-power-tools"><i class="fa fa-check"></i><b>6.4.3</b> Incorporating DeclareDesign into OES Power Tools</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="glossary-of-terms.html"><a href="glossary-of-terms.html"><i class="fa fa-check"></i><b>7</b> <span>Glossary of Terms</span></a></li>
<li class="chapter" data-level="8" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>8</b> <span>Appendix</span></a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://oes.gsa.gov" target="blank">Published by the OES</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">OES Standard Operating Procedures for The Design and Statistical Analysis of Experiments</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="design-based-statistical-inference" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Design Based Statistical Inference</h1>
<p>Most policy evaluations using administrative data or surveys report the results of their studies using <strong>estimators</strong> and <strong>hypothesis tests</strong>. We briefly define each for clarity.</p>
<ul>
<li><p><em>Estimators</em>: Although we can never know the true causal effect of a new policy on our beneficiaries (see Chapter 1), we can provide a best guess. E.g.: &#x201C;The average amount saved for retirement by people in the treatment group was $1000 more than the average amount in the control group: our estimate of the average treatment effect is $1000.&#x201D;</p></li>
<li><p><em>Hypothesis tests</em>: We can also test the plausibility of a particular hunch or hypothesis. Commonly, these tests focus on plausibility of the null hypothesis of no effect. E.g.: &#x201C;We can reject the null hypothesis of no effect at a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">5\%</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">5%</span></span></span></span> significance level given an estimated p-value of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">2\%</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">2%</span></span></span></span>.&#x201D; Confidence intervals can be used to summarize hypothesis tests, so we think of them as tests rather than estimators.</p></li>
</ul>
<p>When we are asked <em>why</em> we used some method for calculating an
average treatment effect, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>-value, or confidence interval, we often say that our statistical analysis choices are based on the <em>design</em> of our
studies. When applied to randomized experiments, this principle can be written
simply as: &#x201C;analyze as you randomize.&#x201D; We provide an example of this
principle in practice below.</p>
<p>This idea, often known as randomization based or <strong>design based inference</strong>, was proposed by two of the founders of modern statistics. Jerzy Neyman&#x2019;s 1923 paper showed how to use randomization to learn about what we would currently call &#x201C;average treatment effects&#x201D; <span class="citation">(Neyman <a href="#ref-neyman_application_1923">1923</a>)</span>, and Ronald A. Fisher&#x2019;s 1935 book showed how to use randomization to test hypotheses about what we would currently call &#x201C;treatment effects&#x201D; <span class="citation">(Fisher <a href="#ref-fisher_design_1935">1935</a>)</span>. We favor design based justifications in many situations because we know exactly how a study was designed&#x2014;after all, we and our agency collaborators chose the sample size, experimental arms, and outcome data.</p>
<p>Of course, there are other ways to justify statistical procedures, and we don&#x2019;t exclude any reasonable approach in our work. In particular, an approach based on the idea of sampling from a larger (possibly infinite) population is standard in many applied research fields. This approach relies on theoretical models of an estimator&#x2019;s behavior&#x2014;i.e., &#x201C;asymptotic theory&#x201D;&#x2014;as sample size increases indefinitely. We sometimes rely on statistical methods developed under this justification as well. And keep in mind that some common procedures, like the calculation of HC2 standard errors below, can be justified under either design based or sampling based statistical inference.</p>
<div id="randinfex" class="section level2">
<h2><span class="header-section-number">3.1</span> An example using simulated data</h2>
<p>Imagine we have a simple randomized experiment where the relationship between
outcomes and treatment is shown in Figure <a href="design-based-statistical-inference.html#fig:boxplot1">3.1</a> (we illustrate the first 6 rows in the table below). Notice that, in this simulated experiment, the treatment changes the variability of the outcome in the treated group &#x2014; this is a common pattern when the control group is a status quo policy.</p>
<!-- Adds copy code button -->
<script>
  addClassKlippyToPreCode();
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<!-- Used (and iteratively updated) in the {oes_code_tab} snippets below. -->
<!-- set chapter number and reset count -->
<div class="tab">
<button class="tablinks" onclick="unrolltab(event, &apos;ch3R1&apos;)">
R code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Stata1&apos;)">
Stata code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Hide1&apos;)">
Hide
</button>
<div id="ch3R1" class="tabcontent">
<p><br></p>
<pre class="text"><code>## Read in data for the fake experiment.
dat1 &lt;- read.csv(&quot;dat1.csv&quot;)

## Table of the first few observations.
knitr::kable(head(dat1[, c(1, 23:27)]))</code></pre>
</div>
<div id="ch3Stata1" class="tabcontent">
<p><br></p>
<pre class="text"><code>** Read in data for the fake experiment.
import delimited using &quot;dat1.csv&quot;, clear
rename v1 x

** Table of the first few observations.
list x y0 y1 z y id in 1/6, sep(6)</code></pre>
</div>
<div id="ch3Hide1" class="tabcontent">

</div>
</div>
<table>
<thead>
<tr>
<th style="text-align:right;">
X
</th>
<th style="text-align:right;">
y0
</th>
<th style="text-align:right;">
y1
</th>
<th style="text-align:right;">
Z
</th>
<th style="text-align:right;">
Y
</th>
<th style="text-align:right;">
id
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
6.123
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
2.741
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
7.215
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2.056
</td>
<td style="text-align:right;">
6.708
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2.056
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
5.654
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5.654
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
10.409
</td>
<td style="text-align:right;">
15.561
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10.409
</td>
<td style="text-align:right;">
6
</td>
</tr>
</tbody>
</table>
<div class="tab">
<button class="tablinks" onclick="unrolltab(event, &apos;ch3R2&apos;)">
R code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Stata2&apos;)">
Stata code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Hide2&apos;)">
Hide
</button>
<div id="ch3R2" class="tabcontent">
<p><br></p>
<pre class="text"><code>## y0 and y1 are the true underlying potential outcomes.
with(dat1, {boxplot(list(y0,y1), names=c(&quot;Control&quot;,&quot;Treatment&quot;), ylab=&quot;Outcomes&quot;)
stripchart(list(y0,y1), add=TRUE, vertical=TRUE)
stripchart(list(mean(y0), mean(y1)), add=TRUE, vertical=TRUE, pch=19, cex=2)})</code></pre>
</div>
<div id="ch3Stata2" class="tabcontent">
<p><br></p>
<pre class="text"><code>** y0 and y1 are the true underlying potential outcomes.
label var y0 &quot;Control&quot;
label var y1 &quot;Treatment&quot;
* ssc install stripplot
stripplot y0 y1, box vertical iqr whiskers(recast(rcap)) ytitle(&quot;Outcomes&quot;) variablelabels</code></pre>
</div>
<div id="ch3Hide2" class="tabcontent">

</div>
</div>
<div class="figure"><span id="fig:boxplot1"></span>
<img src="OES_SOP_files/figure-html/boxplot1-1.png" alt="Simulated Experimental Outcomes" width=".9\textwidth">
<p class="caption">
Figure 3.1: Simulated Experimental Outcomes
</p>
</div>
<p>In this simulated data, we know the true average treatment effect (ATE) because we know both of the underlying true potential outcomes. The control potential outcome, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>i</mi><mi mathvariant="normal">&#x2223;</mi><msub><mi>Z</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow></msub></mrow><annotation encoding="application/x-tex">y_{i|Z_i=0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7858em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mtight">&#x2223;</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span></span></span></span>, is written in the code as <code>y0</code>, meaning &#x201C;the response person <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> would provide if he/she were in the status quo or control group&#x201D;. The treatment potential outcome, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>i</mi><mi mathvariant="normal">&#x2223;</mi><msub><mi>Z</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">y_{i|Z_i = 1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7858em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mtight">&#x2223;</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span></span></span></span>, is written in the code as <code>y1</code>, meaing &#x201C;the response person <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> would provide if he/she were in the new policy or treatment group.&#x201D; We use <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">Z_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> to refer to the experimental arm. In this case <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">Z_i=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> for people in the status quo group and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">Z_i=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> for people in the new policy group.</p>
<div class="tab">
<button class="tablinks" onclick="unrolltab(event, &apos;ch3R3&apos;)">
R code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Stata3&apos;)">
Stata code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Hide3&apos;)">
Hide
</button>
<div id="ch3R3" class="tabcontent">
<p><br></p>
<pre class="text"><code>trueATE &lt;- with(dat1, mean(y1) - mean(y0))
trueATE</code></pre>
</div>
<div id="ch3Stata3" class="tabcontent">
<p><br></p>
<pre class="text"><code>qui tabstat y0 y1, stat(mean) save
global trueATE = r(StatTotal)[1,2] - r(StatTotal)[1,1]</code></pre>
</div>
<div id="ch3Hide3" class="tabcontent">

</div>
</div>
<pre><code>[1] 5.453</code></pre>
<p>At this point, we have one <em>realized</em> experiment (defined by randomly assigning half of the people to treatment and half to control). We know that the observed difference of means of the outcome, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>, between treated and control groups is an unbiased estimator of the true ATE (by virtue of random assignment to treatment).<a href="references.html#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> We can calculate this in a few ways: we can just calculate the difference of means, or we can take advantage of the fact that an ordinary least squares linear regression produces the same estimate when the explanatory variable is a binary treatment indicator.</p>
<div class="tab">
<button class="tablinks" onclick="unrolltab(event, &apos;ch3R4&apos;)">
R code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Stata4&apos;)">
Stata code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Hide4&apos;)">
Hide
</button>
<div id="ch3R4" class="tabcontent">
<p><br></p>
<pre class="text"><code>estATE1 &lt;- with(dat1, mean(Y[Z==1]) - mean(Y[Z==0]))
estATE2 &lt;- lm(Y~Z, data=dat1)$coef[[&quot;Z&quot;]]
c(estimatedATEv1=estATE1, estimatedATEv2=estATE2)
stopifnot(all.equal(estATE1, estATE2))</code></pre>
</div>
<div id="ch3Stata4" class="tabcontent">
<p><br></p>
<pre class="text"><code>qui ttest y, by(z)
global estATE1 = round(r(mu_2) - r(mu_1), 0.001)
qui reg y z
global estATE2 = round(r(table)[1,1], 0.001)
di &quot;estimatedATEv1=$estATE1 estimatedATEv2=$estATE2&quot;
assert $estATE1 == $estATE2</code></pre>
</div>
<div id="ch3Hide4" class="tabcontent">

</div>
</div>
<pre><code>estimatedATEv1 estimatedATEv2 
         4.637          4.637 </code></pre>
<div id="how-do-we-calculate-randomization-based-standard-errors" class="section level3">
<h3><span class="header-section-number">3.1.1</span> How do we calculate randomization-based standard errors?</h3>
<p>How much would these estimates of the average treatment effect vary due to &#x201C;random noise&#x201D; if we repeated an experiment on the same group of people multiple times (randomly re-assigning treatment each time)? The <strong>standard error</strong> of an estimate of the average treatment effect is one answer to this question. As the expected variation due to random noise gets larger relative to the size of our treatment effect estimate, we should become increasingly cautious about the risk that our finding is actually an artifact of random noise.<a href="references.html#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></p>
<p>Below, we simulate a simple, individual-level experiment to help provide more intuition about what the standard error captures. We randomly re-assign treatment many times, save the resulting treatment effect estimates from each re-randomization, and calculate the standard deviation across them. This provides information about how far we should expect any one re-randomized treatment effect estimate to be from their mean.</p>
<div class="tab">
<button class="tablinks" onclick="unrolltab(event, &apos;ch3R5&apos;)">
R code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Stata5&apos;)">
Stata code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Hide5&apos;)">
Hide
</button>
<div id="ch3R5" class="tabcontent">
<p><br></p>
<pre class="text"><code>## A function to re-assign treatment and recalculate the difference of means.
## Treatment was assigned without blocking or other structure, so we
## just permute or shuffle the existing treatment assignment vector.
simEstAte &lt;- function(Z,y1,y0){
    Znew &lt;- sample(Z)
    Y &lt;- Znew * y1 + (1-Znew) * y0
    estate &lt;- mean(Y[Znew == 1]) - mean(Y[Znew == 0])
    return(estate)
}

## Set up and perform the simulation
sims &lt;- 10000
set.seed(12345)
simpleResults &lt;- with(dat1,replicate(sims,simEstAte(Z = Z,y1 = y1,y0 = y0)))
seEstATEsim &lt;- sd(simpleResults)

## The standard error of this estimate of the ATE (via simulation)
seEstATEsim</code></pre>
</div>
<div id="ch3Stata5" class="tabcontent">
<p><br></p>
<pre class="text"><code>** A program to re-assign treatment and recalculate the difference of means.
** Treatment was assigned without blocking or other structure, so we
** just permute or shuffle the existing treatment assignment vector.
capture program drop simEstAte
program define simEstAte, rclass sortpreserve

    version 18.0
    syntax varlist(min=1 max=1), ///
      control_outcome(varname) treat_outcome(varname)
    
    qui sum `varlist&apos; // Get # treated units
    local numtreat = r(sum)
    
    tempvar rand // Randomly sort (temporary var)
    qui gen `rand&apos; = runiform()
    sort `rand&apos;
    
    tempvar Znew // New treatment
    qui gen `Znew&apos; = 0
    qui replace `Znew&apos; = 1 in 1/`numtreat&apos;
    
    tempvar Ynew // New revealed outcome
    qui gen `Ynew&apos; = (`Znew&apos; * `treat_outcome&apos;) + ((1 - `Znew&apos;) * `control_outcome&apos;)
    
    qui ttest `Ynew&apos;, by(`Znew&apos;)
    return scalar estate = r(mu_2) - r(mu_1)
    
end

** Set up and perform the simulation
global sims 10000
set seed 12345
preserve
    qui simulate estate = r(estate), reps($sims): simEstAte z, control_outcome(y0) treat_outcome(y1)
    qui sum estate
    global seEstATEsim = r(sd)
restore

** The standard error of this estimate of the ATE (via simulation)
di &quot;$seEstATEsim&quot;</code></pre>
</div>
<div id="ch3Hide5" class="tabcontent">

</div>
</div>
<pre><code>[1] 0.9256</code></pre>
<p>While this is useful for illustration, we do not need to rely on simulation to develop a design-based standard error estimator. <span class="citation">Gerber and Green (<a href="#ref-gerber_field_2012">2012</a>)</span> and <span class="citation">Dunning (<a href="#ref-dunning_natural_2012">2012</a>)</span> walk through the following expression for a &#x201C;feasible&#x201D; (see below) design based standard error of a simple average treatment effect estimator (e.g., a difference in means based on randomly assigned treatment). If we write <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> as the set of all <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> treated units and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span> as the set of all <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>&#x2212;</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">n-m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> non-treated units, we then have:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mrow><mi mathvariant="normal">V</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi></mrow><mo stretchy="true">^</mo></mover><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><msup><mi>s</mi><mn>2</mn></msup><mo stretchy="false">(</mo><msub><mi>Y</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>i</mi><mo>&#x2208;</mo><mi>T</mi></mrow></msub><mo stretchy="false">)</mo></mrow><mi>m</mi></mfrac><mo>+</mo><mfrac><mrow><msup><mi>s</mi><mn>2</mn></msup><mo stretchy="false">(</mo><msub><mi>Y</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>i</mi><mo>&#x2208;</mo><mi>C</mi></mrow></msub><mo stretchy="false">)</mo></mrow><mrow><mo stretchy="false">(</mo><mi>n</mi><mo>&#x2212;</mo><mi>m</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">\widehat{\mathrm{Var}}(T) = \frac{s^2(Y_{i,i \in T})}{m} + \frac{s^2(Y_{i,i \in C})}{(n-m)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1733em;vertical-align:-0.25em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9233em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathrm">Var</span></span></span><span class="svg-align" style="top:-3.6833em;"><span class="pstrut" style="height:3em;"></span><span style="height:0.24em;"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="0.24em" viewbox="0 0 1062 239" preserveaspectratio="none"><path d="M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z"/></svg></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1771em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">m</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span><span class="mrel mtight">&#x2208;</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.4271em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">m</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span><span class="mrel mtight">&#x2208;</span><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>s</mi><mn>2</mn></msup><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">s^2(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> is the sample variance such that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>s</mi><mn>2</mn></msup><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mn>1</mn><mi mathvariant="normal">/</mi><mo stretchy="false">(</mo><mi>n</mi><mo>&#x2212;</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo><msubsup><mo>&#x2211;</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>&#x2212;</mo><mover accent="true"><mi>x</mi><mo>&#x2C9;</mo></mover><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">s^2(x) = (1/(n-1))\sum^n_{i = 1}(x_i-\bar{x})^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1/</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.104em;vertical-align:-0.2997em;"></span><span class="mord">1</span><span class="mclose">))</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">&#x2211;</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">&#x2C9;</span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>Since this expression is something we can calculate with a real sample, it&#x2019;s called a <strong>feasible standard error</strong>. In contrast, we cannot calculate the <em>true</em> design based standard error with a real sample, since it depends on knowing the covariance between each unit&#x2019;s potential outcomes (which is unobservable in real data). However, we can calculate this for our example, since we generated these data ourselves. Though we don&#x2019;t write it out here, you can see an expression for the true standard error in our code.</p>
<p>The feasible SE is designed to be <em>at least as large</em> as the true standard error on average; i.e., it is intentionally conservative. To illustrate these different calculation methods, we can compare the results of the simulation above to the feasible standard error. We can also compare both to the true standard error.</p>
<p>We already have the simulated SE from the code above. Next, let&#x2019;s calculate the true SE.</p>
<div class="tab">
<button class="tablinks" onclick="unrolltab(event, &apos;ch3R6&apos;)">
R code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Stata6&apos;)">
Stata code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Hide6&apos;)">
Hide
</button>
<div id="ch3R6" class="tabcontent">
<p><br></p>
<pre class="text"><code>## True SE (Dunning Chap 6, Gerber and Green Chap 3, or Freedman, Pisani and Purves A-32).
## Requires knowing the true covariance between potential outcomes.
N &lt;- nrow(dat1)
V &lt;- var(cbind(dat1$y0,dat1$y1))
varc &lt;- V[1,1]
vart &lt;- V[2,2]
covtc &lt;- V[1,2]
nt &lt;- sum(dat1$Z)
nc &lt;- N-nt

## Gerber and Green, p.57, equation (3.4)
varestATE &lt;- (((varc * nt) / nc) + ((vart * nc) / nt) + (2 * covtc)) / (N - 1)
seEstATETrue &lt;- sqrt(varestATE)</code></pre>
</div>
<div id="ch3Stata6" class="tabcontent">
<p><br></p>
<pre class="text"><code>** True SE (Dunning Chap 6, Gerber and Green Chap 3, or Freedman, Pisani and Purves A-32).
** Requires knowing the true covariance between potential outcomes.
qui count
local N = r(N)
qui cor y0 y1, cov
local varc = r(C)[1,1]
local vart = r(C)[2,2]
local covtc = r(C)[1,2]
qui sum z
local nt = r(sum)
local nc = `N&apos; - `nt&apos;

** Gerber and Green, p.57, equation (3.4)
local varestATE = (((`varc&apos; * `nt&apos;) / `nc&apos;) + ((`vart&apos; * `nc&apos;) / `nt&apos;) + (2 * `covtc&apos;)) / (`N&apos; - 1)
global seEstATETrue = sqrt(`varestATE&apos;)</code></pre>
</div>
<div id="ch3Hide6" class="tabcontent">

</div>
</div>
<p>Then, let&#x2019;s calculate the feasible standard error.</p>
<div class="tab">
<button class="tablinks" onclick="unrolltab(event, &apos;ch3R7&apos;)">
R code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Stata7&apos;)">
Stata code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Hide7&apos;)">
Hide
</button>
<div id="ch3R7" class="tabcontent">
<p><br></p>
<pre class="text"><code>## Feasible SE
varYc &lt;- with(dat1,var(Y[Z == 0]))
varYt &lt;- with(dat1,var(Y[Z == 1]))
fvarestATE &lt;- (N/(N-1)) * ( (varYt/nt) + (varYc/nc) )
estSEEstATE &lt;- sqrt(fvarestATE)</code></pre>
</div>
<div id="ch3Stata7" class="tabcontent">
<p><br></p>
<pre class="text"><code>** Feasible SE
qui sum y if z == 0
local varYc = r(sd) * r(sd)
qui sum y if z == 1
local varYt = r(sd) * r(sd)
local fvarestATE = (`N&apos;/(`N&apos;-1)) * ( (`varYt&apos;/`nt&apos;) + (`varYc&apos;/`nc&apos;) )
global estSEEstATE = sqrt(`fvarestATE&apos;)</code></pre>
</div>
<div id="ch3Hide7" class="tabcontent">

</div>
</div>
<p>Importantly, the feasible SE <em>is not</em> the standard error OLS regression provides by default. Among other things, default OLS SES are calculated under an <em>iid</em> errors assumption (&#x201C;identically and independently distributed&#x201D;). The feasible SE relaxes the &#x201C;identically&#x201D; part. Let&#x2019;s record the OLS SE as well.</p>
<div class="tab">
<button class="tablinks" onclick="unrolltab(event, &apos;ch3R8&apos;)">
R code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Stata8&apos;)">
Stata code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Hide8&apos;)">
Hide
</button>
<div id="ch3R8" class="tabcontent">
<p><br></p>
<pre class="text"><code>## OLS SE
lm1 &lt;- lm(Y~Z, data=dat1)
iidSE &lt;-  sqrt(diag(vcov(lm1)))[[&quot;Z&quot;]]</code></pre>
</div>
<div id="ch3Stata8" class="tabcontent">
<p><br></p>
<pre class="text"><code>** OLS SE
qui reg y z
global iidSE = _se[z] // Or: sqrt(e(V)[&quot;z&quot;,&quot;z&quot;])</code></pre>
</div>
<div id="ch3Hide8" class="tabcontent">

</div>
</div>
<p>Finally, we&#x2019;ll calculate one more alternative called the <em>HC2 standard error</em>, which <span class="citation">(Lin <a href="#ref-lin_agnostic_2013">2013</a>)</span> shows to be a design based SE for OLS regression (i.e., an alternative to the feasible SE that can be calcuated for treatment effects estimated using OLS). Like the feasible SE, HC2 errors should be conservative relative to the true SE.</p>
<p>Note that under sampling based inference, this SE estimator can instead be justified as a way of relaxing the assumption of &#x201C;identically&#x201D; distributed errors across. In other words, it is robust to a problem called &#x201C;heteroscedasticity,&#x201D; or &#x201C;heteroscedasticity-consistent,&#x201D; hence the HC in its name.</p>
<div class="tab">
<button class="tablinks" onclick="unrolltab(event, &apos;ch3R9&apos;)">
R code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Stata9&apos;)">
Stata code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Hide9&apos;)">
Hide
</button>
<div id="ch3R9" class="tabcontent">
<p><br></p>
<pre class="text"><code>## HC2
HC2SE &lt;- sqrt(diag(vcovHC(lm1, type = &quot;HC2&quot;)))[[&quot;Z&quot;]]</code></pre>
</div>
<div id="ch3Stata9" class="tabcontent">
<p><br></p>
<pre class="text"><code>** HC2
qui reg y z, vce(hc2)
global HC2SE = _se[z] // Or: sqrt(e(V)[&quot;z&quot;,&quot;z&quot;])</code></pre>
</div>
<div id="ch3Hide9" class="tabcontent">

</div>
</div>
<p>All those SE estimates in hand, let&#x2019;s review differences between the true standard error, the feasible standard error, the HC2 (Neyman) standard error, the standard error arising from direct repetition of the experiment, and the OLS standard error.</p>
<p>The HC2 OLS SE is intended to be conservative relative to the true SE (at least as large or larger on average). We show this to be the case in our example. HC2 is similar to the feasible SE outlined above, and both are larger than the true SE. We also illustrate the accuracy of our SE simulation as a way of thinking more intuitively about what the standard error represents. Lastly, recall that our design involves different outcome variances for the treated group and the control group. We would therefore expect what we are calling the OLS SE to be inaccurate (different variances across treatment groups means that errors are not &#x201C;identically&#x201D; distributed). However, the fact that it is inaccurate on average does not necessarily guarantee that it will be overly conservative or liberal in all cases.</p>
<div class="tab">
<button class="tablinks" onclick="unrolltab(event, &apos;ch3R10&apos;)">
R code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Stata10&apos;)">
Stata code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Hide10&apos;)">
Hide
</button>
<div id="ch3R10" class="tabcontent">
<p><br></p>
<pre class="text"><code>compareSEs &lt;- c(simSE = seEstATEsim,
  feasibleSE = estSEEstATE,
  trueSE = seEstATETrue,
  olsIIDSE = iidSE,
  HC2SE = HC2SE)
sort(compareSEs)</code></pre>
</div>
<div id="ch3Stata10" class="tabcontent">
<p><br></p>
<pre class="text"><code>matrix compareSEs = J(1, 5, .)
matrix compareSEs[1, 1] = $seEstATEsim
matrix compareSEs[1, 2] = $estSEEstATE
matrix compareSEs[1, 3] = $seEstATETrue
matrix compareSEs[1, 4] = $iidSE
matrix compareSEs[1, 5] = $HC2SE
matrix colnames compareSEs = &quot;simSE&quot; &quot;feasibleSE&quot; &quot;trueSE&quot; &quot;olsIIDSE&quot; &quot;HC2SE&quot;
matrix list compareSEs</code></pre>
</div>
<div id="ch3Hide10" class="tabcontent">

</div>
</div>
<pre><code>  olsIIDSE     trueSE      simSE      HC2SE feasibleSE 
    0.8930     0.9189     0.9256     1.0387     1.0439 </code></pre>
<p>To provide a more reliable comparison of these SE estimation methods, the first code chunk below defines a function to calculate an average treatment effect, the OLS iid SE, and the OLS HC2 SE. The second code chunk below uses this function to calculate several of those SEs for 10000 simulated datasets, averaging across them to provide a better illustration of their relative performance. As expected, the OLS iid SE <em>underestimates</em> the true SE, while the HC2 SE is conservative. The risk of underestimating the SE is that it could lead us to be overconfident when interpreting statistical findings.</p>
<div class="tab">
<button class="tablinks" onclick="unrolltab(event, &apos;ch3R11&apos;)">
R code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Stata11&apos;)">
Stata code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Hide11&apos;)">
Hide
</button>
<div id="ch3R11" class="tabcontent">
<p><br></p>
<pre class="text"><code>## Define a function to calculate several SEs, given potential outcomes and treatment
sePerfFn &lt;- function(Z,y1,y0){
    Znew &lt;- sample(Z)
    Ynew &lt;- Znew * y1 + (1-Znew) * y0
    lm1 &lt;- lm(Ynew~Znew)
    iidSE &lt;-  sqrt(diag(vcov(lm1)))[[&quot;Znew&quot;]]
    NeymanSE &lt;- sqrt(diag(vcovHC(lm1,type = &quot;HC2&quot;)))[[&quot;Znew&quot;]]
    return(c(estATE=coef(lm1)[[&quot;Znew&quot;]],
         estSEiid=iidSE,
         estSENeyman=NeymanSE))
}

## Perform a simulation using this function
set.seed(12345)
sePerformance &lt;- with(dat1, replicate(sims, sePerfFn(Z = Z, y1 = y1, y0 = y0)))
ExpectedSEs &lt;- apply(sePerformance[c(&quot;estSEiid&quot;, &quot;estSENeyman&quot;),], 1, mean)
c(ExpectedSEs, trueSE=seEstATETrue, simSE=sd(sePerformance[&quot;estATE&quot;,]))</code></pre>
</div>
<div id="ch3Stata11" class="tabcontent">
<p><br></p>
<pre class="text"><code>** Define a function to calculate several SEs, given potential outcomes and treatment
capture program drop sePerfFn
program define sePerfFn, rclass sortpreserve

    version 18.0
    syntax varlist(min=1 max=1), control_outcome(varname) treat_outcome(varname)
    
    qui sum `varlist&apos; // As in the program above
    local numtreat = r(sum)
    tempvar rand
    qui gen `rand&apos; = runiform()
    sort `rand&apos;
    tempvar Znew
    qui gen `Znew&apos; = 0
    qui replace `Znew&apos; = 1 in 1/`numtreat&apos;
    tempvar Ynew
    qui gen `Ynew&apos; = (`Znew&apos; * `treat_outcome&apos;) + ((1 - `Znew&apos;) * `control_outcome&apos;)
    
    qui reg `Ynew&apos; `Znew&apos; // Regression now instead of ttest
    local iidSE = _se[`Znew&apos;]
    qui reg `Ynew&apos; `Znew&apos;, vce(hc2)
    local NeymanSE = _se[`Znew&apos;]
    
    return scalar iidSE = `iidSE&apos; // Prepare output
    return scalar NeymanSE = `NeymanSE&apos;
    return scalar estATE = _b[`Znew&apos;]

end

** Perform a simulation using this function
set seed 12345

preserve
    qui simulate ///
    iidSE = r(iidSE) NeymanSE = r(NeymanSE) estATE = r(estATE), ///
    reps($sims): ///
    sePerfFn z, control_outcome(y0) treat_outcome(y1)
    qui sum estATE
    global simSE = r(sd)
    qui sum iidSE
    global estSEiid = r(mean)
    qui sum NeymanSE
    global estSENeyman = r(mean)
restore

di &quot;Expected IID SE: $estSEiid&quot;
di &quot;Expected Neyman SE: $estSENeyman&quot;
di &quot;SIM SE: $simSE&quot;
di &quot;True SE: $seEstATETrue&quot;</code></pre>
</div>
<div id="ch3Hide11" class="tabcontent">

</div>
</div>
<pre><code>   estSEiid estSENeyman      trueSE       simSE 
     0.8511      0.9574      0.9189      0.9256 </code></pre>
</div>
<div id="how-do-we-calculate-randomization-based-confidence-intervals" class="section level3">
<h3><span class="header-section-number">3.1.2</span> How do we calculate randomization-based confidence intervals?</h3>
<p>When we have a two arm trial (and a relatively large sample size), we can estimate the ATE, calculate design based standard errors, and then use them to create large-sample justified (i.e., asymptotic theory) confidence intervals through either of the following approaches:</p>
<div class="tab">
<button class="tablinks" onclick="unrolltab(event, &apos;ch3R12&apos;)">
R code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Stata12&apos;)">
Stata code
</button>
<button class="tablinks" onclick="unrolltab(event, &apos;ch3Hide12&apos;)">
Hide
</button>
<div id="ch3R12" class="tabcontent">
<p><br></p>
<pre class="text"><code>## The difference_in_means function comes from the estimatr package.
estAndSE1 &lt;- difference_in_means(Y ~ Z, data = dat1)

## Note that coeftest and coefci come from the lmtest package
# (narrower intervals due to a different d.o.f.)
est2 &lt;- lm(Y ~ Z, data = dat1)
estAndSE2 &lt;- coeftest(est2, vcov.=vcovHC(est2, type = &quot;HC2&quot;))
estAndCI2 &lt;- coefci(est2, vcov.=vcovHC(est2, type = &quot;HC2&quot;), parm = &quot;Z&quot;)

## Organize output
out &lt;- rbind( unlist(estAndSE1[c(1,2,6:8)]),  c(estAndSE2[2,-3], estAndCI2) )
out &lt;- apply(out, 2, round, 3)
colnames(out) &lt;- c(&quot;Est&quot;, &quot;SE&quot;, &quot;pvalue&quot;, &quot;CI lower&quot;, &quot;CI upper&quot;)
row.names(out) &lt;- c(&quot;Approach 1 (diff. means)&quot;, &quot;Approach 2 (OLS)&quot;)
out</code></pre>
</div>
<div id="ch3Stata12" class="tabcontent">
<p><br></p>
<pre class="text"><code>** Organize output
matrix compareCIs = J(2, 5, .)
matrix rownames compareCIs = &quot;Approach 1 (diff. means)&quot; &quot;Approach 2 (OLS)&quot;
matrix colnames compareCIs = &quot;Est&quot; &quot;SE&quot; &quot;pvalue&quot; &quot;CI lower&quot; &quot;CI upper&quot;

** A difference in means test assuming unequal variances
** (equivalent to the design-based estimator, as discussed above)
ttest y, by(z) unequal
local diffmeans = r(mu_2) - r(mu_1)
matrix compareCIs[1,1] = round(`diffmeans&apos;, 0.001)
matrix compareCIs[1,2] = round(r(se), 0.001)
matrix compareCIs[1,3] = round(r(p), 0.001)
matrix compareCIs[1,4] = round(`diffmeans&apos; - (invttail(r(df_t), 0.025) * r(se)), 0.001)
matrix compareCIs[1,5] = round(`diffmeans&apos; + (invttail(r(df_t), 0.025) * r(se)), 0.001)

** A regression-based approach (narrower intervals due to a different d.o.f)
reg y z, vce(hc2) // See: &quot;matrix list r(table)&quot;
matrix compareCIs[2,1] = round(r(table)[1, 1], 0.001)
matrix compareCIs[2,2] = round(r(table)[2, 1], 0.001)
matrix compareCIs[2,3] = round(r(table)[4, 1], 0.001)
matrix compareCIs[2,4] = round(r(table)[5, 1], 0.001)
matrix compareCIs[2,5] = round(r(table)[6, 1], 0.001)

matrix list compareCIs</code></pre>
</div>
<div id="ch3Hide12" class="tabcontent">

</div>
</div>
<pre><code>                           Est    SE pvalue CI lower CI upper
Approach 1 (diff. means) 4.637 1.039      0    2.524    6.750
Approach 2 (OLS)         4.637 1.039      0    2.576    6.699</code></pre>
</div>
</div>
<div id="summary-what-does-a-design-based-approach-mean-for-policy-evaluation" class="section level2">
<h2><span class="header-section-number">3.2</span> Summary: What does a design based approach mean for policy evaluation?</h2>
<p>Let&#x2019;s review some important terms. Hypothesis tests produce <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>-values telling us how much information we have against a null hypothesis. Estimators produce guesses about the size of some causal effect like the average treatment effect (i.e., &#x201C;estimates&#x201D;). Standard errors summarize how our estimates might vary from experiment to experiment by random chance, though we can only observe one experiment in practice. Confidence intervals tell us which ranges of null hypotheses are more versus less consistent with our data.</p>
<p>In the frequentist approach to probability (the only approach we consider in this SOP), the properties of both <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>-values and standard errors arise from some process of repetition. Statistics textbooks often encourage us to imagine that this process of repetition involves repeated sampling from a larger (potentially infinite) population. But most OES work involves a pool of people who do not represent a well-defined population, nor do we tend to have a strong probability model of how these people and not others entered our sample. Instead, we have a known process of random assignment to an experimental intervention within a fixed sample. This often makes a randomization based approach to inference natural for our work, and helps our work be easiest to explain and interepret for our policy partners.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-neyman_application_1923">
<p>Neyman, Jerzy. 1923. &#x201C;On the Application of Probability Theory to Agricultural Experiments: Essay on Principles, Section 9.&#x201D; <em>Annals of Agricultural Sciences</em>, 101&#x2013;51 (in Polish).</p>
</div>
<div id="ref-fisher_design_1935">
<p>Fisher, Ronald A. 1935. <em>The Design of Experiments</em>. Edinburgh: Oliver; Boyd.</p>
</div>
<div id="ref-gerber_field_2012">
<p>Gerber, Alan S., and Donald P. Green. 2012. <em>Field Experiments: Design, Analysis, and Interpretation</em>. New York, NY: W. W. Norton &amp; Company.</p>
</div>
<div id="ref-dunning_natural_2012">
<p>Dunning, Thad. 2012. <em>Natural Experiments in the Social Sciences: A Design-Based Approach</em>. Strategies for Social Inquiry. New York, NY: Cambridge University Press.</p>
</div>
<div id="ref-lin_agnostic_2013">
<p>Lin, Winston. 2013. &#x201C;Agnostic Notes on Regression Adjustments to Experimental Data: Reexamining Freedman&#x2019;s Critique.&#x201D; <em>The Annals of Applied Statistics</em> 7 (1): 295&#x2013;318.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="statistical-priorities.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="randomization-choices.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/gsa-oes/sop/edit/master/Book/03-randomizationinference.Rmd",
"text": "Edit"
},
"download": ["OES_SOP.pdf", "OES_SOP.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
