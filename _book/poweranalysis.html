<!DOCTYPE html>
<html>

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>OES Standard Operating Procedures for The Design and Statistical Analysis of Experiments.</title>
  <meta name="description" content="These are the current standard operating procedures for statistical analysis of the Office of Evaluation Sciences in the GSA">
  <meta name="generator" content="bookdown &lt;!--bookdown:version--&gt; and GitBook 2.6.7">

  <meta property="og:title" content="OES Standard Operating Procedures for The Design and Statistical Analysis of Experiments.">
  <meta property="og:type" content="book">
  
  
  <meta property="og:description" content="These are the current standard operating procedures for statistical analysis of the Office of Evaluation Sciences in the GSA">
  <meta name="github-repo" content="gsa-oes/sop">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="OES Standard Operating Procedures for The Design and Statistical Analysis of Experiments.">
  
  <meta name="twitter:description" content="These are the current standard operating procedures for statistical analysis of the Office of Evaluation Sciences in the GSA">
  

<meta name="author" content="Jake Bowers, Ryan T. Moore, Lula Chen, Paul Testa, Nate Higgins, Oliver McClellan, Miles Williams, Tyler Simko, Bill Schultz">


<meta name="date" content="2023-08-25">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="analysis-choices.html">
<link rel="next" href="working-with-data.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet">








<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}
</script>
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
.row { display: flex; }
.collapse { display: none; }
.in { display:block }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/katex.min.css" data-external="1"></head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The OES SOP</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#purposes-of-this-document"><i class="fa fa-check"></i>Purposes of this document</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#nature-and-limitations-of-this-document"><i class="fa fa-check"></i>Nature and limitations of this document</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#we-mostly-focus-on-randomized-field-experiments."><i class="fa fa-check"></i>We (mostly) focus on randomized field experiments.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#we-present-examples-using-r"><i class="fa fa-check"></i>We present examples using R</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#structure-of-the-document"><i class="fa fa-check"></i>Structure of the document</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#help-us-improve-our-work"><i class="fa fa-check"></i>Help us improve our work!</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-document"><i class="fa fa-check"></i>About this document</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="statistical-and-causal-inference-for-policy-change.html"><a href="statistical-and-causal-inference-for-policy-change.html"><i class="fa fa-check"></i><b>1</b> Statistical and causal inference for policy change</a></li>
<li class="chapter" data-level="2" data-path="basics-of-experimental-design-and-analysis.html"><a href="basics-of-experimental-design-and-analysis.html"><i class="fa fa-check"></i><b>2</b> Basics of Experimental Design and Analysis</a><ul>
<li class="chapter" data-level="2.1" data-path="basics-of-experimental-design-and-analysis.html"><a href="basics-of-experimental-design-and-analysis.html#statistical-power-designing-studies-that-effectively-distinguish-signal-from-noise"><i class="fa fa-check"></i><b>2.1</b> Statistical Power: Designing Studies that effectively distinguish signal from noise</a></li>
<li class="chapter" data-level="2.2" data-path="basics-of-experimental-design-and-analysis.html"><a href="basics-of-experimental-design-and-analysis.html#error-rates-of-tests"><i class="fa fa-check"></i><b>2.2</b> Error Rates of Tests</a></li>
<li class="chapter" data-level="2.3" data-path="basics-of-experimental-design-and-analysis.html"><a href="basics-of-experimental-design-and-analysis.html#bias-in-estimators"><i class="fa fa-check"></i><b>2.3</b> Bias in Estimators</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="design-based-principles-of-statistical-inference.html"><a href="design-based-principles-of-statistical-inference.html"><i class="fa fa-check"></i><b>3</b> Design-Based Principles of Statistical Inference</a><ul>
<li class="chapter" data-level="3.1" data-path="design-based-principles-of-statistical-inference.html"><a href="design-based-principles-of-statistical-inference.html#randinfex"><i class="fa fa-check"></i><b>3.1</b> An example using simulated data</a><ul>
<li class="chapter" data-level="3.1.1" data-path="design-based-principles-of-statistical-inference.html"><a href="design-based-principles-of-statistical-inference.html#how-do-we-calculate-randomization-based-standard-errors"><i class="fa fa-check"></i><b>3.1.1</b> How do we calculate randomization-based standard errors?</a></li>
<li class="chapter" data-level="3.1.2" data-path="design-based-principles-of-statistical-inference.html"><a href="design-based-principles-of-statistical-inference.html#how-do-we-calculate-randomization-based-confidence-intervals"><i class="fa fa-check"></i><b>3.1.2</b> How do we calculate randomization-based confidence intervals?</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="design-based-principles-of-statistical-inference.html"><a href="design-based-principles-of-statistical-inference.html#summary-what-does-a-design-based-approach-mean-for-policy-evaluation"><i class="fa fa-check"></i><b>3.2</b> Summary: What does a design based approach mean for policy evaluation?</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="randomization-and-design.html"><a href="randomization-and-design.html"><i class="fa fa-check"></i><b>4</b> Randomization and Design</a><ul>
<li class="chapter" data-level="4.1" data-path="randomization-and-design.html"><a href="randomization-and-design.html#coin-flipping-randomization-versus-urn-drawing-randomization"><i class="fa fa-check"></i><b>4.1</b> Coin flipping randomization versus Urn-drawing randomization</a></li>
<li class="chapter" data-level="4.2" data-path="randomization-and-design.html"><a href="randomization-and-design.html#urn-drawing-or-complete-randomization-into-2-or-more-groups"><i class="fa fa-check"></i><b>4.2</b> Urn-Drawing or Complete Randomization into 2 or more groups</a></li>
<li class="chapter" data-level="4.3" data-path="randomization-and-design.html"><a href="randomization-and-design.html#factorial-designs"><i class="fa fa-check"></i><b>4.3</b> Factorial Designs</a></li>
<li class="chapter" data-level="4.4" data-path="randomization-and-design.html"><a href="randomization-and-design.html#block-random-assignment"><i class="fa fa-check"></i><b>4.4</b> Block Random Assignment</a><ul>
<li class="chapter" data-level="4.4.1" data-path="randomization-and-design.html"><a href="randomization-and-design.html#using-only-a-few-covariates-to-create-blocks"><i class="fa fa-check"></i><b>4.4.1</b> Using only a few covariates to create blocks</a></li>
<li class="chapter" data-level="4.4.2" data-path="randomization-and-design.html"><a href="randomization-and-design.html#multivariate-blocking-using-many-covariates"><i class="fa fa-check"></i><b>4.4.2</b> Multivariate blocking using many covariates</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="randomization-and-design.html"><a href="randomization-and-design.html#cluster-random-assignment"><i class="fa fa-check"></i><b>4.5</b> Cluster random assignment</a></li>
<li class="chapter" data-level="4.6" data-path="randomization-and-design.html"><a href="randomization-and-design.html#other-designs"><i class="fa fa-check"></i><b>4.6</b> Other designs</a></li>
<li class="chapter" data-level="4.7" data-path="randomization-and-design.html"><a href="randomization-and-design.html#randomization-assessment"><i class="fa fa-check"></i><b>4.7</b> Randomization assessment</a><ul>
<li class="chapter" data-level="4.7.1" data-path="randomization-and-design.html"><a href="randomization-and-design.html#what-to-do-with-failed-randomization-assessments"><i class="fa fa-check"></i><b>4.7.1</b> What to do with &#x201C;failed&#x201D; randomization assessments?</a></li>
<li class="chapter" data-level="4.7.2" data-path="randomization-and-design.html"><a href="randomization-and-design.html#how-to-minimize-large-chance-departures-of-randomization"><i class="fa fa-check"></i><b>4.7.2</b> How to minimize large chance departures of randomization?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="analysis-choices.html"><a href="analysis-choices.html"><i class="fa fa-check"></i><b>5</b> Analysis Choices</a><ul>
<li class="chapter" data-level="5.1" data-path="analysis-choices.html"><a href="analysis-choices.html#completely-or-urn-draw-randomized-trials"><i class="fa fa-check"></i><b>5.1</b> Completely or Urn-Draw Randomized Trials</a><ul>
<li class="chapter" data-level="5.1.1" data-path="analysis-choices.html"><a href="analysis-choices.html#two-arms"><i class="fa fa-check"></i><b>5.1.1</b> Two arms</a></li>
<li class="chapter" data-level="5.1.2" data-path="analysis-choices.html"><a href="analysis-choices.html#multiple-arms"><i class="fa fa-check"></i><b>5.1.2</b> Multiple arms</a></li>
<li class="chapter" data-level="5.1.3" data-path="analysis-choices.html"><a href="analysis-choices.html#multiple-outcomes"><i class="fa fa-check"></i><b>5.1.3</b> Multiple Outcomes</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="analysis-choices.html"><a href="analysis-choices.html#covariance-adjustment-the-use-of-background-information-to-increase-precision"><i class="fa fa-check"></i><b>5.2</b> Covariance Adjustment (the use of background information to increase precision)</a><ul>
<li class="chapter" data-level="5.2.1" data-path="analysis-choices.html"><a href="analysis-choices.html#intuition-about-bias-in-the-least-squares-estimator-of-the-ate-with-covariates"><i class="fa fa-check"></i><b>5.2.1</b> Intuition about bias in the least squares estimator of the ATE with covariates</a></li>
<li class="chapter" data-level="5.2.2" data-path="analysis-choices.html"><a href="analysis-choices.html#the-lin-approach-to-covariance-adjustment"><i class="fa fa-check"></i><b>5.2.2</b> The Lin Approach to Covariance Adjustment</a></li>
<li class="chapter" data-level="5.2.3" data-path="analysis-choices.html"><a href="analysis-choices.html#the-rosenbaum-approach-the-covariance-adjustment"><i class="fa fa-check"></i><b>5.2.3</b> The Rosenbaum Approach The Covariance Adjustment</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="analysis-choices.html"><a href="analysis-choices.html#how-to-choose-covariates-for-covariance-adjustment"><i class="fa fa-check"></i><b>5.3</b> How to choose covariates for covariance adjustment?</a></li>
<li class="chapter" data-level="5.4" data-path="analysis-choices.html"><a href="analysis-choices.html#blockrandanalysis"><i class="fa fa-check"></i><b>5.4</b> Block-randomized trials</a><ul>
<li class="chapter" data-level="5.4.1" data-path="analysis-choices.html"><a href="analysis-choices.html#testing-the-null-of-no-effects-with-binary-outcomes-and-block-randomization-cochran-mantel-haenszel-cmh-test-for-k-x-2-x-2-tables"><i class="fa fa-check"></i><b>5.4.1</b> Testing the null of no effects with binary outcomes and block randomization: Cochran-Mantel-Haenszel (CMH) test for K X 2 X 2 tables</a></li>
<li class="chapter" data-level="5.4.2" data-path="analysis-choices.html"><a href="analysis-choices.html#blockrandate"><i class="fa fa-check"></i><b>5.4.2</b> Estimating an overall Average Treatment Effect</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="analysis-choices.html"><a href="analysis-choices.html#clusterrandanalysis"><i class="fa fa-check"></i><b>5.5</b> Cluster-randomized trials</a><ul>
<li class="chapter" data-level="5.5.1" data-path="analysis-choices.html"><a href="analysis-choices.html#bias-when-cluster-size-is-correlated-with-potential-outcomes"><i class="fa fa-check"></i><b>5.5.1</b> Bias when cluster size is correlated with potential outcomes</a></li>
<li class="chapter" data-level="5.5.2" data-path="analysis-choices.html"><a href="analysis-choices.html#incorrect-false-positive-rates-from-tests-and-confidence-intervals"><i class="fa fa-check"></i><b>5.5.2</b> Incorrect false positive rates from tests and confidence intervals</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="poweranalysis.html"><a href="poweranalysis.html"><i class="fa fa-check"></i><b>6</b> Power Analysis</a><ul>
<li class="chapter" data-level="6.1" data-path="poweranalysis.html"><a href="poweranalysis.html#an-example-of-the-off-the-shelf-approach"><i class="fa fa-check"></i><b>6.1</b> An example of the off-the-shelf approach</a></li>
<li class="chapter" data-level="6.2" data-path="poweranalysis.html"><a href="poweranalysis.html#an-example-of-the-simulation-approach"><i class="fa fa-check"></i><b>6.2</b> An example of the simulation approach</a></li>
<li class="chapter" data-level="6.3" data-path="poweranalysis.html"><a href="poweranalysis.html#when-to-use-which-approach"><i class="fa fa-check"></i><b>6.3</b> When to use which approach</a></li>
<li class="chapter" data-level="6.4" data-path="poweranalysis.html"><a href="poweranalysis.html#additional-examples-of-the-simulation-approach"><i class="fa fa-check"></i><b>6.4</b> Additional examples of the simulation approach</a><ul>
<li class="chapter" data-level="6.4.1" data-path="poweranalysis.html"><a href="poweranalysis.html#a-two-by-two-design-with-interaction"><i class="fa fa-check"></i><b>6.4.1</b> A two-by-two design with interaction</a></li>
<li class="chapter" data-level="6.4.2" data-path="poweranalysis.html"><a href="poweranalysis.html#covariate-adjustment-with-the-lin-estimator"><i class="fa fa-check"></i><b>6.4.2</b> Covariate adjustment with the Lin estimator</a></li>
<li class="chapter" data-level="6.4.3" data-path="poweranalysis.html"><a href="poweranalysis.html#incorporating-declaredesign-into-oes-power-tools"><i class="fa fa-check"></i><b>6.4.3</b> Incorporating DeclareDesign into OES Power Tools</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="working-with-data.html"><a href="working-with-data.html"><i class="fa fa-check"></i><b>7</b> Working with data</a><ul>
<li class="chapter" data-level="7.1" data-path="working-with-data.html"><a href="working-with-data.html#general-questions-we-ask-of-a-data-set"><i class="fa fa-check"></i><b>7.1</b> General questions we ask of a data set</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="glossary-of-terms.html"><a href="glossary-of-terms.html"><i class="fa fa-check"></i><b>8</b> <span>Glossary of Terms</span></a></li>
<li class="chapter" data-level="9" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>9</b> <span>Appendix</span></a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://oes.gsa.gov" target="blank">Published by the OES</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">OES Standard Operating Procedures for The Design and Statistical Analysis of Experiments.</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="poweranalysis" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Power Analysis</h1>
<p>In this section we provide examples of how we assess statistical power for
different experimental research designs. We often prefer to use simulation to assess
the power of different research designs because we rarely have designs that
fit easily into the assumptions made by analytic tools.</p>
<p>However, for the sake of an example, we will show a version that uses
simulation that produces the same answer as the faster analytic version.</p>
<p>Imagine that we thought that a study would have an effect of about 1 standard
deviation &#x2013; this is more or less the effect difference we have created in our
example dataset so far. How large a study do we need in order to distinguish
this effect from noise?</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb177-1" title="1">population &lt;-<span class="st"> </span><span class="kw">declare_population</span>(dat1)</a>
<a class="sourceLine" id="cb177-2" title="2">potentials &lt;-<span class="st"> </span><span class="kw">declare_potential_outcomes</span>(Y <span class="op">~</span><span class="st"> </span>Z <span class="op">*</span><span class="st"> </span>y1 <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>Z) <span class="op">*</span><span class="st"> </span>y0)</a>
<a class="sourceLine" id="cb177-3" title="3"></a>
<a class="sourceLine" id="cb177-4" title="4">assignment &lt;-<span class="st"> </span><span class="kw">declare_assignment</span>(<span class="dt">Z=</span><span class="kw">complete_ra</span>(N))</a>
<a class="sourceLine" id="cb177-5" title="5">reveal     &lt;-<span class="st"> </span><span class="kw">declare_reveal</span>(Y, Z)</a>
<a class="sourceLine" id="cb177-6" title="6">design &lt;-<span class="st"> </span>population <span class="op">+</span><span class="st"> </span>potentials <span class="op">+</span><span class="st"> </span>assignment <span class="op">+</span><span class="st"> </span>reveal</a>
<a class="sourceLine" id="cb177-7" title="7"></a>
<a class="sourceLine" id="cb177-8" title="8">simdat1 &lt;-<span class="st"> </span><span class="kw">draw_data</span>(design)</a>
<a class="sourceLine" id="cb177-9" title="9"></a>
<a class="sourceLine" id="cb177-10" title="10"><span class="co"># Notice that we have new potential outcomes called Y_Z_1 and Y_Z_0 that are</span></a>
<a class="sourceLine" id="cb177-11" title="11"><span class="co"># copies of y0 and y1</span></a>
<a class="sourceLine" id="cb177-12" title="12"><span class="kw">stopifnot</span>(<span class="kw">with</span>(simdat1, <span class="kw">cor</span>(y0, Y_Z_<span class="dv">0</span>)) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb177-13" title="13"></a>
<a class="sourceLine" id="cb177-14" title="14">estimand  &lt;-<span class="st"> </span><span class="kw">declare_inquiry</span>(<span class="dt">ATE =</span> <span class="kw">mean</span>(Y_Z_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>Y_Z_<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb177-15" title="15">estimator  &lt;-<span class="st"> </span><span class="kw">declare_estimator</span>(Y <span class="op">~</span><span class="st"> </span>Z, <span class="dt">inquiry =</span> estimand, <span class="dt">label =</span> <span class="st">&quot;Simple D-I-M&quot;</span>)</a>
<a class="sourceLine" id="cb177-16" title="16"></a>
<a class="sourceLine" id="cb177-17" title="17"><span class="co"># We can see how the estimator function works using some data simulated based on</span></a>
<a class="sourceLine" id="cb177-18" title="18"><span class="co"># the design</span></a>
<a class="sourceLine" id="cb177-19" title="19"><span class="kw">estimator</span>(simdat1)</a></code></pre></div>
<pre><code>     estimator term estimate std.error statistic   p.value conf.low conf.high df outcome inquiry
1 Simple D-I-M    Z    5.571    0.8153     6.834 7.069e-10    3.953     7.189 98       Y     ATE</code></pre>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb179-1" title="1">designPlusEst &lt;-<span class="st"> </span>design <span class="op">+</span><span class="st"> </span>estimand <span class="op">+</span><span class="st"> </span>estimator</a></code></pre></div>
<p>Now that the setup is complete, we can assess the statistical power of our
proposed design with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">N=100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">100</span></span></span></span> and an effect of roughly 1 SD. The output below
shows the statistical power as well as the false positive rate (called
&#x201C;Coverage&#x201D; below) as well as the difference between the mean difference we
calculate and the true average treatment effect (called &#x201C;Bias&#x201D; below).</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb180-1" title="1"><span class="kw">diagnose_design</span>(designPlusEst, <span class="dt">sims =</span> <span class="dv">1000</span>)</a></code></pre></div>
<pre><code>
Research design diagnosis based on 1000 simulations. Diagnosis completed in 30 secs. Diagnosand estimates with bootstrapped standard errors in parentheses (100 replicates).

        Design Inquiry    Estimator Outcome Term N Sims Mean Estimand Mean Estimate   Bias
 designPlusEst     ATE Simple D-I-M       Y    Z   1000          5.45          5.47   0.02
                                                               (0.00)        (0.02) (0.02)
 SD Estimate   RMSE  Power Coverage
        0.71   0.71   1.00     0.97
      (0.02) (0.02) (0.00)   (0.01)</code></pre>
<p>The analytic approach suggests more power than the simulation based approach
&#x2013; a difference that we suspect arises from our fairly skewed outcome.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb182-1" title="1"><span class="kw">power.t.test</span>(<span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">delta =</span> <span class="dv">1</span>, <span class="dt">sd =</span> <span class="dv">1</span>)</a></code></pre></div>
<pre><code>
     Two-sample t test power calculation 

              n = 100
          delta = 1
             sd = 1
      sig.level = 0.05
          power = 1
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
<p>For ways to compare different sample sizes, effect sizes, etc. see <a href="https://declaredesign.org/blog/2018-10-02-power-strategies.html">more
information from the DeclareDesign
package</a>.</p>
<div id="an-example-of-the-off-the-shelf-approach" class="section level2">
<h2><span class="header-section-number">6.1</span> An example of the off-the-shelf approach</h2>
<p>To demonstrate how a power analysis might work in principle, consider another
example using the R function <code>power.t.test()</code>.</p>
<p>When using this function, there are three parameters that we&#x2019;re most concerned
with, two of which are specified by the user, and the third of which is then
calculated and returned by the function. These are:</p>
<ul>
<li><code>n</code> = sample size, or number of observations;,</li>
<li><code>delta</code> = the target effect size, or a minimum detectable effect (MDE); and</li>
<li><code>power</code> = the probability of detecting an effect if in fact there is a true effect of size <code>delta</code>.</li>
</ul>
<p>Say, for example, you want to know the MDE for a two-arm study with 1,000
participants. Using <code>power.t.test()</code> you would specify:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb184-1" title="1"><span class="kw">power.t.test</span>(</a>
<a class="sourceLine" id="cb184-2" title="2">  <span class="dt">n =</span> <span class="dv">500</span>,     <span class="co"># n denotes the number of obs. per treatment arm</span></a>
<a class="sourceLine" id="cb184-3" title="3">  <span class="dt">power =</span> <span class="fl">0.8</span> <span class="co"># use traditional power threshold of 80%</span></a>
<a class="sourceLine" id="cb184-4" title="4">)</a></code></pre></div>
<pre><code>
     Two-sample t test power calculation 

              n = 500
          delta = 0.1774
             sd = 1
      sig.level = 0.05
          power = 0.8
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
<p>If we wanted to extract the MDE we could write:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" title="1"><span class="kw">power.t.test</span>(</a>
<a class="sourceLine" id="cb186-2" title="2">  <span class="dt">n =</span> <span class="dv">500</span>,     <span class="co"># number of obs. per treatment arm</span></a>
<a class="sourceLine" id="cb186-3" title="3">  <span class="dt">power =</span> <span class="fl">0.8</span>  <span class="co"># traditional power threshold of 80%</span></a>
<a class="sourceLine" id="cb186-4" title="4">)<span class="op">$</span>delta</a></code></pre></div>
<pre><code>[1] 0.1774</code></pre>
<p>We can similarly extract other parameters, like sample size and power, using
<code>$n</code> or <code>$power</code> instead of <code>$delta</code>. If you need to, you can adjust other
parameters, like the standard deviation of the response, the level of the test,
or whether the test is one-sided rather than two-sided. There are also other
functions available for different types of outcomes. For example, if you have a
binary response, you can use <code>power.prop.test()</code> to calculate power for a
difference in proportions test.</p>
<p>An equivalent approach in Stata is as follows:</p>
<pre><code>power twomeans 0, power(0.8) n(1000) sd(1)</code></pre>
<p>Stata users can learn more about available tools by checking out Stata&#x2019;s
plethora of <a href="https://www.stata.com/features/power-and-sample-size/">relevant help
files</a>.</p>
</div>
<div id="an-example-of-the-simulation-approach" class="section level2">
<h2><span class="header-section-number">6.2</span> An example of the simulation approach</h2>
<p>We can compare this approach with <code>power.t.test()</code> to the output from a
computational approach, which we define in the code chunk below. Results are
shown in the subsequent Figure XXXX. Though clearly the computational estimates
are slightly different, they comport quite well with the analytic estimates.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" title="1"><span class="co"># Workflow for power simulation toolkit:</span></a>
<a class="sourceLine" id="cb189-2" title="2"><span class="co"># Replicate, Estimate, Evaluate (REE)</span></a>
<a class="sourceLine" id="cb189-3" title="3"><span class="co"># </span></a>
<a class="sourceLine" id="cb189-4" title="4"><span class="co"># replicate_design(...) ---: Generate multiple replicates of a</span></a>
<a class="sourceLine" id="cb189-5" title="5"><span class="co">#                             a simulated d.g.p. + treatment assignment.</span></a>
<a class="sourceLine" id="cb189-6" title="6"><span class="co"># estimate(...) -----------: Estimate the null test-stat for treatment(s).</span></a>
<a class="sourceLine" id="cb189-7" title="7"><span class="co"># evaluate_power(...) -----: Evaluate power to detect non-zero effects.</span></a>
<a class="sourceLine" id="cb189-8" title="8"><span class="co"># evaluate_mde(...) -------: Find MDE, searching over range of effect sizes.</span></a>
<a class="sourceLine" id="cb189-9" title="9"><span class="co"># evaluate_bias(...) ------: Compute bias and other diagnostics.</span></a>
<a class="sourceLine" id="cb189-10" title="10"></a>
<a class="sourceLine" id="cb189-11" title="11"><span class="co">##### REPLICATE a design #####</span></a>
<a class="sourceLine" id="cb189-12" title="12"></a>
<a class="sourceLine" id="cb189-13" title="13">replicate_design &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb189-14" title="14"><span class="st">  </span><span class="cf">function</span>(<span class="dt">R =</span> <span class="dv">200</span>, ...) {</a>
<a class="sourceLine" id="cb189-15" title="15">    design &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb189-16" title="16">      <span class="co">#require(magrittr)</span></a>
<a class="sourceLine" id="cb189-17" title="17">      <span class="co">#require(fabricatr)</span></a>
<a class="sourceLine" id="cb189-18" title="18">      fabricatr<span class="op">::</span><span class="kw">fabricate</span>(</a>
<a class="sourceLine" id="cb189-19" title="19">        ...</a>
<a class="sourceLine" id="cb189-20" title="20">      ) <span class="op">%&gt;%</span><span class="st"> </span>list</a>
<a class="sourceLine" id="cb189-21" title="21">    }    </a>
<a class="sourceLine" id="cb189-22" title="22">    rep &lt;-<span class="st"> </span><span class="kw">replicate</span>(</a>
<a class="sourceLine" id="cb189-23" title="23">      <span class="dt">n =</span> R,</a>
<a class="sourceLine" id="cb189-24" title="24">      <span class="dt">expr =</span> <span class="kw">design</span>()</a>
<a class="sourceLine" id="cb189-25" title="25">    )</a>
<a class="sourceLine" id="cb189-26" title="26">    </a>
<a class="sourceLine" id="cb189-27" title="27">    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(rep)) {</a>
<a class="sourceLine" id="cb189-28" title="28">      rep[[i]] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-29" title="29"><span class="st">        </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb189-30" title="30">          <span class="dt">sim =</span> i</a>
<a class="sourceLine" id="cb189-31" title="31">        )</a>
<a class="sourceLine" id="cb189-32" title="32">    }</a>
<a class="sourceLine" id="cb189-33" title="33">    <span class="kw">return</span>(rep)</a>
<a class="sourceLine" id="cb189-34" title="34">  }</a>
<a class="sourceLine" id="cb189-35" title="35"></a>
<a class="sourceLine" id="cb189-36" title="36"><span class="co">##### ESTIMATE the null #####</span></a>
<a class="sourceLine" id="cb189-37" title="37"></a>
<a class="sourceLine" id="cb189-38" title="38">estimate &lt;-<span class="st"> </span><span class="cf">function</span>(</a>
<a class="sourceLine" id="cb189-39" title="39">  formula, vars, <span class="dt">data =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb189-40" title="40">  <span class="dt">estimator =</span> estimatr<span class="op">::</span>lm_robust</a>
<a class="sourceLine" id="cb189-41" title="41">) {</a>
<a class="sourceLine" id="cb189-42" title="42"><span class="co">#  require(magrittr)</span></a>
<a class="sourceLine" id="cb189-43" title="43">  data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-44" title="44"><span class="st">    </span>purrr<span class="op">::</span><span class="kw">map</span>(</a>
<a class="sourceLine" id="cb189-45" title="45">      <span class="op">~</span><span class="st"> </span><span class="kw">estimator</span>(</a>
<a class="sourceLine" id="cb189-46" title="46">          formula,</a>
<a class="sourceLine" id="cb189-47" title="47">          <span class="dt">data =</span> .</a>
<a class="sourceLine" id="cb189-48" title="48">        ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-49" title="49"><span class="st">          </span>estimatr<span class="op">::</span><span class="kw">tidy</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-50" title="50"><span class="st">          </span>dplyr<span class="op">::</span><span class="kw">filter</span>(</a>
<a class="sourceLine" id="cb189-51" title="51">            .data<span class="op">$</span>term <span class="op">%in%</span><span class="st"> </span>vars</a>
<a class="sourceLine" id="cb189-52" title="52">          ) </a>
<a class="sourceLine" id="cb189-53" title="53">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-54" title="54"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">bind_rows</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-55" title="55"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb189-56" title="56">      <span class="dt">sim =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(data), <span class="dt">each =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(data)),</a>
<a class="sourceLine" id="cb189-57" title="57">      <span class="dt">term =</span> <span class="kw">factor</span>(.data<span class="op">$</span>term, <span class="dt">levels =</span> vars)</a>
<a class="sourceLine" id="cb189-58" title="58">    ) </a>
<a class="sourceLine" id="cb189-59" title="59">}</a>
<a class="sourceLine" id="cb189-60" title="60"></a>
<a class="sourceLine" id="cb189-61" title="61"><span class="co">##### EVALUATE power #####</span></a>
<a class="sourceLine" id="cb189-62" title="62"></a>
<a class="sourceLine" id="cb189-63" title="63">evaluate_power &lt;-<span class="st"> </span><span class="cf">function</span>(</a>
<a class="sourceLine" id="cb189-64" title="64">  data, delta, <span class="dt">level =</span> <span class="fl">0.05</span></a>
<a class="sourceLine" id="cb189-65" title="65">) {</a>
<a class="sourceLine" id="cb189-66" title="66">  <span class="cf">if</span>(<span class="kw">missing</span>(delta)) {</a>
<a class="sourceLine" id="cb189-67" title="67">    <span class="kw">stop</span>(<span class="st">&quot;Specify &apos;delta&apos; to proceed.&quot;</span>)</a>
<a class="sourceLine" id="cb189-68" title="68">  }</a>
<a class="sourceLine" id="cb189-69" title="69"><span class="co">#  require(foreach)</span></a>
<a class="sourceLine" id="cb189-70" title="70"><span class="co">#  require(magrittr)</span></a>
<a class="sourceLine" id="cb189-71" title="71">  </a>
<a class="sourceLine" id="cb189-72" title="72">  foreach<span class="op">::</span><span class="kw">foreach</span>(</a>
<a class="sourceLine" id="cb189-73" title="73">    <span class="dt">i =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(delta),</a>
<a class="sourceLine" id="cb189-74" title="74">    <span class="dt">.combine =</span> <span class="st">&quot;bind_rows&quot;</span></a>
<a class="sourceLine" id="cb189-75" title="75">  ) <span class="op">%do%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb189-76" title="76">    data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-77" title="77"><span class="st">      </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb189-78" title="78">        <span class="dt">delta =</span> delta[i],</a>
<a class="sourceLine" id="cb189-79" title="79">        <span class="dt">new_statistic =</span> (.data<span class="op">$</span>estimate <span class="op">+</span><span class="st"> </span>.data<span class="op">$</span>delta) <span class="op">/</span><span class="st"> </span>.data<span class="op">$</span>std.error</a>
<a class="sourceLine" id="cb189-80" title="80">      ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-81" title="81"><span class="st">      </span>dplyr<span class="op">::</span><span class="kw">group_split</span>(.data<span class="op">$</span>term) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-82" title="82"><span class="st">      </span>purrr<span class="op">::</span><span class="kw">map</span>(</a>
<a class="sourceLine" id="cb189-83" title="83">        <span class="op">~</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb189-84" title="84">          tibble<span class="op">::</span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb189-85" title="85">            <span class="dt">term =</span> .<span class="op">$</span>term,</a>
<a class="sourceLine" id="cb189-86" title="86">            <span class="dt">delta =</span> .<span class="op">$</span>delta,</a>
<a class="sourceLine" id="cb189-87" title="87">            <span class="dt">p.value =</span> <span class="kw">foreach</span>(</a>
<a class="sourceLine" id="cb189-88" title="88">              <span class="dt">j =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(.<span class="op">$</span>new_statistic),</a>
<a class="sourceLine" id="cb189-89" title="89">              <span class="dt">.combine =</span> <span class="st">&quot;c&quot;</span></a>
<a class="sourceLine" id="cb189-90" title="90">            ) <span class="op">%do%</span><span class="st"> </span><span class="kw">mean</span>(<span class="kw">abs</span>(.<span class="op">$</span>statistic) <span class="op">&gt;=</span><span class="st"> </span></a>
<a class="sourceLine" id="cb189-91" title="91"><span class="st">                          </span><span class="kw">abs</span>(.<span class="op">$</span>new_statistic[j]))</a>
<a class="sourceLine" id="cb189-92" title="92">          )</a>
<a class="sourceLine" id="cb189-93" title="93">        }</a>
<a class="sourceLine" id="cb189-94" title="94">      )</a>
<a class="sourceLine" id="cb189-95" title="95">  } <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-96" title="96"><span class="st">    </span><span class="kw">group_by</span>(.data<span class="op">$</span>term, .data<span class="op">$</span>delta) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-97" title="97"><span class="st">    </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb189-98" title="98">      <span class="dt">power =</span> <span class="kw">mean</span>(.data<span class="op">$</span>p.value <span class="op">&lt;=</span><span class="st"> </span>level),</a>
<a class="sourceLine" id="cb189-99" title="99">      <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span></a>
<a class="sourceLine" id="cb189-100" title="100">    )</a>
<a class="sourceLine" id="cb189-101" title="101">}</a>
<a class="sourceLine" id="cb189-102" title="102"></a>
<a class="sourceLine" id="cb189-103" title="103"><span class="co">##### EVALUATE Min. Detectable Effect #####</span></a>
<a class="sourceLine" id="cb189-104" title="104"></a>
<a class="sourceLine" id="cb189-105" title="105">evaluate_mde &lt;-<span class="st"> </span><span class="cf">function</span>(</a>
<a class="sourceLine" id="cb189-106" title="106">  data, </a>
<a class="sourceLine" id="cb189-107" title="107">  <span class="dt">delta_range =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb189-108" title="108">  <span class="dt">how_granular =</span> <span class="fl">0.01</span>,</a>
<a class="sourceLine" id="cb189-109" title="109">  <span class="dt">level =</span> <span class="fl">0.05</span>,</a>
<a class="sourceLine" id="cb189-110" title="110">  <span class="dt">min_power =</span> <span class="fl">0.8</span></a>
<a class="sourceLine" id="cb189-111" title="111">) {</a>
<a class="sourceLine" id="cb189-112" title="112"></a>
<a class="sourceLine" id="cb189-113" title="113">  eval &lt;-<span class="st"> </span><span class="kw">evaluate_power</span>(</a>
<a class="sourceLine" id="cb189-114" title="114">    <span class="dt">data =</span> data, </a>
<a class="sourceLine" id="cb189-115" title="115">    <span class="dt">delta =</span> <span class="kw">seq</span>(delta_range[<span class="dv">1</span>], delta_range[<span class="dv">2</span>], how_granular),</a>
<a class="sourceLine" id="cb189-116" title="116">    <span class="dt">level =</span> level</a>
<a class="sourceLine" id="cb189-117" title="117">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-118" title="118"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(</a>
<a class="sourceLine" id="cb189-119" title="119">      .data<span class="op">$</span>term</a>
<a class="sourceLine" id="cb189-120" title="120">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-121" title="121"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb189-122" title="122">      <span class="dt">MDE =</span> <span class="kw">min</span>(.data<span class="op">$</span>delta[.data<span class="op">$</span>power <span class="op">&gt;=</span><span class="st"> </span>min_power]),</a>
<a class="sourceLine" id="cb189-123" title="123">      <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span></a>
<a class="sourceLine" id="cb189-124" title="124">    )</a>
<a class="sourceLine" id="cb189-125" title="125">  <span class="kw">return</span>(eval)</a>
<a class="sourceLine" id="cb189-126" title="126">}</a>
<a class="sourceLine" id="cb189-127" title="127"></a>
<a class="sourceLine" id="cb189-128" title="128"><span class="co">##### EVALUATE Bias #####</span></a>
<a class="sourceLine" id="cb189-129" title="129"></a>
<a class="sourceLine" id="cb189-130" title="130">evaluate_bias &lt;-<span class="st"> </span><span class="cf">function</span>(</a>
<a class="sourceLine" id="cb189-131" title="131">  data, </a>
<a class="sourceLine" id="cb189-132" title="132">  <span class="dt">ATE =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb189-133" title="133">) {</a>
<a class="sourceLine" id="cb189-134" title="134">  <span class="co">#require(magrittr)</span></a>
<a class="sourceLine" id="cb189-135" title="135">  smry &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-136" title="136"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb189-137" title="137">      <span class="dt">ATE =</span> <span class="kw">rep</span>(ATE, <span class="dt">len =</span> <span class="kw">n</span>())</a>
<a class="sourceLine" id="cb189-138" title="138">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-139" title="139"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(</a>
<a class="sourceLine" id="cb189-140" title="140">      .data<span class="op">$</span>term</a>
<a class="sourceLine" id="cb189-141" title="141">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-142" title="142"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb189-143" title="143">      <span class="st">&quot;True ATE&quot;</span> =<span class="st"> </span><span class="kw">unique</span>(.data<span class="op">$</span>ATE),</a>
<a class="sourceLine" id="cb189-144" title="144">      <span class="st">&quot;Mean Estimate&quot;</span> =<span class="st"> </span><span class="kw">mean</span>(.data<span class="op">$</span>estimate),</a>
<a class="sourceLine" id="cb189-145" title="145">      <span class="dt">Bias =</span> <span class="kw">mean</span>(.data<span class="op">$</span>estimate <span class="op">-</span><span class="st"> </span>.data<span class="op">$</span>ATE),</a>
<a class="sourceLine" id="cb189-146" title="146">      <span class="dt">MSE =</span> <span class="kw">mean</span>((.data<span class="op">$</span>estimate <span class="op">-</span><span class="st"> </span>.data<span class="op">$</span>ATE)<span class="op">^</span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb189-147" title="147">      <span class="dt">Covarage =</span> <span class="kw">mean</span>(.data<span class="op">$</span>conf.low <span class="op">&lt;=</span><span class="st"> </span>.data<span class="op">$</span>ATE <span class="op">&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb189-148" title="148"><span class="st">                        </span>.data<span class="op">$</span>conf.high <span class="op">&gt;=</span><span class="st"> </span>.data<span class="op">$</span>ATE),</a>
<a class="sourceLine" id="cb189-149" title="149">      <span class="st">&quot;SD of Estimates&quot;</span> =<span class="st"> </span><span class="kw">sd</span>(.data<span class="op">$</span>estimate),</a>
<a class="sourceLine" id="cb189-150" title="150">      <span class="st">&quot;Mean SE&quot;</span> =<span class="st"> </span><span class="kw">mean</span>(.data<span class="op">$</span>std.error),</a>
<a class="sourceLine" id="cb189-151" title="151">      <span class="dt">Power =</span> <span class="kw">mean</span>(.data<span class="op">$</span>p.value <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>),</a>
<a class="sourceLine" id="cb189-152" title="152">      <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span></a>
<a class="sourceLine" id="cb189-153" title="153">    )</a>
<a class="sourceLine" id="cb189-154" title="154">  <span class="kw">return</span>(smry)</a>
<a class="sourceLine" id="cb189-155" title="155">}</a></code></pre></div>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb190-1" title="1">n &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb190-2" title="2">d &lt;-<span class="st"> </span><span class="fl">0.2</span></a>
<a class="sourceLine" id="cb190-3" title="3"></a>
<a class="sourceLine" id="cb190-4" title="4">power_data &lt;-</a>
<a class="sourceLine" id="cb190-5" title="5"><span class="st">  </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb190-6" title="6">    <span class="dt">d =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dt">len =</span> <span class="dv">200</span>),</a>
<a class="sourceLine" id="cb190-7" title="7">    <span class="dt">power =</span> <span class="kw">power.t.test</span>(<span class="dt">n =</span> n <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">delta =</span> d)<span class="op">$</span>power</a>
<a class="sourceLine" id="cb190-8" title="8">  )</a>
<a class="sourceLine" id="cb190-9" title="9"></a>
<a class="sourceLine" id="cb190-10" title="10"><span class="co"># save plot; later add simulation results </span></a>
<a class="sourceLine" id="cb190-11" title="11">g &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb190-12" title="12"><span class="st">  </span><span class="kw">ggplot</span>(power_data) <span class="op">+</span></a>
<a class="sourceLine" id="cb190-13" title="13"><span class="st">  </span><span class="kw">geom_line</span>(</a>
<a class="sourceLine" id="cb190-14" title="14">    <span class="kw">aes</span>(d, power, <span class="dt">linetype =</span> <span class="st">&quot;power.t.test()&quot;</span>)</a>
<a class="sourceLine" id="cb190-15" title="15">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb190-16" title="16"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb190-17" title="17">    <span class="dt">x =</span> <span class="kw">expression</span>(delta),</a>
<a class="sourceLine" id="cb190-18" title="18">    <span class="dt">y =</span> <span class="st">&quot;Power&quot;</span>,</a>
<a class="sourceLine" id="cb190-19" title="19">    <span class="dt">title =</span> <span class="st">&quot;Power for Simple Difference in Means Test&quot;</span></a>
<a class="sourceLine" id="cb190-20" title="20">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb190-21" title="21"><span class="st">  </span><span class="kw">scale_y_continuous</span>(</a>
<a class="sourceLine" id="cb190-22" title="22">    <span class="dt">n.breaks =</span> <span class="dv">6</span></a>
<a class="sourceLine" id="cb190-23" title="23">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb190-24" title="24"><span class="st">  </span><span class="kw">geom_hline</span>(</a>
<a class="sourceLine" id="cb190-25" title="25">    <span class="dt">yintercept =</span> <span class="fl">0.8</span>,</a>
<a class="sourceLine" id="cb190-26" title="26">    <span class="dt">col =</span> <span class="st">&quot;grey25&quot;</span>,</a>
<a class="sourceLine" id="cb190-27" title="27">    <span class="dt">alpha =</span> <span class="dv">08</span></a>
<a class="sourceLine" id="cb190-28" title="28">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb190-29" title="29"><span class="st">  </span>ggridges<span class="op">::</span><span class="kw">theme_ridges</span>(</a>
<a class="sourceLine" id="cb190-30" title="30">    <span class="dt">center_axis_labels =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb190-31" title="31">    <span class="dt">font_size =</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb190-32" title="32">  ) </a>
<a class="sourceLine" id="cb190-33" title="33"></a>
<a class="sourceLine" id="cb190-34" title="34"><span class="co"># Add results from simulation to compare</span></a>
<a class="sourceLine" id="cb190-35" title="35"></a>
<a class="sourceLine" id="cb190-36" title="36">sim_power_data &lt;-</a>
<a class="sourceLine" id="cb190-37" title="37"><span class="st">  </span><span class="kw">replicate_design</span>(</a>
<a class="sourceLine" id="cb190-38" title="38">    <span class="dt">N =</span> n,</a>
<a class="sourceLine" id="cb190-39" title="39">    <span class="dt">y =</span> <span class="kw">rnorm</span>(N),</a>
<a class="sourceLine" id="cb190-40" title="40">    <span class="dt">x =</span> randomizr<span class="op">::</span><span class="kw">complete_ra</span>(</a>
<a class="sourceLine" id="cb190-41" title="41">      N, <span class="dt">m =</span> N <span class="op">/</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb190-42" title="42">    )</a>
<a class="sourceLine" id="cb190-43" title="43">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb190-44" title="44"><span class="st">  </span><span class="kw">estimate</span>(</a>
<a class="sourceLine" id="cb190-45" title="45">    <span class="dt">form =</span> y <span class="op">~</span><span class="st"> </span>x, <span class="dt">vars =</span> <span class="st">&quot;x&quot;</span></a>
<a class="sourceLine" id="cb190-46" title="46">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb190-47" title="47"><span class="st">  </span><span class="kw">evaluate_power</span>(</a>
<a class="sourceLine" id="cb190-48" title="48">    <span class="dt">delta =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dt">len =</span> <span class="dv">200</span>)</a>
<a class="sourceLine" id="cb190-49" title="49">  )</a>
<a class="sourceLine" id="cb190-50" title="50"></a>
<a class="sourceLine" id="cb190-51" title="51">g <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb190-52" title="52"><span class="st">  </span><span class="kw">geom_line</span>(</a>
<a class="sourceLine" id="cb190-53" title="53">    <span class="dt">data =</span> sim_power_data,</a>
<a class="sourceLine" id="cb190-54" title="54">    <span class="kw">aes</span>(delta, power, <span class="dt">linetype =</span> <span class="st">&quot;simulation&quot;</span>),</a>
<a class="sourceLine" id="cb190-55" title="55">    <span class="dt">color =</span> <span class="st">&quot;grey25&quot;</span></a>
<a class="sourceLine" id="cb190-56" title="56">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb190-57" title="57"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb190-58" title="58">    <span class="dt">linetype =</span> <span class="st">&quot;Method:&quot;</span></a>
<a class="sourceLine" id="cb190-59" title="59">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb190-60" title="60"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb190-61" title="61">    <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span></a>
<a class="sourceLine" id="cb190-62" title="62">  ) </a></code></pre></div>
<p><img src="OES_SOP_files/figure-html/powersimvsanalytic-1.png" width=".9\textwidth"></p>
<p>Figure 1. Off-the-shelf versus simulation power estimates</p>
<p>We produce these computational estimates using some helpful tools currently
housed in OES&#x2019;s GitHub <a href="https://github.com/gsa-oes/code_library/blob/master/power_simulation/power_simulation_tools.R">code
library</a> and in the chunk above.</p>
<p>These tools are designed around a simple workflow, and remove some of the
programming required to calculate power computationally.</p>
<p>These tools are centered around the following workflow:</p>
<ol style="list-style-type: decimal">
<li>Replicate</li>
<li>Estimate<br>
</li>
<li>Evaluate</li>
</ol>
<p>The first step in the workflow, <em>Replicate</em>, entails designing a data-generating
process (which may include only an outcome variable and treatment assignment)
and simulating this process multiple times to create randomly drawn datasets
from a population. Each of these is a <em>sample replicate</em>.</p>
<p>The next step, <em>Estimate</em>, entails estimating effects for select treatments
under the null hypothesis for each sample replicate. This provides a
distribution of test statistics under the null hypothesis.</p>
<p>Finally, the last step, <em>Evaluate</em>, entails evaluating power to detect an effect
over a range of alternative effect sizes.</p>
<p>This workflow is supported by three functions: <code>replicate_design()</code>,
<code>estimate()</code>, and <code>evaluate_power()</code>. Here&#x2019;s the script used to generate the
computational estimates shown in Figure 1:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb191-1" title="1"><span class="co"># 1. Replicate:</span></a>
<a class="sourceLine" id="cb191-2" title="2"></a>
<a class="sourceLine" id="cb191-3" title="3">rep &lt;-<span class="st"> </span><span class="kw">replicate_design</span>(</a>
<a class="sourceLine" id="cb191-4" title="4">  <span class="dt">R =</span> <span class="dv">200</span>,   <span class="co"># Number of sample replicates</span></a>
<a class="sourceLine" id="cb191-5" title="5">  <span class="dt">N =</span> <span class="dv">1000</span>,  <span class="co"># Sample size of each replicate</span></a>
<a class="sourceLine" id="cb191-6" title="6">  <span class="dt">y =</span> <span class="kw">rnorm</span>(N), <span class="co"># Normally distributed response</span></a>
<a class="sourceLine" id="cb191-7" title="7">  <span class="dt">x =</span> <span class="kw">rbinom</span>(N, <span class="dv">1</span>, <span class="fl">0.5</span>) <span class="co"># Binary treatment indicator</span></a>
<a class="sourceLine" id="cb191-8" title="8">) </a>
<a class="sourceLine" id="cb191-9" title="9"></a>
<a class="sourceLine" id="cb191-10" title="10"><span class="co"># 2. Estimate:</span></a>
<a class="sourceLine" id="cb191-11" title="11"></a>
<a class="sourceLine" id="cb191-12" title="12">est &lt;-<span class="st"> </span><span class="kw">estimate</span>(</a>
<a class="sourceLine" id="cb191-13" title="13">  y <span class="op">~</span><span class="st"> </span>x, <span class="dt">vars =</span> <span class="st">&quot;x&quot;</span>, <span class="dt">data =</span> rep</a>
<a class="sourceLine" id="cb191-14" title="14">) </a>
<a class="sourceLine" id="cb191-15" title="15"></a>
<a class="sourceLine" id="cb191-16" title="16"><span class="co"># 3. Evaluate:</span></a>
<a class="sourceLine" id="cb191-17" title="17"></a>
<a class="sourceLine" id="cb191-18" title="18">pwr_eval_sim &lt;-<span class="st"> </span><span class="kw">evaluate_power</span>(</a>
<a class="sourceLine" id="cb191-19" title="19">  <span class="dt">data =</span> est,</a>
<a class="sourceLine" id="cb191-20" title="20">  <span class="dt">delta =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dt">len =</span> <span class="dv">200</span>)</a>
<a class="sourceLine" id="cb191-21" title="21">)   </a></code></pre></div>
<p>The final product of this approach, the object <code>pwr_eval_sim</code>, reports the power
for each of the user-specified effect sizes (<code>delta</code>) for each of the model
terms specified by the vars command in the <code>estimate()</code> function. The output can
be used to plot power curves or to compute minimum detectable effects.</p>
<p>This approach makes computational power analysis vastly more efficient from a
programming perspective, while also providing ample room for flexibility in both
design and estimation strategy. For example, <code>replicate_design()</code> is a wrapper
for <code>fabricate()</code> in the <a href="https://declaredesign.org/r/fabricatr/">fabricatr</a>
package. This gives users the ability to generate multi-level or nested
data-generating processes, specify covariates, or determine whether treatment
randomization is done within blocks or by clusters. Additionally, by default,
estimates are returned using <code>lm_robust()</code> from the
<a href="https://declaredesign.org/r/estimatr/">estimatr</a> package, but alternative
estimators can be specified. Say, for example, you have a binary response and a
set of covariates and your design calls for using logistic regression. You can
generate estimates for such a design as follows:</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb192-1" title="1">logit &lt;-<span class="st"> </span><span class="cf">function</span>(...){ <span class="kw">glm</span>(..., <span class="dt">family =</span> binomial)}</a>
<a class="sourceLine" id="cb192-2" title="2">est &lt;-<span class="st"> </span><span class="kw">estimate</span>(</a>
<a class="sourceLine" id="cb192-3" title="3">  y <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>z1 <span class="op">+</span><span class="st"> </span>z2, <span class="dt">data =</span> rep, <span class="dt">estimator =</span> logit</a>
<a class="sourceLine" id="cb192-4" title="4">) </a></code></pre></div>
<p>These tools, in short, while imposing a particular workflow, provide significant
latitude in terms of design and estimation. However, other tools exist as well.
<a href="https://declaredesign.org/r/declaredesign/articles/DeclareDesign_101.html">DeclareDesign</a>
provides useful tools, for example. And there is no shortage of simulation
examples online of a variety of research designs.</p>
</div>
<div id="when-to-use-which-approach" class="section level2">
<h2><span class="header-section-number">6.3</span> When to use which approach</h2>
<p>Of course, for a simple difference in means test, the programming required for
an analytical solution is much much less involved than the computational
solution. When is the latter worth the extra investment?</p>
<p>In cases where we&#x2019;re interested in the power to detect a simple difference in
means, or a difference in proportions for binary responses, it is probably
sufficient to use <code>power.t.test()</code> (for means) or <code>power.prop.test()</code> (for
proportions).</p>
<p>However, OES projects often involve design features or analytic strategies that
are difficult to account for using off-the-shelf tools. For example, we often
include covariates in our statistical models when we analyze outcomes in order
to enhance the precision of our estimates of treatment effects. If the gain in
precision is small, then it might not be important to account for this in power
calculations in the design phase of the project. However, if we expect a
substantial gain in precision due to including covariates, then we probably want
to account for this in our design. The natural way to do this is by simulation,
where we can include the covariates in the &#x201C;replicate&#x201D; and &#x201C;estimate&#x201D; steps.
Accounting for covariates in this way is especially useful if we can use real
historical or pre-treatment data that represent the correlations we expect to
see between covariates and outcomes in our later analysis of the trial data.</p>
<p>More complex design features or analytic strategies may make investing in the
simulation approach even more worthwhile, or downright necessary. Examples
include heterogeneity in treatment effects, a multi-arm or factorial design, or
block randomization with differing probabilities of treatment between blocks &#x2013;
none of which can practically be accounted for with off-the-shelf tools. In the
next section, we provide some additional examples of simulations for more
complex design features or analytic strategies.</p>
</div>
<div id="additional-examples-of-the-simulation-approach" class="section level2">
<h2><span class="header-section-number">6.4</span> Additional examples of the simulation approach</h2>
<p>Here we provide two examples of research designs where simulation is well worth
the extra effort. Attendant R code is included in the discussion to illustrate
how to use tools in the code library to streamline the approach.</p>
<div id="a-two-by-two-design-with-interaction" class="section level3">
<h3><span class="header-section-number">6.4.1</span> A two-by-two design with interaction</h3>
<p>One instance where computational power analysis may be worth the investment is
in assessing power for a two-by-two factorial design with an interaction. In
such a design, the goal is to assess not only the power to detect main effects
(the average effect of each individual treatment), but also power to detect a
non-zero interaction effect between the treatments.</p>
<p>Say we have a design with 1,000 observations and we would like to know the
effect of two treatments on a binary outcome with a baseline of 0.25. Each
treatment is assigned to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>=</mo><mn>500</mn></mrow><annotation encoding="application/x-tex">M = 500</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">500</span></span></span></span> individuals at random, resulting in four
roughly equal sized groups of observations after randomization: (1) a control
group, (2) those assigned to treatment 1 but not treatment 2, (3) those assigned
to treatment 2 but not treatment 1, and (4) those assigned to both treatment 1
and 2.</p>
<p>We can easily calculate power to detect the main effect of each treatment, in
addition to their interaction, using replication, estimation, and evaluation as
follows:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb193-1" title="1">two_by_two &lt;-</a>
<a class="sourceLine" id="cb193-2" title="2"><span class="st">  </span><span class="co"># Replicate a 2x2 design</span></a>
<a class="sourceLine" id="cb193-3" title="3"><span class="st">  </span><span class="kw">replicate_design</span>(</a>
<a class="sourceLine" id="cb193-4" title="4">    <span class="dt">N =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb193-5" title="5">    <span class="dt">y =</span> <span class="kw">rbinom</span>(N, <span class="dv">1</span>, <span class="fl">0.25</span>),</a>
<a class="sourceLine" id="cb193-6" title="6">    <span class="dt">x1 =</span> <span class="kw">complete_ra</span>(N, <span class="dt">m =</span> N <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, <span class="co"># center treatment indicators </span></a>
<a class="sourceLine" id="cb193-7" title="7">    <span class="dt">x2 =</span> <span class="kw">complete_ra</span>(N, <span class="dt">m =</span> N <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb193-8" title="8">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb193-9" title="9"><span class="st">  </span><span class="co"># Estimate main and interaction effects</span></a>
<a class="sourceLine" id="cb193-10" title="10"><span class="st">  </span><span class="kw">estimate</span>(</a>
<a class="sourceLine" id="cb193-11" title="11">    <span class="dt">form =</span> y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2 <span class="op">+</span><span class="st"> </span>x1<span class="op">:</span>x2,</a>
<a class="sourceLine" id="cb193-12" title="12">    <span class="dt">vars =</span> <span class="kw">c</span>(<span class="st">&quot;x1&quot;</span>, <span class="st">&quot;x2&quot;</span>, <span class="st">&quot;x1:x2&quot;</span>)</a>
<a class="sourceLine" id="cb193-13" title="13">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb193-14" title="14"><span class="st">  </span><span class="co"># Evaluate power</span></a>
<a class="sourceLine" id="cb193-15" title="15"><span class="st">  </span><span class="kw">evaluate_power</span>(</a>
<a class="sourceLine" id="cb193-16" title="16">    <span class="dt">delta =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="dt">len =</span> <span class="dv">200</span>)</a>
<a class="sourceLine" id="cb193-17" title="17">  )</a></code></pre></div>
<p>Using the output reported in the object <code>two_by_two</code>, we can easily plot the
power curves for each of the main effects and the interaction effect, as shown
in Figure 2.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" title="1"><span class="kw">ggplot</span>(two_by_two) <span class="op">+</span></a>
<a class="sourceLine" id="cb194-2" title="2"><span class="st">  </span><span class="kw">geom_line</span>(</a>
<a class="sourceLine" id="cb194-3" title="3">    <span class="kw">aes</span>(delta, power, <span class="dt">linetype =</span> term)</a>
<a class="sourceLine" id="cb194-4" title="4">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb194-5" title="5"><span class="st">  </span><span class="kw">geom_hline</span>(</a>
<a class="sourceLine" id="cb194-6" title="6">    <span class="dt">yintercept =</span> <span class="fl">0.8</span>,</a>
<a class="sourceLine" id="cb194-7" title="7">    <span class="dt">color =</span> <span class="st">&quot;grey25&quot;</span>,</a>
<a class="sourceLine" id="cb194-8" title="8">    <span class="dt">alpha =</span> <span class="fl">0.8</span></a>
<a class="sourceLine" id="cb194-9" title="9">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb194-10" title="10"><span class="st">  </span><span class="kw">scale_y_continuous</span>(</a>
<a class="sourceLine" id="cb194-11" title="11">    <span class="dt">n.breaks =</span> <span class="dv">6</span></a>
<a class="sourceLine" id="cb194-12" title="12">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb194-13" title="13"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb194-14" title="14">    <span class="dt">x =</span> <span class="kw">expression</span>(delta),</a>
<a class="sourceLine" id="cb194-15" title="15">    <span class="dt">y =</span> <span class="st">&quot;Power&quot;</span>,</a>
<a class="sourceLine" id="cb194-16" title="16">    <span class="dt">title =</span> <span class="st">&quot;Power for a 2x2 Design&quot;</span>,</a>
<a class="sourceLine" id="cb194-17" title="17">    <span class="dt">linetype =</span> <span class="st">&quot;Effect for...&quot;</span></a>
<a class="sourceLine" id="cb194-18" title="18">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb194-19" title="19"><span class="st">  </span>ggridges<span class="op">::</span><span class="kw">theme_ridges</span>(</a>
<a class="sourceLine" id="cb194-20" title="20">    <span class="dt">font_size =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb194-21" title="21">    <span class="dt">center_axis_labels =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb194-22" title="22">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb194-23" title="23"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb194-24" title="24">    <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span></a>
<a class="sourceLine" id="cb194-25" title="25">  ) </a></code></pre></div>
<p>Figure 2. Computational power analysis for a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>&#xD7;</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2\times 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">&#xD7;</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span> design.</p>
<p>Of course, we could have relied on some reasonable analytical assumptions to
arrive at these estimates without resorting to simulation (see a helpful
discussion
<a href="https://statmodeling.stat.columbia.edu/2018/03/15/need-16-times-sample-size-estimate-interaction-estimate-main-effect/">here</a>),
but running a simulation saves us the trouble.</p>
</div>
<div id="covariate-adjustment-with-the-lin-estimator" class="section level3">
<h3><span class="header-section-number">6.4.2</span> Covariate adjustment with the Lin estimator</h3>
<p>Another scenario where computational power analysis is worth the investment is
if a design calls for covariate adjustment. This is common in OES projects, and,
in several instances, the <span class="citation">Lin (<a href="#ref-lin_agnostic_2013">2013</a>)</span> saturated estimator is the analytical
solution employed.</p>
<p>Devising an off-the-shelf method to calculate power for such a study is
possible, but would likely require investing time doing background research to
ensure its accuracy. Alternatively, we could simply replicate, estimate, and
evaluate such a design computationally. The results will be just as accurate,
without the added hassle of programming the appropriate analytical solution.</p>
<p>Suppose we have a sample of 1,000 observations and a continuous outcome
variable. We wish to assess the effect of some policy intervention on this
continuous outcome. Our design calls for randomly assigning <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>=</mo><mn>250</mn></mrow><annotation encoding="application/x-tex">M = 250</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">250</span></span></span></span>
individuals to receive the intervention, and the rest to control.</p>
<p>In addition to having data on the outcome and on treatment assignment, say that
we also anticipate obtaining a dataset of covariates for our 1,000 observations.
This data contains two variables that are prognostic of the outcome. We&#x2019;ll call
these <code>z1</code> and <code>z2</code>. The first is a continuous measure; the latter a binary
indicator. Our design calls for adjusting for these covariates via the Lin
estimator to improve the precision of our estimated treatment effect. We can
simulate such a design, and further justify covariate adjustment, using the
following replication, estimation, and evaluation.</p>
<p>We begin by replicating the data-generating process:</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb195-1" title="1">rep_data &lt;-</a>
<a class="sourceLine" id="cb195-2" title="2"><span class="st">  </span><span class="kw">replicate_design</span>(</a>
<a class="sourceLine" id="cb195-3" title="3">    <span class="dt">N =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb195-4" title="4">    <span class="dt">z1 =</span> <span class="kw">rnorm</span>(N, <span class="dt">sd =</span> <span class="dv">3</span>),   <span class="co"># continuous covariate</span></a>
<a class="sourceLine" id="cb195-5" title="5">    <span class="dt">z2 =</span> <span class="kw">rbinom</span>(N, <span class="dv">1</span>, <span class="fl">0.25</span>), <span class="co"># binary covariate</span></a>
<a class="sourceLine" id="cb195-6" title="6">    <span class="dt">cz1 =</span> z1 <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(z1),     <span class="co"># make mean centered versions of the covariates</span></a>
<a class="sourceLine" id="cb195-7" title="7">    <span class="dt">cz2 =</span> z2 <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(z2),</a>
<a class="sourceLine" id="cb195-8" title="8">    <span class="dt">y =</span> <span class="fl">0.8</span> <span class="op">*</span><span class="st"> </span>z1 <span class="op">-</span><span class="st"> </span><span class="dv">1</span> <span class="op">*</span><span class="st"> </span>z2 <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(N), <span class="co"># simulate the data-generating process</span></a>
<a class="sourceLine" id="cb195-9" title="9">    <span class="dt">x =</span> <span class="kw">complete_ra</span>(N, <span class="dt">m =</span> N <span class="op">/</span><span class="st"> </span><span class="dv">4</span>) <span class="co"># randomly assign 25% of obs. to treatment</span></a>
<a class="sourceLine" id="cb195-10" title="10">  )</a></code></pre></div>
<p>We then estimate and evaluate. For comparison, power is computed both with
covariate adjustment via the Lin estimator and without covariate adjustment:</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb196-1" title="1"><span class="co"># With the Lin Estimator</span></a>
<a class="sourceLine" id="cb196-2" title="2">lin_adjust &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb196-3" title="3"><span class="st">  </span>rep_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb196-4" title="4"><span class="st">  </span><span class="kw">estimate</span>(</a>
<a class="sourceLine" id="cb196-5" title="5">    <span class="dt">form =</span> y <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>z1 <span class="op">+</span><span class="st"> </span>z2 <span class="op">+</span><span class="st"> </span>x<span class="op">:</span>cz1 <span class="op">+</span><span class="st"> </span>x<span class="op">:</span>cz2,</a>
<a class="sourceLine" id="cb196-6" title="6">    <span class="dt">vars =</span> <span class="st">&quot;x&quot;</span></a>
<a class="sourceLine" id="cb196-7" title="7">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb196-8" title="8"><span class="st">  </span><span class="kw">evaluate_power</span>(</a>
<a class="sourceLine" id="cb196-9" title="9">    <span class="dt">delta =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dt">len =</span> <span class="dv">200</span>)</a>
<a class="sourceLine" id="cb196-10" title="10">  )</a>
<a class="sourceLine" id="cb196-11" title="11"></a>
<a class="sourceLine" id="cb196-12" title="12"><span class="co"># With no Covariate Adjustment</span></a>
<a class="sourceLine" id="cb196-13" title="13">no_adjust &lt;-</a>
<a class="sourceLine" id="cb196-14" title="14"><span class="st">  </span>rep_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb196-15" title="15"><span class="st">  </span><span class="kw">estimate</span>(</a>
<a class="sourceLine" id="cb196-16" title="16">    <span class="dt">form =</span> y <span class="op">~</span><span class="st"> </span>x,</a>
<a class="sourceLine" id="cb196-17" title="17">    <span class="dt">vars =</span> <span class="st">&quot;x&quot;</span></a>
<a class="sourceLine" id="cb196-18" title="18">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb196-19" title="19"><span class="st">  </span><span class="kw">evaluate_power</span>(</a>
<a class="sourceLine" id="cb196-20" title="20">    <span class="dt">delta =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dt">len =</span> <span class="dv">200</span>)</a>
<a class="sourceLine" id="cb196-21" title="21">  )</a></code></pre></div>
<p>We can now easily compare results under these alternative empirical strategies.
Figure 3 shows the power curves for each approach. As is clear, the Lin
estimator provides substantial improvements in power. With covariate adjustment,
we&#x2019;re powered to detect an effect nearly 40% the size of the MDE without
controlling for <code>z1</code> and <code>z2</code>. And it only took a few lines of code to get this
result.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb197-1" title="1"><span class="kw">bind_rows</span>(</a>
<a class="sourceLine" id="cb197-2" title="2">  lin_adjust <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Method =</span> <span class="st">&quot;Lin&quot;</span>),</a>
<a class="sourceLine" id="cb197-3" title="3">  no_adjust <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Method =</span> <span class="st">&quot;No Covariates&quot;</span>)</a>
<a class="sourceLine" id="cb197-4" title="4">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb197-5" title="5"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb197-6" title="6"><span class="st">  </span><span class="kw">geom_line</span>(</a>
<a class="sourceLine" id="cb197-7" title="7">    <span class="kw">aes</span>(delta, power, <span class="dt">linetype =</span> Method)</a>
<a class="sourceLine" id="cb197-8" title="8">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb197-9" title="9"><span class="st">  </span><span class="kw">geom_hline</span>(</a>
<a class="sourceLine" id="cb197-10" title="10">    <span class="dt">yintercept =</span> <span class="fl">0.8</span>,</a>
<a class="sourceLine" id="cb197-11" title="11">    <span class="dt">color =</span> <span class="st">&quot;grey25&quot;</span>,</a>
<a class="sourceLine" id="cb197-12" title="12">    <span class="dt">alpha =</span> <span class="fl">0.8</span></a>
<a class="sourceLine" id="cb197-13" title="13">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb197-14" title="14"><span class="st">  </span><span class="kw">scale_y_continuous</span>(</a>
<a class="sourceLine" id="cb197-15" title="15">    <span class="dt">n.breaks =</span> <span class="dv">6</span></a>
<a class="sourceLine" id="cb197-16" title="16">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb197-17" title="17"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb197-18" title="18">    <span class="dt">x =</span> <span class="kw">expression</span>(delta),</a>
<a class="sourceLine" id="cb197-19" title="19">    <span class="dt">y =</span> <span class="st">&quot;Power&quot;</span>,</a>
<a class="sourceLine" id="cb197-20" title="20">    <span class="dt">title =</span> <span class="st">&quot;Power with Lin Adjustment&quot;</span>,</a>
<a class="sourceLine" id="cb197-21" title="21">    <span class="dt">linetype =</span> <span class="st">&quot;Method:&quot;</span></a>
<a class="sourceLine" id="cb197-22" title="22">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb197-23" title="23"><span class="st">  </span>ggridges<span class="op">::</span><span class="kw">theme_ridges</span>(</a>
<a class="sourceLine" id="cb197-24" title="24">    <span class="dt">font_size =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb197-25" title="25">    <span class="dt">center_axis_labels =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb197-26" title="26">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb197-27" title="27"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb197-28" title="28">    <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span></a>
<a class="sourceLine" id="cb197-29" title="29">  ) </a></code></pre></div>
<p><img src="OES_SOP_files/figure-html/unnamed-chunk-30-1.png" width=".9\textwidth"></p>
<p>Figure 3. Simulating power with the Lin estimator.</p>
</div>
<div id="incorporating-declaredesign-into-oes-power-tools" class="section level3">
<h3><span class="header-section-number">6.4.3</span> Incorporating DeclareDesign into OES Power Tools</h3>
<p>We can also use <code>DeclareDesign</code> within the <em>Replicate</em>, <em>Estimate</em>, <em>Evaluate</em> framework. This involves using <code>DeclareDesign</code> to draw estimates, and then feeding the results into the OES <code>evaluate_power()</code> function. We compare the <code>DeclareDesign</code> approach to the OES <code>Replicate</code> and <code>Estimate</code> steps below.</p>
<p>First, we simulate a simple design with the OES tools:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb198-1" title="1">eval &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb198-2" title="2"><span class="st">  </span><span class="kw">replicate_design</span>(</a>
<a class="sourceLine" id="cb198-3" title="3">    <span class="dt">R =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb198-4" title="4">    <span class="dt">N =</span> <span class="dv">100</span>,</a>
<a class="sourceLine" id="cb198-5" title="5">    <span class="dt">Y =</span> <span class="kw">rnorm</span>(N),</a>
<a class="sourceLine" id="cb198-6" title="6">    <span class="dt">Z =</span> <span class="kw">rbinom</span>(N, <span class="dv">1</span>, <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb198-7" title="7">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb198-8" title="8"><span class="st">  </span><span class="kw">estimate</span>(</a>
<a class="sourceLine" id="cb198-9" title="9">    <span class="dt">form =</span> Y <span class="op">~</span><span class="st"> </span>Z, <span class="dt">vars =</span> <span class="st">&quot;Z&quot;</span></a>
<a class="sourceLine" id="cb198-10" title="10">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb198-11" title="11"><span class="st">  </span><span class="kw">evaluate_power</span>(</a>
<a class="sourceLine" id="cb198-12" title="12">    <span class="dt">delta =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.6</span>, <span class="dt">len =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb198-13" title="13">  )</a></code></pre></div>
<p>Then, we do the same with <code>DeclareDesign</code>, declaring a population, potential outcomes, assignments, a target quantity of interest, and an estimator:</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb199-1" title="1">design &lt;-<span class="st"> </span><span class="kw">declare_population</span>(</a>
<a class="sourceLine" id="cb199-2" title="2">  <span class="dt">N =</span> <span class="dv">100</span>,</a>
<a class="sourceLine" id="cb199-3" title="3">  <span class="dt">U =</span> <span class="kw">rnorm</span>(N)</a>
<a class="sourceLine" id="cb199-4" title="4">) <span class="op">+</span></a>
<a class="sourceLine" id="cb199-5" title="5"><span class="st">  </span><span class="kw">declare_potential_outcomes</span>(</a>
<a class="sourceLine" id="cb199-6" title="6">    Y <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">*</span><span class="st"> </span>Z <span class="op">+</span><span class="st"> </span>U</a>
<a class="sourceLine" id="cb199-7" title="7">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb199-8" title="8"><span class="st">  </span><span class="kw">declare_assignment</span>(<span class="dt">Z=</span><span class="kw">complete_ra</span>(N,</a>
<a class="sourceLine" id="cb199-9" title="9">    <span class="dt">prob =</span> <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb199-10" title="10">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb199-11" title="11"><span class="st">  </span><span class="kw">declare_inquiry</span>(<span class="dt">ATE =</span> <span class="kw">mean</span>(Y_Z_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>Y_Z_<span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb199-12" title="12"><span class="st">  </span><span class="kw">declare_measurement</span>(<span class="dt">Y =</span> <span class="kw">reveal_outcomes</span>(Y <span class="op">~</span><span class="st"> </span>Z)) <span class="op">+</span></a>
<a class="sourceLine" id="cb199-13" title="13"><span class="st">  </span><span class="kw">declare_estimator</span>(</a>
<a class="sourceLine" id="cb199-14" title="14">    Y <span class="op">~</span><span class="st"> </span>Z, <span class="dt">inquiry =</span> <span class="st">&quot;ATE&quot;</span>,</a>
<a class="sourceLine" id="cb199-15" title="15">    <span class="dt">model =</span> lm_robust</a>
<a class="sourceLine" id="cb199-16" title="16">  )</a></code></pre></div>
<p>We then use draws from this design within the OES tools:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb200-1" title="1">dd_eval &lt;-<span class="st"> </span><span class="kw">replicate</span>(</a>
<a class="sourceLine" id="cb200-2" title="2">  <span class="dt">n =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb200-3" title="3">  <span class="dt">expr =</span> <span class="kw">draw_estimates</span>(design) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb200-4" title="4"><span class="st">    </span>list</a>
<a class="sourceLine" id="cb200-5" title="5">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb200-6" title="6"><span class="st">  </span><span class="kw">bind_rows</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb200-7" title="7"><span class="st">  </span><span class="kw">evaluate_power</span>(</a>
<a class="sourceLine" id="cb200-8" title="8">    <span class="dt">delta =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.6</span>, <span class="dt">len =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb200-9" title="9">  )</a></code></pre></div>
<p>We show the similarity between the two approaches to generating the simulated
data in the figure below.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb201-1" title="1"><span class="kw">bind_rows</span>(</a>
<a class="sourceLine" id="cb201-2" title="2">  eval <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">method =</span> <span class="st">&quot;OES Power Tools&quot;</span>),</a>
<a class="sourceLine" id="cb201-3" title="3">  dd_eval <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">method =</span> <span class="st">&quot;DeclareDesign&quot;</span>)</a>
<a class="sourceLine" id="cb201-4" title="4">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb201-5" title="5"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb201-6" title="6"><span class="st">  </span><span class="kw">geom_line</span>(</a>
<a class="sourceLine" id="cb201-7" title="7">    <span class="kw">aes</span>(delta, power, <span class="dt">linetype =</span> method)</a>
<a class="sourceLine" id="cb201-8" title="8">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb201-9" title="9"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb201-10" title="10">    <span class="dt">x =</span> <span class="kw">expression</span>(delta),</a>
<a class="sourceLine" id="cb201-11" title="11">    <span class="dt">y =</span> <span class="st">&quot;Power&quot;</span>,</a>
<a class="sourceLine" id="cb201-12" title="12">    <span class="dt">linetype =</span> <span class="ot">NULL</span></a>
<a class="sourceLine" id="cb201-13" title="13">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb201-14" title="14"><span class="st">  </span><span class="kw">scale_y_continuous</span>(</a>
<a class="sourceLine" id="cb201-15" title="15">    <span class="dt">n.breaks =</span> <span class="dv">6</span></a>
<a class="sourceLine" id="cb201-16" title="16">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb201-17" title="17"><span class="st">  </span><span class="kw">geom_hline</span>(</a>
<a class="sourceLine" id="cb201-18" title="18">    <span class="dt">yintercept =</span> <span class="fl">0.8</span>,</a>
<a class="sourceLine" id="cb201-19" title="19">    <span class="dt">col =</span> <span class="st">&quot;grey25&quot;</span>,</a>
<a class="sourceLine" id="cb201-20" title="20">    <span class="dt">size =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb201-21" title="21">    <span class="dt">alpha =</span> <span class="fl">0.8</span></a>
<a class="sourceLine" id="cb201-22" title="22">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb201-23" title="23"><span class="st">  </span>ggridges<span class="op">::</span><span class="kw">theme_ridges</span>(</a>
<a class="sourceLine" id="cb201-24" title="24">    <span class="dt">center_axis_labels =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb201-25" title="25">    <span class="dt">font_size =</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb201-26" title="26">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb201-27" title="27"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb201-28" title="28">    <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span></a>
<a class="sourceLine" id="cb201-29" title="29">  )</a></code></pre></div>
<p><img src="OES_SOP_files/figure-html/unnamed-chunk-34-1.png" width=".9\textwidth"></p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-lin_agnostic_2013">
<p>Lin, Winston. 2013. &#x201C;Agnostic Notes on Regression Adjustments to Experimental Data: Reexamining Freedman&#x2019;s Critique.&#x201D; <em>The Annals of Applied Statistics</em> 7 (1): 295&#x2013;318.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="analysis-choices.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="working-with-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/gsa-oes/sop/edit/master/Book/055-poweranalysis.Rmd",
"text": "Edit"
},
"download": ["OES_SOP.pdf", "OES_SOP.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
