<!DOCTYPE html>
<html>

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>OES Standard Operating Procedures for The Design and Statistical Analysis of Experiments.</title>
  <meta name="description" content="These are the current standard operating procedures for statistical analysis of the Office of Evaluation Sciences in the GSA">
  <meta name="generator" content="bookdown &lt;!--bookdown:version--&gt; and GitBook 2.6.7">

  <meta property="og:title" content="OES Standard Operating Procedures for The Design and Statistical Analysis of Experiments.">
  <meta property="og:type" content="book">
  
  
  <meta property="og:description" content="These are the current standard operating procedures for statistical analysis of the Office of Evaluation Sciences in the GSA">
  <meta name="github-repo" content="gsa-oes/sop">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="OES Standard Operating Procedures for The Design and Statistical Analysis of Experiments.">
  
  <meta name="twitter:description" content="These are the current standard operating procedures for statistical analysis of the Office of Evaluation Sciences in the GSA">
  

<meta name="author" content="Jake Bowers, Ryan T. Moore, Lula Chen, Paul Testa, Nate Higgins, Oliver McClellan, Miles Williams, Tyler Simko, Bill Schultz">


<meta name="date" content="2023-11-01">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="analysis-choices.html">
<link rel="next" href="glossary-of-terms.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet">







<script src="libs/kePrint/kePrint.js"></script>
<link href="libs/lightable/lightable.css" rel="stylesheet">

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}
</script>
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
.row { display: flex; }
.collapse { display: none; }
.in { display:block }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/katex.min.css" data-external="1"></head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The OES SOP</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#purposes-of-this-document"><i class="fa fa-check"></i>Purposes of this document</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#nature-and-limitations-of-this-document"><i class="fa fa-check"></i>Nature and limitations of this document</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#we-mostly-focus-on-randomized-field-experiments."><i class="fa fa-check"></i>We (mostly) focus on randomized field experiments.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#we-present-examples-using-r"><i class="fa fa-check"></i>We present examples using R</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#structure-of-the-document"><i class="fa fa-check"></i>Structure of the document</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#help-us-improve-our-work"><i class="fa fa-check"></i>Help us improve our work!</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-document"><i class="fa fa-check"></i>About this document</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="statistical-and-causal-inference-for-policy-change.html"><a href="statistical-and-causal-inference-for-policy-change.html"><i class="fa fa-check"></i><b>1</b> Statistical and causal inference for policy change</a></li>
<li class="chapter" data-level="2" data-path="basics-of-experimental-design-and-analysis.html"><a href="basics-of-experimental-design-and-analysis.html"><i class="fa fa-check"></i><b>2</b> Basics of Experimental Design and Analysis</a><ul>
<li class="chapter" data-level="2.1" data-path="basics-of-experimental-design-and-analysis.html"><a href="basics-of-experimental-design-and-analysis.html#statistical-power-designing-studies-that-effectively-distinguish-signal-from-noise"><i class="fa fa-check"></i><b>2.1</b> Statistical power: Designing Studies that effectively distinguish signal from noise</a></li>
<li class="chapter" data-level="2.2" data-path="basics-of-experimental-design-and-analysis.html"><a href="basics-of-experimental-design-and-analysis.html#error-rates-of-tests"><i class="fa fa-check"></i><b>2.2</b> Error Rates of Tests</a></li>
<li class="chapter" data-level="2.3" data-path="basics-of-experimental-design-and-analysis.html"><a href="basics-of-experimental-design-and-analysis.html#bias-in-estimators"><i class="fa fa-check"></i><b>2.3</b> Bias in Estimators</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="design-based-principles-of-statistical-inference.html"><a href="design-based-principles-of-statistical-inference.html"><i class="fa fa-check"></i><b>3</b> Design-Based Principles of Statistical Inference</a><ul>
<li class="chapter" data-level="3.1" data-path="design-based-principles-of-statistical-inference.html"><a href="design-based-principles-of-statistical-inference.html#randinfex"><i class="fa fa-check"></i><b>3.1</b> An example using simulated data</a><ul>
<li class="chapter" data-level="3.1.1" data-path="design-based-principles-of-statistical-inference.html"><a href="design-based-principles-of-statistical-inference.html#how-do-we-calculate-randomization-based-standard-errors"><i class="fa fa-check"></i><b>3.1.1</b> How do we calculate randomization-based standard errors?</a></li>
<li class="chapter" data-level="3.1.2" data-path="design-based-principles-of-statistical-inference.html"><a href="design-based-principles-of-statistical-inference.html#how-do-we-calculate-randomization-based-confidence-intervals"><i class="fa fa-check"></i><b>3.1.2</b> How do we calculate randomization-based confidence intervals?</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="design-based-principles-of-statistical-inference.html"><a href="design-based-principles-of-statistical-inference.html#summary-what-does-a-design-based-approach-mean-for-policy-evaluation"><i class="fa fa-check"></i><b>3.2</b> Summary: What does a design based approach mean for policy evaluation?</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="randomization-and-design.html"><a href="randomization-and-design.html"><i class="fa fa-check"></i><b>4</b> Randomization and Design</a><ul>
<li class="chapter" data-level="4.1" data-path="randomization-and-design.html"><a href="randomization-and-design.html#coin-flipping-randomization-versus-urn-drawing-randomization"><i class="fa fa-check"></i><b>4.1</b> Coin flipping randomization versus urn-drawing randomization</a></li>
<li class="chapter" data-level="4.2" data-path="randomization-and-design.html"><a href="randomization-and-design.html#urn-drawing-or-complete-randomization-into-2-or-more-groups"><i class="fa fa-check"></i><b>4.2</b> Urn-drawing or complete randomization into 2 or more groups</a></li>
<li class="chapter" data-level="4.3" data-path="randomization-and-design.html"><a href="randomization-and-design.html#factorial-designs"><i class="fa fa-check"></i><b>4.3</b> Factorial Designs</a></li>
<li class="chapter" data-level="4.4" data-path="randomization-and-design.html"><a href="randomization-and-design.html#block-random-assignment"><i class="fa fa-check"></i><b>4.4</b> Block Random Assignment</a><ul>
<li class="chapter" data-level="4.4.1" data-path="randomization-and-design.html"><a href="randomization-and-design.html#using-only-a-few-covariates-to-create-blocks"><i class="fa fa-check"></i><b>4.4.1</b> Using only a few covariates to create blocks</a></li>
<li class="chapter" data-level="4.4.2" data-path="randomization-and-design.html"><a href="randomization-and-design.html#multivariate-blocking-using-many-covariates"><i class="fa fa-check"></i><b>4.4.2</b> Multivariate blocking using many covariates</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="randomization-and-design.html"><a href="randomization-and-design.html#cluster-random-assignment"><i class="fa fa-check"></i><b>4.5</b> Cluster random assignment</a></li>
<li class="chapter" data-level="4.6" data-path="randomization-and-design.html"><a href="randomization-and-design.html#other-designs"><i class="fa fa-check"></i><b>4.6</b> Other designs</a></li>
<li class="chapter" data-level="4.7" data-path="randomization-and-design.html"><a href="randomization-and-design.html#assessing-randomization-balance-testing"><i class="fa fa-check"></i><b>4.7</b> Assessing randomization (balance testing)</a><ul>
<li class="chapter" data-level="4.7.1" data-path="randomization-and-design.html"><a href="randomization-and-design.html#what-to-do-with-failed-randomization-assessments"><i class="fa fa-check"></i><b>4.7.1</b> What to do with &#x201C;failed&#x201D; randomization assessments?</a></li>
<li class="chapter" data-level="4.7.2" data-path="randomization-and-design.html"><a href="randomization-and-design.html#minimizing-the-chances-of-failed-randomization"><i class="fa fa-check"></i><b>4.7.2</b> Minimizing the chances of &#x201C;failed&#x201D; randomization</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="analysis-choices.html"><a href="analysis-choices.html"><i class="fa fa-check"></i><b>5</b> Analysis Choices</a><ul>
<li class="chapter" data-level="5.1" data-path="analysis-choices.html"><a href="analysis-choices.html#completely-or-urn-draw-randomized-trials"><i class="fa fa-check"></i><b>5.1</b> Completely or Urn-Draw Randomized Trials</a><ul>
<li class="chapter" data-level="5.1.1" data-path="analysis-choices.html"><a href="analysis-choices.html#two-arms"><i class="fa fa-check"></i><b>5.1.1</b> Two arms</a></li>
<li class="chapter" data-level="5.1.2" data-path="analysis-choices.html"><a href="analysis-choices.html#multiple-arms"><i class="fa fa-check"></i><b>5.1.2</b> Multiple arms</a></li>
<li class="chapter" data-level="5.1.3" data-path="analysis-choices.html"><a href="analysis-choices.html#multiple-outcomes"><i class="fa fa-check"></i><b>5.1.3</b> Multiple Outcomes</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="analysis-choices.html"><a href="analysis-choices.html#covariance-adjustment-the-use-of-background-information-to-increase-precision"><i class="fa fa-check"></i><b>5.2</b> Covariance adjustment (the use of background information to increase precision)</a><ul>
<li class="chapter" data-level="5.2.1" data-path="analysis-choices.html"><a href="analysis-choices.html#intuition-about-bias-in-the-least-squares-estimator-of-the-ate-with-covariates"><i class="fa fa-check"></i><b>5.2.1</b> Intuition about bias in the least squares estimator of the ATE with covariates</a></li>
<li class="chapter" data-level="5.2.2" data-path="analysis-choices.html"><a href="analysis-choices.html#illustrating-the-lin-approach-to-covariance-adjustment"><i class="fa fa-check"></i><b>5.2.2</b> Illustrating the Lin Approach to Covariance Adjustment</a></li>
<li class="chapter" data-level="5.2.3" data-path="analysis-choices.html"><a href="analysis-choices.html#the-rosenbaum-approach-to-covariance-adjustment"><i class="fa fa-check"></i><b>5.2.3</b> The Rosenbaum Approach to Covariance Adjustment</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="analysis-choices.html"><a href="analysis-choices.html#how-to-choose-covariates-for-covariance-adjustment"><i class="fa fa-check"></i><b>5.3</b> How to choose covariates for covariance adjustment?</a></li>
<li class="chapter" data-level="5.4" data-path="analysis-choices.html"><a href="analysis-choices.html#blockrandanalysis"><i class="fa fa-check"></i><b>5.4</b> Block-randomized trials</a><ul>
<li class="chapter" data-level="5.4.1" data-path="analysis-choices.html"><a href="analysis-choices.html#testing-binary-outcomes-under-block-randomization-cochran-mantel-haenszel-cmh-test-for-k-x-2-x-2-tables"><i class="fa fa-check"></i><b>5.4.1</b> Testing binary outcomes under block randomization: Cochran-Mantel-Haenszel (CMH) test for K X 2 X 2 tables</a></li>
<li class="chapter" data-level="5.4.2" data-path="analysis-choices.html"><a href="analysis-choices.html#blockrandate"><i class="fa fa-check"></i><b>5.4.2</b> Estimating an overall average treatment effect</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="analysis-choices.html"><a href="analysis-choices.html#clusterrandanalysis"><i class="fa fa-check"></i><b>5.5</b> Cluster-randomized trials</a><ul>
<li class="chapter" data-level="5.5.1" data-path="analysis-choices.html"><a href="analysis-choices.html#bias-when-cluster-size-is-correlated-with-potential-outcomes"><i class="fa fa-check"></i><b>5.5.1</b> Bias when cluster size is correlated with potential outcomes</a></li>
<li class="chapter" data-level="5.5.2" data-path="analysis-choices.html"><a href="analysis-choices.html#incorrect-false-positive-rates-from-tests-and-confidence-intervals"><i class="fa fa-check"></i><b>5.5.2</b> Incorrect false positive rates from tests and confidence intervals</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="poweranalysis.html"><a href="poweranalysis.html"><i class="fa fa-check"></i><b>6</b> Power Analysis</a><ul>
<li class="chapter" data-level="6.1" data-path="poweranalysis.html"><a href="poweranalysis.html#an-example-of-the-off-the-shelf-approach"><i class="fa fa-check"></i><b>6.1</b> An example of the off-the-shelf approach</a></li>
<li class="chapter" data-level="6.2" data-path="poweranalysis.html"><a href="poweranalysis.html#an-example-of-the-simulation-approach"><i class="fa fa-check"></i><b>6.2</b> An example of the simulation approach</a></li>
<li class="chapter" data-level="6.3" data-path="poweranalysis.html"><a href="poweranalysis.html#when-to-use-which-approach"><i class="fa fa-check"></i><b>6.3</b> When to use which approach</a></li>
<li class="chapter" data-level="6.4" data-path="poweranalysis.html"><a href="poweranalysis.html#additional-examples-of-the-simulation-approach"><i class="fa fa-check"></i><b>6.4</b> Additional examples of the simulation approach</a><ul>
<li class="chapter" data-level="6.4.1" data-path="poweranalysis.html"><a href="poweranalysis.html#a-two-by-two-design-with-interaction"><i class="fa fa-check"></i><b>6.4.1</b> A two-by-two design with interaction</a></li>
<li class="chapter" data-level="6.4.2" data-path="poweranalysis.html"><a href="poweranalysis.html#covariate-adjustment-with-the-lin-estimator"><i class="fa fa-check"></i><b>6.4.2</b> Covariate adjustment with the Lin estimator</a></li>
<li class="chapter" data-level="6.4.3" data-path="poweranalysis.html"><a href="poweranalysis.html#incorporating-declaredesign-into-oes-power-tools"><i class="fa fa-check"></i><b>6.4.3</b> Incorporating DeclareDesign into OES Power Tools</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="glossary-of-terms.html"><a href="glossary-of-terms.html"><i class="fa fa-check"></i><b>7</b> <span>Glossary of Terms</span></a></li>
<li class="chapter" data-level="8" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>8</b> <span>Appendix</span></a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://oes.gsa.gov" target="blank">Published by the OES</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">OES Standard Operating Procedures for The Design and Statistical Analysis of Experiments.</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="poweranalysis" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Power Analysis</h1>
<p>In this chapter, we provide examples of how we assess statistical power for different experimental research designs. We often prefer to use simulation to assess the power of different research designs because we rarely have designs that fit easily into the assumptions made by analytic tools.</p>
<p>By &#x201C;analytic tools,&#x201D; we refer to methods of calculating power (or a minimum required sample size, etc.) based on mathematical derivations under particular assumptions. For instance, in an <em>i.i.d.</em> two-arm design with random assignment of half the sample, no covariates, a roughly normally distributed outcome, and equal variance in each treatment group, it&#x2019;s possible show that we would have 80% power to estimate a difference in means of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">&#x394;</mi></mrow><annotation encoding="application/x-tex">\Delta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">&#x394;</span></span></span></span> if we collect data on approximately <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mo stretchy="false">(</mo><mn>5.6</mn><mi>&#x3C3;</mi><mi mathvariant="normal">/</mi><mi mathvariant="normal">&#x394;</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">n = (5.6 \sigma /\Delta)^{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">5.6</span><span class="mord mathnormal" style="margin-right:0.03588em;">&#x3C3;</span><span class="mord">/&#x394;</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span> observations, where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>&#x3C3;</mi></mrow><annotation encoding="application/x-tex">\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">&#x3C3;</span></span></span></span> is the overall standard deviation of the outcome.<a href="references.html#fn28" class="footnote-ref" id="fnref28"><sup>28</sup></a> But we frequently consider situations where such derivations are not readily available.</p>
<!-- I'm not sure this introductory example is useful, in that it doesn't show what we claimed to want (that analytical and simulation yield the same results in a simple example; I cut this text [Bill] in my recent edit) due to the skewed nature of this outcome. For the purposes of this walkthrough, I think skew is a complication we want to put aside? And also, both designs have power of basically 100% with this example data, so the description in the text is no longer accurate. So let's just jump to the more detailed examples of each approach below?  -->
<!-- Imagine that we thought a study would have an effect of about 1 standard deviation -- this is more or less the effect difference in the example data we've been using. How much statistical power would we have with a sample size of only 40 observations? -->
<!-- Now that the setup is complete, we can assess the statistical power of our -->
<!-- proposed design with $N=100$ and an effect of roughly 1 SD. The output below -->
<!-- shows the statistical power as well as the false positive rate (called -->
<!-- "Coverage" below), as well as the difference between the mean difference we -->
<!-- calculate and the true average treatment effect (called "Bias" below). -->
<!-- Initially, this analytic approach suggests more power than the simulation based approach -- a difference that arises from our fairly skewed outcome. -->
<!-- For ways to compare different sample sizes, effect sizes, etc. see [more -->
<!-- information from the DeclareDesign -->
<!-- package](https://declaredesign.org/blog/2018-10-02-power-strategies.html). -->
<div id="an-example-of-the-off-the-shelf-approach" class="section level2">
<h2><span class="header-section-number">6.1</span> An example of the off-the-shelf approach</h2>
<p>To demonstrate how analytical power analysis works in principle, consider the R function <code>power.t.test()</code>. This can be used for power calculations in designs where a two-sample t-test is an appropriate estimation strategy (with no adjustment for blocking, clustering, or covariates).</p>
<p>When using this function, there are three parameters that we&#x2019;re most concerned
with, two of which must be specified by the user. The third is then calculated and returned by the function. These are:</p>
<ul>
<li><code>n</code> = sample size, or number of observations <em>per treatment group</em></li>
<li><code>delta</code> = the target effect size, or a minimum detectable effect (MDE)</li>
<li><code>power</code> = the probability of detecting an effect if in fact there is a true effect of size <code>delta</code></li>
</ul>
<p>Note that there is also the parameter <code>sd</code>, representing the standard deviation of the outcome. This is set to 1 by default unless <code>power.t.test()</code> is instructed otherwise.</p>
<p>Say, for example, you want to know the MDE for a two-arm study with 1,000
participants, of which half are assigned to treatment. Using <code>power.t.test()</code> you would specify:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" title="1"><span class="kw">power.t.test</span>(</a>
<a class="sourceLine" id="cb160-2" title="2">  <span class="dt">n =</span> <span class="dv">500</span>, <span class="co"># The number of observations per treatment arm</span></a>
<a class="sourceLine" id="cb160-3" title="3">  <span class="dt">power =</span> <span class="fl">0.8</span> <span class="co"># The traditional power threshold of 80%</span></a>
<a class="sourceLine" id="cb160-4" title="4">  )</a></code></pre></div>
<pre><code>
     Two-sample t test power calculation 

              n = 500
          delta = 0.1774
             sd = 1
      sig.level = 0.05
          power = 0.8
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
<p>If all we wanted to extract was the MDE, we could instead write:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" title="1"><span class="kw">power.t.test</span>(<span class="dt">n =</span> <span class="dv">500</span>, <span class="dt">power =</span> <span class="fl">0.8</span>)<span class="op">$</span>delta</a></code></pre></div>
<pre><code>[1] 0.1774</code></pre>
<p>If we request the sample size instead, we can illustrate that this is applying an expression like the one we mention above: <span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>n</mi><mo>=</mo><mo stretchy="false">(</mo><mn>5.6</mn><mi mathvariant="normal">/</mi><mn>0.1773605</mn><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>&#x2248;</mo><mn>1000</mn></mrow><annotation encoding="application/x-tex">n = (5.6/0.1773605)^{2} \approx 1000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">5.6/0.1773605</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&#x2248;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1000</span></span></span></span></span></p>
<p>And now via R code:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" title="1"><span class="kw">power.t.test</span>(<span class="dt">delta =</span> <span class="fl">0.1773605</span>, <span class="dt">power =</span> <span class="fl">0.8</span>)<span class="op">$</span>n <span class="op">*</span><span class="st"> </span><span class="dv">2</span></a></code></pre></div>
<pre><code>[1] 1000</code></pre>
<p>If you need to, you can adjust other parameters, like the standard deviation of the outcome, the level of the test, or whether the test is one-sided rather than two-sided. There are also other functions available for different types of outcomes. For example, if you have a binary response, you can use <code>power.prop.test()</code> to calculate power for a similar kind of simple difference in proportions test.</p>
<p>An equivalent approach in Stata is as follows:</p>
<pre><code>power twomeans 0, power(0.8) n(1000) sd(1)</code></pre>
<p>Stata users can learn more about available tools by checking out Stata&#x2019;s
plethora of <a href="https://www.stata.com/features/power-and-sample-size/">relevant help files</a>.</p>
</div>
<div id="an-example-of-the-simulation-approach" class="section level2">
<h2><span class="header-section-number">6.2</span> An example of the simulation approach</h2>
<p>We can compare the output of <code>power.t.test()</code> to the output from a
simulation-based (i.e., computational) approach, which we illustrate in the code chunk below. Notice that our example below relies on manually-written functions that could be copied and adapted by OES team members to the needs of different projects. This code is more detailed than we need for simple cases, but it provides useful flexibility for simulating more complicated designs (particularly designs we cannot specify as easily within the <code>DeclareDesign</code> framework).</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" title="1"><span class="co">## OES Power Simulation Toolkit:</span></a>
<a class="sourceLine" id="cb167-2" title="2"><span class="co">## Replicate, Estimate, Evaluate (REE)</span></a>
<a class="sourceLine" id="cb167-3" title="3"><span class="co">## </span></a>
<a class="sourceLine" id="cb167-4" title="4"><span class="co">## replicate_design(...) ---: Generate replicates of a simulated dataset</span></a>
<a class="sourceLine" id="cb167-5" title="5"><span class="co">## estimate(...) -----------: Estimate the null test-stat for treatment(s).</span></a>
<a class="sourceLine" id="cb167-6" title="6"><span class="co">## evaluate_power(...) -----: Evaluate power to detect non-zero effects.</span></a>
<a class="sourceLine" id="cb167-7" title="7"><span class="co">## evaluate_mde(...) -------: Find MDE, searching over range of effect sizes.</span></a>
<a class="sourceLine" id="cb167-8" title="8"><span class="co">## evaluate_bias(...) ------: Compute bias and other diagnostics.</span></a>
<a class="sourceLine" id="cb167-9" title="9"></a>
<a class="sourceLine" id="cb167-10" title="10"><span class="co">## Required packages</span></a>
<a class="sourceLine" id="cb167-11" title="11"><span class="kw">require</span>(magrittr)</a>
<a class="sourceLine" id="cb167-12" title="12"><span class="kw">require</span>(fabricatr)</a>
<a class="sourceLine" id="cb167-13" title="13"><span class="kw">require</span>(foreach)</a>
<a class="sourceLine" id="cb167-14" title="14"></a>
<a class="sourceLine" id="cb167-15" title="15"><span class="co">##### REPLICATE a hypothetical design R times #####</span></a>
<a class="sourceLine" id="cb167-16" title="16"></a>
<a class="sourceLine" id="cb167-17" title="17"><span class="co"># Inputs:</span></a>
<a class="sourceLine" id="cb167-18" title="18"><span class="co"># - (1) number of replicates desired</span></a>
<a class="sourceLine" id="cb167-19" title="19"><span class="co"># - (2) additional arguments that are passed to fabricate() (see the ...).</span></a>
<a class="sourceLine" id="cb167-20" title="20"><span class="co">#   - Generally, each arg is a separate variable to generate.</span></a>
<a class="sourceLine" id="cb167-21" title="21"><span class="co">#   - Later vars can be a function of earlier ones.</span></a>
<a class="sourceLine" id="cb167-22" title="22"><span class="co">#   - See our examples below, it&apos;s simpler than it sounds!</span></a>
<a class="sourceLine" id="cb167-23" title="23">replicate_design &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb167-24" title="24"><span class="st">  </span></a>
<a class="sourceLine" id="cb167-25" title="25"><span class="st">  </span><span class="cf">function</span>(<span class="dt">R =</span> <span class="dv">200</span>, ...) {</a>
<a class="sourceLine" id="cb167-26" title="26">    </a>
<a class="sourceLine" id="cb167-27" title="27">    <span class="co"># Function: produce one draw of the simulated dataset/design</span></a>
<a class="sourceLine" id="cb167-28" title="28">    design &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb167-29" title="29">      fabricatr<span class="op">::</span><span class="kw">fabricate</span>(</a>
<a class="sourceLine" id="cb167-30" title="30">        ...</a>
<a class="sourceLine" id="cb167-31" title="31">        ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-32" title="32"><span class="st">        </span>list</a>
<a class="sourceLine" id="cb167-33" title="33">      }    </a>
<a class="sourceLine" id="cb167-34" title="34">    </a>
<a class="sourceLine" id="cb167-35" title="35">    <span class="co"># Use replicate() to replicate that design R times</span></a>
<a class="sourceLine" id="cb167-36" title="36">    rep &lt;-<span class="st"> </span><span class="kw">replicate</span>(</a>
<a class="sourceLine" id="cb167-37" title="37">      <span class="dt">n =</span> R,</a>
<a class="sourceLine" id="cb167-38" title="38">      <span class="dt">expr =</span> <span class="kw">design</span>()</a>
<a class="sourceLine" id="cb167-39" title="39">      )</a>
<a class="sourceLine" id="cb167-40" title="40">    </a>
<a class="sourceLine" id="cb167-41" title="41">    <span class="co"># Output will be a list of dataframes.</span></a>
<a class="sourceLine" id="cb167-42" title="42">    <span class="co"># For each, add a variable indicating which sim# it is</span></a>
<a class="sourceLine" id="cb167-43" title="43">    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(rep)) {</a>
<a class="sourceLine" id="cb167-44" title="44">      rep[[i]] &lt;-<span class="st"> </span>rep[[i]] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-45" title="45"><span class="st">        </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb167-46" title="46">          <span class="dt">sim =</span> i</a>
<a class="sourceLine" id="cb167-47" title="47">        )</a>
<a class="sourceLine" id="cb167-48" title="48">      }</a>
<a class="sourceLine" id="cb167-49" title="49">    </a>
<a class="sourceLine" id="cb167-50" title="50">    <span class="kw">return</span>(rep)</a>
<a class="sourceLine" id="cb167-51" title="51">    </a>
<a class="sourceLine" id="cb167-52" title="52">  }</a>
<a class="sourceLine" id="cb167-53" title="53"></a>
<a class="sourceLine" id="cb167-54" title="54"><span class="co">##### ESTIMATE results using those replicated dfs #####</span></a>
<a class="sourceLine" id="cb167-55" title="55"></a>
<a class="sourceLine" id="cb167-56" title="56"><span class="co"># Inputs:</span></a>
<a class="sourceLine" id="cb167-57" title="57"><span class="co"># - (1) Estimation formula (y ~ x1 + x2 + ...)</span></a>
<a class="sourceLine" id="cb167-58" title="58"><span class="co"># - (2) Variables(s) we want to be powered to estimate the effects of</span></a>
<a class="sourceLine" id="cb167-59" title="59"><span class="co">#     - Generally just the treatment var(s)</span></a>
<a class="sourceLine" id="cb167-60" title="60"><span class="co"># - (3) Data the estimator should be applied to (list of dfs)</span></a>
<a class="sourceLine" id="cb167-61" title="61"><span class="co"># - (4) The estimator (the default is OLS with HC2 errors)</span></a>
<a class="sourceLine" id="cb167-62" title="62">estimate &lt;-<span class="st"> </span><span class="cf">function</span>(</a>
<a class="sourceLine" id="cb167-63" title="63">  formula,</a>
<a class="sourceLine" id="cb167-64" title="64">  vars,</a>
<a class="sourceLine" id="cb167-65" title="65">  <span class="dt">data =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb167-66" title="66">  <span class="dt">estimator =</span> estimatr<span class="op">::</span>lm_robust</a>
<a class="sourceLine" id="cb167-67" title="67">  ) {</a>
<a class="sourceLine" id="cb167-68" title="68"></a>
<a class="sourceLine" id="cb167-69" title="69">  <span class="co"># Pass the list of dfs to map().</span></a>
<a class="sourceLine" id="cb167-70" title="70">  <span class="co"># map() applies the procedure specified below to each df in the list.</span></a>
<a class="sourceLine" id="cb167-71" title="71">  data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-72" title="72"><span class="st">    </span></a>
<a class="sourceLine" id="cb167-73" title="73"><span class="st">    </span>purrr<span class="op">::</span><span class="kw">map</span>(</a>
<a class="sourceLine" id="cb167-74" title="74">      </a>
<a class="sourceLine" id="cb167-75" title="75">      <span class="co"># For each dataframe in the list, apply the specified estimator,</span></a>
<a class="sourceLine" id="cb167-76" title="76">      <span class="co"># using the specified formula.</span></a>
<a class="sourceLine" id="cb167-77" title="77">      <span class="op">~</span><span class="st"> </span><span class="kw">estimator</span>(</a>
<a class="sourceLine" id="cb167-78" title="78">          formula,</a>
<a class="sourceLine" id="cb167-79" title="79">          <span class="dt">data =</span> .</a>
<a class="sourceLine" id="cb167-80" title="80">          ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-81" title="81"><span class="st">        </span></a>
<a class="sourceLine" id="cb167-82" title="82"><span class="st">        </span><span class="co"># tidy up the results and specify the rows of estimates to keep</span></a>
<a class="sourceLine" id="cb167-83" title="83"><span class="st">        </span>estimatr<span class="op">::</span><span class="kw">tidy</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-84" title="84"><span class="st">          </span>dplyr<span class="op">::</span><span class="kw">filter</span>(</a>
<a class="sourceLine" id="cb167-85" title="85">            .data<span class="op">$</span>term <span class="op">%in%</span><span class="st"> </span>vars</a>
<a class="sourceLine" id="cb167-86" title="86">            ) </a>
<a class="sourceLine" id="cb167-87" title="87">      </a>
<a class="sourceLine" id="cb167-88" title="88">      ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-89" title="89"><span class="st">    </span></a>
<a class="sourceLine" id="cb167-90" title="90"><span class="st">    </span><span class="co"># Append the results from each sim replicate into a single dataframe</span></a>
<a class="sourceLine" id="cb167-91" title="91"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">bind_rows</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-92" title="92"><span class="st">    </span></a>
<a class="sourceLine" id="cb167-93" title="93"><span class="st">    </span><span class="co"># Add some more useful labels</span></a>
<a class="sourceLine" id="cb167-94" title="94"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb167-95" title="95">      <span class="dt">sim =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(data), <span class="dt">each =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(data)),</a>
<a class="sourceLine" id="cb167-96" title="96">      <span class="dt">term =</span> <span class="kw">factor</span>(.data<span class="op">$</span>term, <span class="dt">levels =</span> vars)</a>
<a class="sourceLine" id="cb167-97" title="97">      )</a>
<a class="sourceLine" id="cb167-98" title="98">  </a>
<a class="sourceLine" id="cb167-99" title="99">}</a>
<a class="sourceLine" id="cb167-100" title="100"></a>
<a class="sourceLine" id="cb167-101" title="101"><span class="co">##### EVALUATE power of the design #####</span></a>
<a class="sourceLine" id="cb167-102" title="102"></a>
<a class="sourceLine" id="cb167-103" title="103"><span class="co"># Inputs:</span></a>
<a class="sourceLine" id="cb167-104" title="104"><span class="co"># - (1) Results produced by estimate() above</span></a>
<a class="sourceLine" id="cb167-105" title="105"><span class="co"># - (2) Hypothetical effects we want power estimates for</span></a>
<a class="sourceLine" id="cb167-106" title="106"><span class="co"># - (3) Desired alpha (significance) level</span></a>
<a class="sourceLine" id="cb167-107" title="107">evaluate_power &lt;-<span class="st"> </span><span class="cf">function</span>(data, delta, <span class="dt">level =</span> <span class="fl">0.05</span>) {</a>
<a class="sourceLine" id="cb167-108" title="108">  </a>
<a class="sourceLine" id="cb167-109" title="109">  <span class="co"># Make sure delta (may be scalar or vector) was specified</span></a>
<a class="sourceLine" id="cb167-110" title="110">  <span class="cf">if</span> (<span class="kw">missing</span>(delta)) {</a>
<a class="sourceLine" id="cb167-111" title="111">    <span class="kw">stop</span>(<span class="st">&quot;Specify &apos;delta&apos; to proceed.&quot;</span>)</a>
<a class="sourceLine" id="cb167-112" title="112">  }</a>
<a class="sourceLine" id="cb167-113" title="113">  </a>
<a class="sourceLine" id="cb167-114" title="114">  <span class="co"># Apply the following (i.e., after %do%) to each delta separately,</span></a>
<a class="sourceLine" id="cb167-115" title="115">  <span class="co"># appending the results with bind_rows at the end.</span></a>
<a class="sourceLine" id="cb167-116" title="116">  foreach<span class="op">::</span><span class="kw">foreach</span>(</a>
<a class="sourceLine" id="cb167-117" title="117">    <span class="dt">i =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(delta),</a>
<a class="sourceLine" id="cb167-118" title="118">    <span class="dt">.combine =</span> <span class="st">&quot;bind_rows&quot;</span></a>
<a class="sourceLine" id="cb167-119" title="119">    ) <span class="op">%do%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb167-120" title="120">      </a>
<a class="sourceLine" id="cb167-121" title="121">      <span class="co"># Start with the df of estimates</span></a>
<a class="sourceLine" id="cb167-122" title="122">      data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-123" title="123"><span class="st">        </span></a>
<a class="sourceLine" id="cb167-124" title="124"><span class="st">        </span><span class="co"># Create variables storing the relevant delta and new test stat</span></a>
<a class="sourceLine" id="cb167-125" title="125"><span class="st">        </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb167-126" title="126">          <span class="dt">delta =</span> delta[i],</a>
<a class="sourceLine" id="cb167-127" title="127">          <span class="dt">new_statistic =</span> (.data<span class="op">$</span>estimate <span class="op">+</span><span class="st"> </span>.data<span class="op">$</span>delta) <span class="op">/</span><span class="st"> </span>.data<span class="op">$</span>std.error</a>
<a class="sourceLine" id="cb167-128" title="128">          ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-129" title="129"><span class="st">        </span></a>
<a class="sourceLine" id="cb167-130" title="130"><span class="st">        </span><span class="co"># Similar to group_by, result here is list of dfs for each term</span></a>
<a class="sourceLine" id="cb167-131" title="131"><span class="st">        </span>dplyr<span class="op">::</span><span class="kw">group_split</span>(.data<span class="op">$</span>term) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-132" title="132"><span class="st">        </span></a>
<a class="sourceLine" id="cb167-133" title="133"><span class="st">        </span><span class="co"># Separately for the df for each term, get p for each replicate</span></a>
<a class="sourceLine" id="cb167-134" title="134"><span class="st">        </span>purrr<span class="op">::</span><span class="kw">map</span>(</a>
<a class="sourceLine" id="cb167-135" title="135">          <span class="op">~</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb167-136" title="136">            tibble<span class="op">::</span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb167-137" title="137">              <span class="dt">term =</span> .<span class="op">$</span>term,</a>
<a class="sourceLine" id="cb167-138" title="138">              <span class="dt">delta =</span> .<span class="op">$</span>delta,</a>
<a class="sourceLine" id="cb167-139" title="139">              <span class="dt">p.value =</span> <span class="kw">foreach</span>(</a>
<a class="sourceLine" id="cb167-140" title="140">                <span class="dt">j =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(.<span class="op">$</span>new_statistic),</a>
<a class="sourceLine" id="cb167-141" title="141">                <span class="dt">.combine =</span> <span class="st">&quot;c&quot;</span></a>
<a class="sourceLine" id="cb167-142" title="142">                ) <span class="op">%do%</span><span class="st"> </span><span class="kw">mean</span>(<span class="kw">abs</span>(.<span class="op">$</span>statistic) <span class="op">&gt;=</span><span class="st"> </span><span class="kw">abs</span>(.<span class="op">$</span>new_statistic[j]))</a>
<a class="sourceLine" id="cb167-143" title="143">              )</a>
<a class="sourceLine" id="cb167-144" title="144">            }</a>
<a class="sourceLine" id="cb167-145" title="145">          )</a>
<a class="sourceLine" id="cb167-146" title="146">      } <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-147" title="147"><span class="st">    </span></a>
<a class="sourceLine" id="cb167-148" title="148"><span class="st">    </span><span class="co"># Organize by term and delta</span></a>
<a class="sourceLine" id="cb167-149" title="149"><span class="st">    </span><span class="kw">group_by</span>(.data<span class="op">$</span>term, .data<span class="op">$</span>delta) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-150" title="150"><span class="st">    </span></a>
<a class="sourceLine" id="cb167-151" title="151"><span class="st">    </span><span class="co"># Average over repliacates to get power for each term/delta combination</span></a>
<a class="sourceLine" id="cb167-152" title="152"><span class="st">    </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb167-153" title="153">      <span class="dt">power =</span> <span class="kw">mean</span>(.data<span class="op">$</span>p.value <span class="op">&lt;=</span><span class="st"> </span>level),</a>
<a class="sourceLine" id="cb167-154" title="154">      <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span></a>
<a class="sourceLine" id="cb167-155" title="155">      )</a>
<a class="sourceLine" id="cb167-156" title="156">  </a>
<a class="sourceLine" id="cb167-157" title="157">}</a>
<a class="sourceLine" id="cb167-158" title="158"></a>
<a class="sourceLine" id="cb167-159" title="159"><span class="co">##### EVALUATE the min. detectable effect #####</span></a>
<a class="sourceLine" id="cb167-160" title="160"><span class="co"># Helps summarize the results of evaluate_power() above,</span></a>
<a class="sourceLine" id="cb167-161" title="161"><span class="co"># basically a wrapper for evaluate_power()</span></a>
<a class="sourceLine" id="cb167-162" title="162"></a>
<a class="sourceLine" id="cb167-163" title="163"><span class="co"># Inputs:</span></a>
<a class="sourceLine" id="cb167-164" title="164"><span class="co"># - (1) Results produced by estimate() above</span></a>
<a class="sourceLine" id="cb167-165" title="165"><span class="co"># - (2) Range of hypothetical effects we want to consider (delta above)</span></a>
<a class="sourceLine" id="cb167-166" title="166"><span class="co"># - (3) How fine-grained do we want changes in delta to be?</span></a>
<a class="sourceLine" id="cb167-167" title="167"><span class="co"># - (4) Alpha (significance) level</span></a>
<a class="sourceLine" id="cb167-168" title="168"><span class="co"># - (5) Minimum power we want to accept</span></a>
<a class="sourceLine" id="cb167-169" title="169">evaluate_mde &lt;-<span class="st"> </span><span class="cf">function</span>(</a>
<a class="sourceLine" id="cb167-170" title="170">  data, </a>
<a class="sourceLine" id="cb167-171" title="171">  <span class="dt">delta_range =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb167-172" title="172">  <span class="dt">how_granular =</span> <span class="fl">0.01</span>,</a>
<a class="sourceLine" id="cb167-173" title="173">  <span class="dt">level =</span> <span class="fl">0.05</span>,</a>
<a class="sourceLine" id="cb167-174" title="174">  <span class="dt">min_power =</span> <span class="fl">0.8</span></a>
<a class="sourceLine" id="cb167-175" title="175">  ) {</a>
<a class="sourceLine" id="cb167-176" title="176">  </a>
<a class="sourceLine" id="cb167-177" title="177">  <span class="co"># Use the function designed above to get power estimates</span></a>
<a class="sourceLine" id="cb167-178" title="178">  eval &lt;-<span class="st"> </span><span class="kw">evaluate_power</span>(</a>
<a class="sourceLine" id="cb167-179" title="179">    <span class="dt">data =</span> data, </a>
<a class="sourceLine" id="cb167-180" title="180">    <span class="dt">delta =</span> <span class="kw">seq</span>(delta_range[<span class="dv">1</span>], delta_range[<span class="dv">2</span>], how_granular),</a>
<a class="sourceLine" id="cb167-181" title="181">    <span class="dt">level =</span> level</a>
<a class="sourceLine" id="cb167-182" title="182">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-183" title="183"><span class="st">    </span></a>
<a class="sourceLine" id="cb167-184" title="184"><span class="st">    </span><span class="co"># Organize data by term</span></a>
<a class="sourceLine" id="cb167-185" title="185"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(</a>
<a class="sourceLine" id="cb167-186" title="186">      .data<span class="op">$</span>term</a>
<a class="sourceLine" id="cb167-187" title="187">      ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-188" title="188"><span class="st">    </span></a>
<a class="sourceLine" id="cb167-189" title="189"><span class="st">    </span><span class="co"># Get the MDE at our desired power level for each term</span></a>
<a class="sourceLine" id="cb167-190" title="190"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb167-191" title="191">      <span class="dt">MDE =</span> <span class="kw">min</span>(.data<span class="op">$</span>delta[.data<span class="op">$</span>power <span class="op">&gt;=</span><span class="st"> </span>min_power]),</a>
<a class="sourceLine" id="cb167-192" title="192">      <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span></a>
<a class="sourceLine" id="cb167-193" title="193">      )</a>
<a class="sourceLine" id="cb167-194" title="194">  </a>
<a class="sourceLine" id="cb167-195" title="195">  <span class="kw">return</span>(eval)</a>
<a class="sourceLine" id="cb167-196" title="196">  </a>
<a class="sourceLine" id="cb167-197" title="197">}</a>
<a class="sourceLine" id="cb167-198" title="198"></a>
<a class="sourceLine" id="cb167-199" title="199"><span class="co">##### EVALUATE Bias #####</span></a>
<a class="sourceLine" id="cb167-200" title="200"><span class="co"># Helps summarize the results of estimate() above.</span></a>
<a class="sourceLine" id="cb167-201" title="201"><span class="co"># Pass results of estimate() to this function.</span></a>
<a class="sourceLine" id="cb167-202" title="202"></a>
<a class="sourceLine" id="cb167-203" title="203"><span class="co"># Inputs:</span></a>
<a class="sourceLine" id="cb167-204" title="204"><span class="co"># - (1) Data produced by estimate() above</span></a>
<a class="sourceLine" id="cb167-205" title="205"><span class="co"># - (2) True ATE</span></a>
<a class="sourceLine" id="cb167-206" title="206">evaluate_bias &lt;-<span class="st"> </span><span class="cf">function</span>(</a>
<a class="sourceLine" id="cb167-207" title="207">  data, </a>
<a class="sourceLine" id="cb167-208" title="208">  <span class="dt">ATE =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb167-209" title="209">  ) {</a>
<a class="sourceLine" id="cb167-210" title="210">  </a>
<a class="sourceLine" id="cb167-211" title="211">  <span class="co"># Start with the estimates for each replicated dataset</span></a>
<a class="sourceLine" id="cb167-212" title="212">  smry &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-213" title="213"><span class="st">    </span></a>
<a class="sourceLine" id="cb167-214" title="214"><span class="st">    </span><span class="co"># Add a variable representing the true ATE</span></a>
<a class="sourceLine" id="cb167-215" title="215"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb167-216" title="216">      <span class="dt">ATE =</span> <span class="kw">rep</span>(ATE, <span class="dt">len =</span> <span class="kw">n</span>())</a>
<a class="sourceLine" id="cb167-217" title="217">      ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-218" title="218"><span class="st">    </span></a>
<a class="sourceLine" id="cb167-219" title="219"><span class="st">    </span><span class="co"># Organize estimates by term</span></a>
<a class="sourceLine" id="cb167-220" title="220"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(</a>
<a class="sourceLine" id="cb167-221" title="221">      .data<span class="op">$</span>term</a>
<a class="sourceLine" id="cb167-222" title="222">      ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-223" title="223"><span class="st">    </span></a>
<a class="sourceLine" id="cb167-224" title="224"><span class="st">    </span><span class="co"># Summarize across replicates, within each term</span></a>
<a class="sourceLine" id="cb167-225" title="225"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb167-226" title="226">      <span class="st">&quot;True ATE&quot;</span> =<span class="st"> </span><span class="kw">unique</span>(.data<span class="op">$</span>ATE),</a>
<a class="sourceLine" id="cb167-227" title="227">      <span class="st">&quot;Mean Estimate&quot;</span> =<span class="st"> </span><span class="kw">mean</span>(.data<span class="op">$</span>estimate),</a>
<a class="sourceLine" id="cb167-228" title="228">      <span class="dt">Bias =</span> <span class="kw">mean</span>(.data<span class="op">$</span>estimate <span class="op">-</span><span class="st"> </span>.data<span class="op">$</span>ATE),</a>
<a class="sourceLine" id="cb167-229" title="229">      <span class="dt">MSE =</span> <span class="kw">mean</span>((.data<span class="op">$</span>estimate <span class="op">-</span><span class="st"> </span>.data<span class="op">$</span>ATE)<span class="op">^</span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb167-230" title="230">      <span class="dt">Coverage =</span> <span class="kw">mean</span>(</a>
<a class="sourceLine" id="cb167-231" title="231">        .data<span class="op">$</span>conf.low <span class="op">&lt;=</span><span class="st"> </span>.data<span class="op">$</span>ATE <span class="op">&amp;</span><span class="st"> </span>.data<span class="op">$</span>conf.high <span class="op">&gt;=</span><span class="st"> </span>.data<span class="op">$</span>ATE</a>
<a class="sourceLine" id="cb167-232" title="232">        ),</a>
<a class="sourceLine" id="cb167-233" title="233">      <span class="st">&quot;SD of Estimates&quot;</span> =<span class="st"> </span><span class="kw">sd</span>(.data<span class="op">$</span>estimate),</a>
<a class="sourceLine" id="cb167-234" title="234">      <span class="st">&quot;Mean SE&quot;</span> =<span class="st"> </span><span class="kw">mean</span>(.data<span class="op">$</span>std.error),</a>
<a class="sourceLine" id="cb167-235" title="235">      <span class="dt">Power =</span> <span class="kw">mean</span>(.data<span class="op">$</span>p.value <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>),</a>
<a class="sourceLine" id="cb167-236" title="236">      <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span></a>
<a class="sourceLine" id="cb167-237" title="237">    )</a>
<a class="sourceLine" id="cb167-238" title="238">  </a>
<a class="sourceLine" id="cb167-239" title="239">  <span class="kw">return</span>(smry)</a>
<a class="sourceLine" id="cb167-240" title="240">  </a>
<a class="sourceLine" id="cb167-241" title="241">}</a></code></pre></div>
<p>Results are shown in the subsequent figure. Though the computational estimates are slightly different, they comport quite well with the analytic estimates.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" title="1"><span class="co">## Parameters used for both sets of calculations</span></a>
<a class="sourceLine" id="cb168-2" title="2">n &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="co"># Sample size</span></a>
<a class="sourceLine" id="cb168-3" title="3">d &lt;-<span class="st"> </span><span class="fl">0.2</span> <span class="co"># Effect size to consider</span></a>
<a class="sourceLine" id="cb168-4" title="4"></a>
<a class="sourceLine" id="cb168-5" title="5"><span class="co">## Analytical power estimates</span></a>
<a class="sourceLine" id="cb168-6" title="6">power_data &lt;-</a>
<a class="sourceLine" id="cb168-7" title="7"><span class="st">  </span></a>
<a class="sourceLine" id="cb168-8" title="8"><span class="st">  </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb168-9" title="9">    <span class="dt">d =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dt">len =</span> <span class="dv">200</span>),</a>
<a class="sourceLine" id="cb168-10" title="10">    <span class="dt">power =</span> <span class="kw">power.t.test</span>(<span class="dt">n =</span> n <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">delta =</span> d)<span class="op">$</span>power</a>
<a class="sourceLine" id="cb168-11" title="11">    )</a>
<a class="sourceLine" id="cb168-12" title="12"></a>
<a class="sourceLine" id="cb168-13" title="13"><span class="co">## Save initial plot; add simulation results below</span></a>
<a class="sourceLine" id="cb168-14" title="14">g &lt;-<span class="st"> </span><span class="kw">ggplot</span>(power_data) <span class="op">+</span></a>
<a class="sourceLine" id="cb168-15" title="15"><span class="st">  </span></a>
<a class="sourceLine" id="cb168-16" title="16"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(d, power, <span class="dt">linetype =</span> <span class="st">&quot;power.t.test()&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb168-17" title="17"><span class="st">  </span></a>
<a class="sourceLine" id="cb168-18" title="18"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb168-19" title="19">    <span class="dt">x =</span> <span class="kw">expression</span>(delta),</a>
<a class="sourceLine" id="cb168-20" title="20">    <span class="dt">y =</span> <span class="st">&quot;Power&quot;</span>,</a>
<a class="sourceLine" id="cb168-21" title="21">    <span class="dt">title =</span> <span class="st">&quot;Power for Simple Difference in Means Test&quot;</span></a>
<a class="sourceLine" id="cb168-22" title="22">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb168-23" title="23"><span class="st">  </span></a>
<a class="sourceLine" id="cb168-24" title="24"><span class="st">  </span><span class="kw">scale_y_continuous</span>(</a>
<a class="sourceLine" id="cb168-25" title="25">    <span class="dt">n.breaks =</span> <span class="dv">6</span></a>
<a class="sourceLine" id="cb168-26" title="26">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb168-27" title="27"><span class="st">  </span></a>
<a class="sourceLine" id="cb168-28" title="28"><span class="st">  </span><span class="kw">geom_hline</span>(</a>
<a class="sourceLine" id="cb168-29" title="29">    <span class="dt">yintercept =</span> <span class="fl">0.8</span>,</a>
<a class="sourceLine" id="cb168-30" title="30">    <span class="dt">col =</span> <span class="st">&quot;grey25&quot;</span>,</a>
<a class="sourceLine" id="cb168-31" title="31">    <span class="dt">alpha =</span> <span class="dv">08</span></a>
<a class="sourceLine" id="cb168-32" title="32">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb168-33" title="33"><span class="st">  </span></a>
<a class="sourceLine" id="cb168-34" title="34"><span class="st">  </span>ggridges<span class="op">::</span><span class="kw">theme_ridges</span>(</a>
<a class="sourceLine" id="cb168-35" title="35">    <span class="dt">center_axis_labels =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb168-36" title="36">    <span class="dt">font_size =</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb168-37" title="37">    ) </a>
<a class="sourceLine" id="cb168-38" title="38"></a>
<a class="sourceLine" id="cb168-39" title="39"><span class="co">## Comutational power estimates, using the functions above</span></a>
<a class="sourceLine" id="cb168-40" title="40">sim_power_data &lt;-</a>
<a class="sourceLine" id="cb168-41" title="41"><span class="st">  </span></a>
<a class="sourceLine" id="cb168-42" title="42"><span class="st">  </span><span class="kw">replicate_design</span>(</a>
<a class="sourceLine" id="cb168-43" title="43">    <span class="dt">N =</span> n,</a>
<a class="sourceLine" id="cb168-44" title="44">    <span class="dt">y =</span> <span class="kw">rnorm</span>(N),</a>
<a class="sourceLine" id="cb168-45" title="45">    <span class="dt">x =</span> randomizr<span class="op">::</span><span class="kw">complete_ra</span>(</a>
<a class="sourceLine" id="cb168-46" title="46">      N, <span class="dt">m =</span> N <span class="op">/</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb168-47" title="47">      )</a>
<a class="sourceLine" id="cb168-48" title="48">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb168-49" title="49"><span class="st">  </span></a>
<a class="sourceLine" id="cb168-50" title="50"><span class="st">  </span><span class="kw">estimate</span>(</a>
<a class="sourceLine" id="cb168-51" title="51">    <span class="dt">form =</span> y <span class="op">~</span><span class="st"> </span>x, <span class="dt">vars =</span> <span class="st">&quot;x&quot;</span></a>
<a class="sourceLine" id="cb168-52" title="52">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb168-53" title="53"><span class="st">  </span></a>
<a class="sourceLine" id="cb168-54" title="54"><span class="st">  </span><span class="kw">evaluate_power</span>(</a>
<a class="sourceLine" id="cb168-55" title="55">    <span class="dt">delta =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dt">len =</span> <span class="dv">200</span>)</a>
<a class="sourceLine" id="cb168-56" title="56">    )</a>
<a class="sourceLine" id="cb168-57" title="57"></a>
<a class="sourceLine" id="cb168-58" title="58"><span class="co">## Add results from the simulation to the plot and compare</span></a>
<a class="sourceLine" id="cb168-59" title="59">g <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb168-60" title="60"><span class="st">  </span></a>
<a class="sourceLine" id="cb168-61" title="61"><span class="st">  </span><span class="kw">geom_line</span>(</a>
<a class="sourceLine" id="cb168-62" title="62">    <span class="dt">data =</span> sim_power_data,</a>
<a class="sourceLine" id="cb168-63" title="63">    <span class="kw">aes</span>(delta, power, <span class="dt">linetype =</span> <span class="st">&quot;simulation&quot;</span>),</a>
<a class="sourceLine" id="cb168-64" title="64">    <span class="dt">color =</span> <span class="st">&quot;grey25&quot;</span></a>
<a class="sourceLine" id="cb168-65" title="65">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb168-66" title="66"><span class="st">  </span></a>
<a class="sourceLine" id="cb168-67" title="67"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb168-68" title="68">    <span class="dt">linetype =</span> <span class="st">&quot;Method:&quot;</span></a>
<a class="sourceLine" id="cb168-69" title="69">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb168-70" title="70"><span class="st">  </span></a>
<a class="sourceLine" id="cb168-71" title="71"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb168-72" title="72">    <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span></a>
<a class="sourceLine" id="cb168-73" title="73">    ) </a></code></pre></div>
<p><img src="OES_SOP_files/figure-html/powersimvsanalytic-1.png" width=".9\textwidth"></p>
<p>As mentioned above, we produced those computational estimates using some pre-written functions that are currently housed in OES&#x2019;s GitHub code library. These functions are also laid out and explained step-by-step in comments in a code chunk above.</p>
<p>These tools are designed around a simple workflow, and they should help remove some of the programming that may otherwise be a barrier to project teams calculating power computationally. The workflow proceeds as follows:</p>
<ol style="list-style-type: decimal">
<li>Replicate</li>
<li>Estimate<br>
</li>
<li>Evaluate</li>
</ol>
<p>The first step, <strong>Replicate</strong>, entails specifying an example data-generation process (which may include only an outcome variable and treatment assignment) and simulating it multiple times to create a series of randomly generated datasets. Each individual dataset produced is a <em>sample replicate</em>.</p>
<p>The next step, <strong>Estimate</strong>, entails estimating effects for select treatments within each sample replicate. We can use those estimates to produce a distribution of test statistics for each effect size of interest.</p>
<p>Finally, the last step, <strong>Evaluate</strong>, entails using those test statistics to evaluate our power to detect a range of different effect sizes.</p>
<p>This workflow is supported by three functions: <code>replicate_design()</code>,
<code>estimate()</code>, and <code>evaluate_power()</code>. Here&#x2019;s the simulation code used to generate Figure 1, in more detail:</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb169-1" title="1"><span class="co">## 1. Replicate:</span></a>
<a class="sourceLine" id="cb169-2" title="2"></a>
<a class="sourceLine" id="cb169-3" title="3"><span class="co"># Output is a list of dfs</span></a>
<a class="sourceLine" id="cb169-4" title="4">rep &lt;-<span class="st"> </span><span class="kw">replicate_design</span>(</a>
<a class="sourceLine" id="cb169-5" title="5">  <span class="dt">R =</span> <span class="dv">200</span>,   <span class="co"># Number of sample replicates</span></a>
<a class="sourceLine" id="cb169-6" title="6">  <span class="dt">N =</span> <span class="dv">1000</span>,  <span class="co"># Sample size of each replicate</span></a>
<a class="sourceLine" id="cb169-7" title="7">  <span class="dt">y =</span> <span class="kw">rnorm</span>(N), <span class="co"># Normally distributed response</span></a>
<a class="sourceLine" id="cb169-8" title="8">  <span class="dt">x =</span> <span class="kw">rbinom</span>(N, <span class="dv">1</span>, <span class="fl">0.5</span>) <span class="co"># Binary treatment indicator</span></a>
<a class="sourceLine" id="cb169-9" title="9">  ) </a>
<a class="sourceLine" id="cb169-10" title="10"></a>
<a class="sourceLine" id="cb169-11" title="11"><span class="co">## 2. Estimate:</span></a>
<a class="sourceLine" id="cb169-12" title="12"></a>
<a class="sourceLine" id="cb169-13" title="13"><span class="co"># Output is a dataframe of estimates from each sample replicate</span></a>
<a class="sourceLine" id="cb169-14" title="14">est &lt;-<span class="st"> </span><span class="kw">estimate</span>(</a>
<a class="sourceLine" id="cb169-15" title="15">  y <span class="op">~</span><span class="st"> </span>x, <span class="co"># Regression formula</span></a>
<a class="sourceLine" id="cb169-16" title="16">  <span class="dt">vars =</span> <span class="st">&quot;x&quot;</span>, <span class="co"># Treatment variable(s)</span></a>
<a class="sourceLine" id="cb169-17" title="17">  <span class="dt">data =</span> rep <span class="co"># Sample replicates</span></a>
<a class="sourceLine" id="cb169-18" title="18">  ) </a>
<a class="sourceLine" id="cb169-19" title="19"></a>
<a class="sourceLine" id="cb169-20" title="20"><span class="co">## 3. Evaluate:</span></a>
<a class="sourceLine" id="cb169-21" title="21"></a>
<a class="sourceLine" id="cb169-22" title="22"><span class="co"># Output is a list of dfs</span></a>
<a class="sourceLine" id="cb169-23" title="23">pwr_eval_sim &lt;-<span class="st"> </span><span class="kw">evaluate_power</span>(</a>
<a class="sourceLine" id="cb169-24" title="24">  <span class="dt">data =</span> est, <span class="co"># Estimates, from estimate() above</span></a>
<a class="sourceLine" id="cb169-25" title="25">  <span class="dt">delta =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dt">len =</span> <span class="dv">200</span>) <span class="co"># Effect sizes to consider</span></a>
<a class="sourceLine" id="cb169-26" title="26">  )   </a></code></pre></div>
<p>The final product, <code>pwr_eval_sim</code> above, reports the power for each of the user-specified effect sizes (<code>delta</code>) and (<code>vars</code>) model terms specified when calling <code>estimate()</code>. The output can be used to plot power curves or to compute minimum detectable effects.</p>
<p>These functions help make the process of performing computational power analysis for OES projects easier, while still providing ample room for flexibility in both design and estimation strategy. For example, <code>replicate_design()</code> is a wrapper for <code>fabricate()</code> in the <a href="https://declaredesign.org/r/fabricatr/">fabricatr</a> package. This gives users the ability to generate multi-level or nested data-generating processes, specify additional covariates, or determine whether treatment randomization is done within blocks or by clusters. By default, estimates are returned using <code>lm_robust()</code> from the <a href="https://declaredesign.org/r/estimatr/">estimatr</a> package, but alternative estimators can be specified. Say, for example, you have a binary response and a set of covariates, and your design calls for using logistic regression. You could generate estimates for such a design as follows:</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb170-1" title="1"><span class="co">## Define logit estimator function</span></a>
<a class="sourceLine" id="cb170-2" title="2">logit &lt;-<span class="st"> </span><span class="cf">function</span>(...){ <span class="kw">glm</span>(..., <span class="dt">family =</span> binomial)}</a>
<a class="sourceLine" id="cb170-3" title="3"></a>
<a class="sourceLine" id="cb170-4" title="4"><span class="co">## Pass this to the estimate() function above</span></a>
<a class="sourceLine" id="cb170-5" title="5">est &lt;-<span class="st"> </span><span class="kw">estimate</span>(</a>
<a class="sourceLine" id="cb170-6" title="6">  y <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>z1 <span class="op">+</span><span class="st"> </span>z2, <span class="dt">data =</span> rep, <span class="dt">estimator =</span> logit</a>
<a class="sourceLine" id="cb170-7" title="7">  ) </a></code></pre></div>
<p>Other tools for power simulation exist as well. For instance, throughout this SOP, we have used <a href="https://declaredesign.org/r/declaredesign/articles/DeclareDesign_101.html">DeclareDesign</a> to simulate hypothetical research designs and compare their performance. And there is no shortage of further simulation
examples that can be found online for more specialized use-cases.</p>
</div>
<div id="when-to-use-which-approach" class="section level2">
<h2><span class="header-section-number">6.3</span> When to use which approach</h2>
<p>For a simple difference in means test, the programming required for an analytical power analysis is much much less involved. When is computational power analysis worth the extra time investment?</p>
<p>To start, in cases where we&#x2019;re interested in the power to detect a simple difference in means, or a difference in proportions for binary responses, it is probably sufficient to use <code>power.t.test()</code> (for means) or <code>power.prop.test()</code> (for proportions).</p>
<p>However, OES projects often involve design features or analytic strategies that are difficult to account for using off-the-shelf tools. For example, we often include covariates in our statistical models to enhance the precision of our treatment effect estimates. If the gain in precision is small, then it might not be important to account for this in power calculations in the design phase of the project. But if we expect a substantial gain in precision due to including covariates, then we probably want to account for estimating power. The natural way to do this is by simulation, including the covariates in the &#x201C;replicate&#x201D; and &#x201C;estimate&#x201D; steps above. Accounting for covariates is especially useful if we can use real historical or pre-treatment data that represent the correlations we expect to see between covariates and outcomes in our later analysis of the trial data.</p>
<p>More complex design features or analytic strategies may make investing in the
simulation approach even more worthwhile, or downright necessary. Examples
include heterogeneity in treatment effects, a multi-arm or factorial design, or block randomization with differing probabilities of treatment between blocks &#x2013; none of which is usually easily accounted for with off-the-shelf tools. In the next section, we provide some additional examples of simulations for more complex designs or analytic strategies.</p>
</div>
<div id="additional-examples-of-the-simulation-approach" class="section level2">
<h2><span class="header-section-number">6.4</span> Additional examples of the simulation approach</h2>
<p>Here we provide two examples of research designs where simulation is well worth the extra effort. Attendant R code is included to illustrate how we could use the functions above in these cases.</p>
<div id="a-two-by-two-design-with-interaction" class="section level3">
<h3><span class="header-section-number">6.4.1</span> A two-by-two design with interaction</h3>
<p>One instance where computational power analysis may be worth the investment is
in assessing power for a two-by-two factorial design with an interaction. In
such a design, the goal is to assess not only the power to detect main effects
(the average effect of each individual treatment), but also power to detect a
non-zero interaction effect between the treatments.</p>
<p>Say we have a design with 1,000 observations and we would like to know the
effect of two treatments on a binary outcome with a baseline of 0.25. Each
treatment is assigned to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>=</mo><mn>500</mn></mrow><annotation encoding="application/x-tex">M = 500</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">500</span></span></span></span> individuals at random, resulting in four
roughly equal sized groups of observations after randomization: (1) a control group, (2) those assigned to treatment 1 but not treatment 2, (3) those assigned to treatment 2 but not treatment 1, and (4) those assigned to both treatment 1 and 2.</p>
<p>We can easily calculate power to detect the main effect of each treatment as follows:</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb171-1" title="1">two_by_two &lt;-</a>
<a class="sourceLine" id="cb171-2" title="2"></a>
<a class="sourceLine" id="cb171-3" title="3"><span class="st">  </span><span class="co">## Basic elements of each simulated sample replicate</span></a>
<a class="sourceLine" id="cb171-4" title="4"><span class="st">  </span><span class="kw">replicate_design</span>(</a>
<a class="sourceLine" id="cb171-5" title="5">    <span class="dt">N =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb171-6" title="6">    <span class="dt">y =</span> <span class="kw">rbinom</span>(N, <span class="dv">1</span>, <span class="fl">0.25</span>),</a>
<a class="sourceLine" id="cb171-7" title="7">    <span class="dt">x1 =</span> <span class="kw">complete_ra</span>(N, <span class="dt">m =</span> N <span class="op">/</span><span class="st"> </span><span class="dv">2</span>), </a>
<a class="sourceLine" id="cb171-8" title="8">    <span class="dt">x2 =</span> <span class="kw">complete_ra</span>(N, <span class="dt">m =</span> N <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb171-9" title="9">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb171-10" title="10"><span class="st">  </span></a>
<a class="sourceLine" id="cb171-11" title="11"><span class="st">  </span><span class="co">## Estimate main and interaction effects</span></a>
<a class="sourceLine" id="cb171-12" title="12"><span class="st">  </span><span class="kw">estimate</span>(</a>
<a class="sourceLine" id="cb171-13" title="13">    <span class="dt">form =</span> y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2 <span class="op">+</span><span class="st"> </span>x1<span class="op">:</span>x2,</a>
<a class="sourceLine" id="cb171-14" title="14">    <span class="dt">vars =</span> <span class="kw">c</span>(<span class="st">&quot;x1&quot;</span>, <span class="st">&quot;x2&quot;</span>, <span class="st">&quot;x1:x2&quot;</span>)</a>
<a class="sourceLine" id="cb171-15" title="15">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb171-16" title="16"><span class="st">  </span></a>
<a class="sourceLine" id="cb171-17" title="17"><span class="st">  </span><span class="co">## Evaluate power</span></a>
<a class="sourceLine" id="cb171-18" title="18"><span class="st">  </span><span class="kw">evaluate_power</span>(</a>
<a class="sourceLine" id="cb171-19" title="19">    <span class="dt">delta =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="dt">len =</span> <span class="dv">200</span>)</a>
<a class="sourceLine" id="cb171-20" title="20">    )</a></code></pre></div>
<p>Using the output reported in the object <code>two_by_two</code>, we can plot the power curves for each of the main effects and the interaction effect, as shown
in Figure 2.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb172-1" title="1"><span class="kw">ggplot</span>(two_by_two) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-2" title="2"><span class="st">  </span></a>
<a class="sourceLine" id="cb172-3" title="3"><span class="st">  </span><span class="co">## Add a line representing power for each effect/term</span></a>
<a class="sourceLine" id="cb172-4" title="4"><span class="st">  </span><span class="kw">geom_line</span>(</a>
<a class="sourceLine" id="cb172-5" title="5">    <span class="kw">aes</span>(delta, power, <span class="dt">linetype =</span> term)</a>
<a class="sourceLine" id="cb172-6" title="6">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-7" title="7"><span class="st">  </span></a>
<a class="sourceLine" id="cb172-8" title="8"><span class="st">  </span><span class="co">## Choose linetypes that are easy to distinguish</span></a>
<a class="sourceLine" id="cb172-9" title="9"><span class="st">  </span><span class="kw">scale_linetype_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;solid&quot;</span>, <span class="st">&quot;longdash&quot;</span>, <span class="st">&quot;dotted&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-10" title="10"><span class="st">  </span></a>
<a class="sourceLine" id="cb172-11" title="11"><span class="st">  </span><span class="co">## Horizontal line for 80% power</span></a>
<a class="sourceLine" id="cb172-12" title="12"><span class="st">  </span><span class="kw">geom_hline</span>(</a>
<a class="sourceLine" id="cb172-13" title="13">    <span class="dt">yintercept =</span> <span class="fl">0.8</span>,</a>
<a class="sourceLine" id="cb172-14" title="14">    <span class="dt">color =</span> <span class="st">&quot;grey25&quot;</span>,</a>
<a class="sourceLine" id="cb172-15" title="15">    <span class="dt">alpha =</span> <span class="fl">0.8</span></a>
<a class="sourceLine" id="cb172-16" title="16">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-17" title="17"><span class="st">  </span></a>
<a class="sourceLine" id="cb172-18" title="18"><span class="st">  </span><span class="co">## y-axis scale</span></a>
<a class="sourceLine" id="cb172-19" title="19"><span class="st">  </span><span class="kw">scale_y_continuous</span>(</a>
<a class="sourceLine" id="cb172-20" title="20">    <span class="dt">n.breaks =</span> <span class="dv">6</span></a>
<a class="sourceLine" id="cb172-21" title="21">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-22" title="22"><span class="st">  </span></a>
<a class="sourceLine" id="cb172-23" title="23"><span class="st">  </span><span class="co">## Adding labels</span></a>
<a class="sourceLine" id="cb172-24" title="24"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb172-25" title="25">    <span class="dt">x =</span> <span class="kw">expression</span>(delta),</a>
<a class="sourceLine" id="cb172-26" title="26">    <span class="dt">y =</span> <span class="st">&quot;Power&quot;</span>,</a>
<a class="sourceLine" id="cb172-27" title="27">    <span class="dt">title =</span> <span class="st">&quot;Power for a 2x2 Design&quot;</span>,</a>
<a class="sourceLine" id="cb172-28" title="28">    <span class="dt">linetype =</span> <span class="st">&quot;Effect for...&quot;</span></a>
<a class="sourceLine" id="cb172-29" title="29">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-30" title="30"><span class="st">  </span></a>
<a class="sourceLine" id="cb172-31" title="31"><span class="st">  </span><span class="co">## Update some visual settings with the ridges theme</span></a>
<a class="sourceLine" id="cb172-32" title="32"><span class="st">  </span>ggridges<span class="op">::</span><span class="kw">theme_ridges</span>(</a>
<a class="sourceLine" id="cb172-33" title="33">    <span class="dt">font_size =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb172-34" title="34">    <span class="dt">center_axis_labels =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb172-35" title="35">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-36" title="36"><span class="st">  </span></a>
<a class="sourceLine" id="cb172-37" title="37"><span class="st">  </span><span class="co">## Other settings (here: just legend location)</span></a>
<a class="sourceLine" id="cb172-38" title="38"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb172-39" title="39">    <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span></a>
<a class="sourceLine" id="cb172-40" title="40">    ) </a></code></pre></div>
<p><img src="OES_SOP_files/figure-html/unnamed-chunk-27-1.png" width=".9\textwidth"></p>
<p>Of course, in this simple example, we could still have relied on some reasonable analytical assumptions to arrive at these estimates (see a helpful discussion <a href="https://statmodeling.stat.columbia.edu/2018/03/15/need-16-times-sample-size-estimate-interaction-estimate-main-effect/">here</a>). But running a simulation saves us the trouble.</p>
</div>
<div id="covariate-adjustment-with-the-lin-estimator" class="section level3">
<h3><span class="header-section-number">6.4.2</span> Covariate adjustment with the Lin estimator</h3>
<p>Another scenario where computational power analysis is worth the investment is if a design calls for covariate adjustment. This is common in OES projects, and, in many instances, the <span class="citation">Lin (<a href="#ref-lin_agnostic_2013">2013</a>)</span> saturated regression estimator is the solution we choose.</p>
<p>Devising an off-the-shelf method to calculate power for such a study is
possible, but would likely require investing time doing background research to
ensure its accuracy. Alternatively, we could simply replicate, estimate, and
evaluate such a design computationally. The results will be roughly just as accurate, without regarding a review of the methods literature.</p>
<p>Suppose we have a sample of 1,000 observations and a continuous outcome
variable. We wish to assess the effect of some policy intervention on this
continuous outcome. Our design calls for randomly assigning only <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>=</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">M = 100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">100</span></span></span></span>
individuals to receive the intervention &#x2014; perhaps because it is expensive to implement &#x2014; and the rest to control.</p>
<p>In addition to having data on the outcome and on treatment assignment, let&#x2019;s say that we also anticipate obtaining a dataset of covariates for our 1,000 observations. This data contains two variables that are prognostic of the outcome <em>and the treatment effect</em>. We&#x2019;ll call these <code>z1</code> and <code>z2</code>. The first is a continuous measure and the latter is a binary indicator. Our design calls for adjusting for these covariates to improve the precision of our estimated treatment effect. We can simulate such a design to illustrate the possible benefits of covariate adjustment in terms of improved statistical power.</p>
<p>We begin by replicating the data-generating process:</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb173-1" title="1">rep_data &lt;-</a>
<a class="sourceLine" id="cb173-2" title="2"><span class="st">  </span></a>
<a class="sourceLine" id="cb173-3" title="3"><span class="st">  </span><span class="kw">replicate_design</span>(</a>
<a class="sourceLine" id="cb173-4" title="4">    <span class="dt">N =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb173-5" title="5">    <span class="dt">z1 =</span> <span class="kw">rnorm</span>(N, <span class="dt">sd =</span> <span class="dv">3</span>),   <span class="co"># Continuous covariate</span></a>
<a class="sourceLine" id="cb173-6" title="6">    <span class="dt">z2 =</span> <span class="kw">rbinom</span>(N, <span class="dv">1</span>, <span class="fl">0.25</span>), <span class="co"># Binary covariate</span></a>
<a class="sourceLine" id="cb173-7" title="7">    <span class="dt">cz1 =</span> z1 <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(z1),     <span class="co"># Mean centered versions of the covariates</span></a>
<a class="sourceLine" id="cb173-8" title="8">    <span class="dt">cz2 =</span> z2 <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(z2),</a>
<a class="sourceLine" id="cb173-9" title="9">    <span class="dt">x =</span> <span class="kw">complete_ra</span>(N, <span class="dt">m =</span> N <span class="op">/</span><span class="st"> </span><span class="dv">10</span>), <span class="co"># Randomly assign 10% to treatment</span></a>
<a class="sourceLine" id="cb173-10" title="10">    <span class="dt">y =</span> ((z1 <span class="op">+</span><span class="st"> </span>z2) <span class="op">*</span><span class="st"> </span>x) <span class="op">+</span><span class="st"> </span>(<span class="fl">0.8</span> <span class="op">*</span><span class="st"> </span>z1) <span class="op">-</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>z2) <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(N) <span class="co"># Simulate Y</span></a>
<a class="sourceLine" id="cb173-11" title="11">    )</a></code></pre></div>
<p>We then estimate and evaluate. For comparison, power is computed (1) with
covariate adjustment via the Lin estimator, (2) without covariate adjustment, and (3) with standard linear, additive covariate adjustment:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb174-1" title="1"><span class="co">## With the Lin Estimator</span></a>
<a class="sourceLine" id="cb174-2" title="2">lin_adjust &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb174-3" title="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb174-4" title="4"><span class="st">  </span>rep_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb174-5" title="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb174-6" title="6"><span class="st">  </span><span class="kw">estimate</span>(</a>
<a class="sourceLine" id="cb174-7" title="7">    <span class="dt">form =</span> y <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>z1 <span class="op">+</span><span class="st"> </span>z2 <span class="op">+</span><span class="st"> </span>x<span class="op">:</span>cz1 <span class="op">+</span><span class="st"> </span>x<span class="op">:</span>cz2,</a>
<a class="sourceLine" id="cb174-8" title="8">    <span class="dt">vars =</span> <span class="st">&quot;x&quot;</span></a>
<a class="sourceLine" id="cb174-9" title="9">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb174-10" title="10"><span class="st">  </span></a>
<a class="sourceLine" id="cb174-11" title="11"><span class="st">  </span><span class="kw">evaluate_power</span>(</a>
<a class="sourceLine" id="cb174-12" title="12">    <span class="dt">delta =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dt">len =</span> <span class="dv">200</span>)</a>
<a class="sourceLine" id="cb174-13" title="13">    )</a>
<a class="sourceLine" id="cb174-14" title="14"></a>
<a class="sourceLine" id="cb174-15" title="15"><span class="co">## With no covariate adjustment</span></a>
<a class="sourceLine" id="cb174-16" title="16">no_adjust &lt;-</a>
<a class="sourceLine" id="cb174-17" title="17"><span class="st">  </span></a>
<a class="sourceLine" id="cb174-18" title="18"><span class="st">  </span>rep_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb174-19" title="19"><span class="st">  </span></a>
<a class="sourceLine" id="cb174-20" title="20"><span class="st">  </span><span class="kw">estimate</span>(</a>
<a class="sourceLine" id="cb174-21" title="21">    <span class="dt">form =</span> y <span class="op">~</span><span class="st"> </span>x,</a>
<a class="sourceLine" id="cb174-22" title="22">    <span class="dt">vars =</span> <span class="st">&quot;x&quot;</span></a>
<a class="sourceLine" id="cb174-23" title="23">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb174-24" title="24"><span class="st">  </span></a>
<a class="sourceLine" id="cb174-25" title="25"><span class="st">  </span><span class="kw">evaluate_power</span>(</a>
<a class="sourceLine" id="cb174-26" title="26">    <span class="dt">delta =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dt">len =</span> <span class="dv">200</span>)</a>
<a class="sourceLine" id="cb174-27" title="27">    )</a>
<a class="sourceLine" id="cb174-28" title="28"></a>
<a class="sourceLine" id="cb174-29" title="29"><span class="co">## With linear, additive covariate adjustment</span></a>
<a class="sourceLine" id="cb174-30" title="30">standard_adjust &lt;-</a>
<a class="sourceLine" id="cb174-31" title="31"><span class="st">  </span></a>
<a class="sourceLine" id="cb174-32" title="32"><span class="st">  </span>rep_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb174-33" title="33"><span class="st">  </span></a>
<a class="sourceLine" id="cb174-34" title="34"><span class="st">  </span><span class="kw">estimate</span>(</a>
<a class="sourceLine" id="cb174-35" title="35">    <span class="dt">form =</span> y <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>z1 <span class="op">+</span><span class="st"> </span>z2,</a>
<a class="sourceLine" id="cb174-36" title="36">    <span class="dt">vars =</span> <span class="st">&quot;x&quot;</span></a>
<a class="sourceLine" id="cb174-37" title="37">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb174-38" title="38"><span class="st">  </span></a>
<a class="sourceLine" id="cb174-39" title="39"><span class="st">  </span><span class="kw">evaluate_power</span>(</a>
<a class="sourceLine" id="cb174-40" title="40">    <span class="dt">delta =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dt">len =</span> <span class="dv">200</span>)</a>
<a class="sourceLine" id="cb174-41" title="41">    )</a></code></pre></div>
<p>We can now compare results under these alternative empirical strategies. Figure 3 shows the power curves for each approach. The Lin estimator provides substantial improvements in power over both no covariate adjustment and linear additive adjustment.<a href="references.html#fn29" class="footnote-ref" id="fnref29"><sup>29</sup></a> And it only took a few lines of code to get this result!</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb175-1" title="1"><span class="co">## Combine the results, and apply similar plotting code to above</span></a>
<a class="sourceLine" id="cb175-2" title="2"><span class="kw">bind_rows</span>(</a>
<a class="sourceLine" id="cb175-3" title="3">  lin_adjust <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Method =</span> <span class="st">&quot;Lin&quot;</span>),</a>
<a class="sourceLine" id="cb175-4" title="4">  no_adjust <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Method =</span> <span class="st">&quot;No Covariates&quot;</span>),</a>
<a class="sourceLine" id="cb175-5" title="5">  standard_adjust <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Method =</span> <span class="st">&quot;Additive&quot;</span>)</a>
<a class="sourceLine" id="cb175-6" title="6">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb175-7" title="7"><span class="st">  </span></a>
<a class="sourceLine" id="cb175-8" title="8"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb175-9" title="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb175-10" title="10"><span class="st">  </span><span class="kw">geom_line</span>(</a>
<a class="sourceLine" id="cb175-11" title="11">    <span class="kw">aes</span>(delta, power, <span class="dt">linetype =</span> Method)</a>
<a class="sourceLine" id="cb175-12" title="12">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb175-13" title="13"><span class="st">  </span></a>
<a class="sourceLine" id="cb175-14" title="14"><span class="st">  </span><span class="kw">scale_linetype_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;solid&quot;</span>, <span class="st">&quot;longdash&quot;</span>, <span class="st">&quot;dotted&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb175-15" title="15"><span class="st">  </span></a>
<a class="sourceLine" id="cb175-16" title="16"><span class="st">  </span><span class="kw">geom_hline</span>(</a>
<a class="sourceLine" id="cb175-17" title="17">    <span class="dt">yintercept =</span> <span class="fl">0.8</span>,</a>
<a class="sourceLine" id="cb175-18" title="18">    <span class="dt">color =</span> <span class="st">&quot;grey25&quot;</span>,</a>
<a class="sourceLine" id="cb175-19" title="19">    <span class="dt">alpha =</span> <span class="fl">0.8</span></a>
<a class="sourceLine" id="cb175-20" title="20">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb175-21" title="21"><span class="st">  </span></a>
<a class="sourceLine" id="cb175-22" title="22"><span class="st">  </span><span class="kw">scale_y_continuous</span>(</a>
<a class="sourceLine" id="cb175-23" title="23">    <span class="dt">n.breaks =</span> <span class="dv">6</span></a>
<a class="sourceLine" id="cb175-24" title="24">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb175-25" title="25"><span class="st">  </span></a>
<a class="sourceLine" id="cb175-26" title="26"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb175-27" title="27">    <span class="dt">x =</span> <span class="kw">expression</span>(delta),</a>
<a class="sourceLine" id="cb175-28" title="28">    <span class="dt">y =</span> <span class="st">&quot;Power&quot;</span>,</a>
<a class="sourceLine" id="cb175-29" title="29">    <span class="dt">title =</span> <span class="st">&quot;Power with Lin Adjustment&quot;</span>,</a>
<a class="sourceLine" id="cb175-30" title="30">    <span class="dt">linetype =</span> <span class="st">&quot;Method:&quot;</span></a>
<a class="sourceLine" id="cb175-31" title="31">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb175-32" title="32"><span class="st">  </span></a>
<a class="sourceLine" id="cb175-33" title="33"><span class="st">  </span>ggridges<span class="op">::</span><span class="kw">theme_ridges</span>(</a>
<a class="sourceLine" id="cb175-34" title="34">    <span class="dt">font_size =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb175-35" title="35">    <span class="dt">center_axis_labels =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb175-36" title="36">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb175-37" title="37"><span class="st">  </span></a>
<a class="sourceLine" id="cb175-38" title="38"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb175-39" title="39">    <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span></a>
<a class="sourceLine" id="cb175-40" title="40">    ) </a></code></pre></div>
<p><img src="OES_SOP_files/figure-html/unnamed-chunk-30-1.png" width=".9\textwidth"></p>
</div>
<div id="incorporating-declaredesign-into-oes-power-tools" class="section level3">
<h3><span class="header-section-number">6.4.3</span> Incorporating DeclareDesign into OES Power Tools</h3>
<p>We can also use <code>DeclareDesign</code> within this <strong>Replicate</strong>, <strong>Estimate</strong>, <strong>Evaluate</strong> framework. This involves using <code>DeclareDesign</code> to draw estimates, and then feeding the results into the OES <code>evaluate_power()</code> function. We compare the <code>DeclareDesign</code> approach to the OES <code>Replicate</code> and <code>Estimate</code> steps below.</p>
<p>First, we simulate a simple design with the OES tools introduced above:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb176-1" title="1">eval &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb176-2" title="2"><span class="st">  </span></a>
<a class="sourceLine" id="cb176-3" title="3"><span class="st">  </span><span class="kw">replicate_design</span>(</a>
<a class="sourceLine" id="cb176-4" title="4">    <span class="dt">R =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb176-5" title="5">    <span class="dt">N =</span> <span class="dv">100</span>,</a>
<a class="sourceLine" id="cb176-6" title="6">    <span class="dt">Y =</span> <span class="kw">rnorm</span>(N),</a>
<a class="sourceLine" id="cb176-7" title="7">    <span class="dt">Z =</span> <span class="kw">rbinom</span>(N, <span class="dv">1</span>, <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb176-8" title="8">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb176-9" title="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb176-10" title="10"><span class="st">  </span><span class="kw">estimate</span>(</a>
<a class="sourceLine" id="cb176-11" title="11">    <span class="dt">form =</span> Y <span class="op">~</span><span class="st"> </span>Z, <span class="dt">vars =</span> <span class="st">&quot;Z&quot;</span></a>
<a class="sourceLine" id="cb176-12" title="12">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb176-13" title="13"><span class="st">  </span></a>
<a class="sourceLine" id="cb176-14" title="14"><span class="st">  </span><span class="kw">evaluate_power</span>(</a>
<a class="sourceLine" id="cb176-15" title="15">    <span class="dt">delta =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.6</span>, <span class="dt">len =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb176-16" title="16">    )</a></code></pre></div>
<p>Then, we do the same with <code>DeclareDesign</code>, declaring a population, potential outcomes, assignments, a target quantity of interest, and an estimator:</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb177-1" title="1">design &lt;-</a>
<a class="sourceLine" id="cb177-2" title="2"><span class="st">  </span></a>
<a class="sourceLine" id="cb177-3" title="3"><span class="st">  </span><span class="kw">declare_population</span>(</a>
<a class="sourceLine" id="cb177-4" title="4">    <span class="dt">N =</span> <span class="dv">100</span>,</a>
<a class="sourceLine" id="cb177-5" title="5">    <span class="dt">U =</span> <span class="kw">rnorm</span>(N),</a>
<a class="sourceLine" id="cb177-6" title="6">    <span class="kw">potential_outcomes</span>(Y <span class="op">~</span><span class="st"> </span>U)</a>
<a class="sourceLine" id="cb177-7" title="7">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb177-8" title="8"><span class="st">  </span></a>
<a class="sourceLine" id="cb177-9" title="9"><span class="st">  </span><span class="kw">declare_assignment</span>(<span class="dt">Z =</span> <span class="kw">simple_ra</span>(N, <span class="dt">prob =</span> <span class="fl">0.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb177-10" title="10"><span class="st">  </span></a>
<a class="sourceLine" id="cb177-11" title="11"><span class="st">  </span><span class="kw">declare_inquiry</span>(<span class="dt">ATE =</span> <span class="kw">mean</span>(Y_Z_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>Y_Z_<span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb177-12" title="12"><span class="st">  </span></a>
<a class="sourceLine" id="cb177-13" title="13"><span class="st">  </span><span class="kw">declare_measurement</span>(<span class="dt">Y =</span> <span class="kw">reveal_outcomes</span>(Y <span class="op">~</span><span class="st"> </span>Z)) <span class="op">+</span></a>
<a class="sourceLine" id="cb177-14" title="14"><span class="st">  </span></a>
<a class="sourceLine" id="cb177-15" title="15"><span class="st">  </span><span class="kw">declare_estimator</span>(</a>
<a class="sourceLine" id="cb177-16" title="16">    Y <span class="op">~</span><span class="st"> </span>Z,</a>
<a class="sourceLine" id="cb177-17" title="17">    <span class="dt">inquiry =</span> <span class="st">&quot;ATE&quot;</span>,</a>
<a class="sourceLine" id="cb177-18" title="18">    <span class="dt">.method =</span> lm_robust</a>
<a class="sourceLine" id="cb177-19" title="19">    )</a></code></pre></div>
<p>We then use draws from this design within the OES tools:</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" title="1">dd_eval &lt;-</a>
<a class="sourceLine" id="cb178-2" title="2"><span class="st">  </span></a>
<a class="sourceLine" id="cb178-3" title="3"><span class="st">  </span><span class="kw">replicate</span>(</a>
<a class="sourceLine" id="cb178-4" title="4">    <span class="dt">n =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb178-5" title="5">    <span class="dt">expr =</span> <span class="kw">draw_estimates</span>(design) <span class="op">%&gt;%</span><span class="st"> </span>list</a>
<a class="sourceLine" id="cb178-6" title="6">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb178-7" title="7"><span class="st">  </span></a>
<a class="sourceLine" id="cb178-8" title="8"><span class="st">  </span><span class="kw">bind_rows</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb178-9" title="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb178-10" title="10"><span class="st">  </span><span class="kw">evaluate_power</span>(</a>
<a class="sourceLine" id="cb178-11" title="11">    <span class="dt">delta =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.6</span>, <span class="dt">len =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb178-12" title="12">    )</a></code></pre></div>
<p>We show the similarity between the two approaches to generating the simulated
data in the figure below:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb179-1" title="1"><span class="kw">bind_rows</span>(</a>
<a class="sourceLine" id="cb179-2" title="2">  eval <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">method =</span> <span class="st">&quot;OES Power Tools&quot;</span>),</a>
<a class="sourceLine" id="cb179-3" title="3">  dd_eval <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">method =</span> <span class="st">&quot;DeclareDesign&quot;</span>)</a>
<a class="sourceLine" id="cb179-4" title="4">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb179-5" title="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb179-6" title="6"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb179-7" title="7"><span class="st">  </span></a>
<a class="sourceLine" id="cb179-8" title="8"><span class="st">  </span><span class="kw">geom_line</span>(</a>
<a class="sourceLine" id="cb179-9" title="9">    <span class="kw">aes</span>(delta, power, <span class="dt">linetype =</span> method)</a>
<a class="sourceLine" id="cb179-10" title="10">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb179-11" title="11"><span class="st">  </span></a>
<a class="sourceLine" id="cb179-12" title="12"><span class="st">  </span><span class="kw">scale_linetype_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;solid&quot;</span>, <span class="st">&quot;longdash&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb179-13" title="13"><span class="st">  </span></a>
<a class="sourceLine" id="cb179-14" title="14"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb179-15" title="15">    <span class="dt">x =</span> <span class="kw">expression</span>(delta),</a>
<a class="sourceLine" id="cb179-16" title="16">    <span class="dt">y =</span> <span class="st">&quot;Power&quot;</span>,</a>
<a class="sourceLine" id="cb179-17" title="17">    <span class="dt">linetype =</span> <span class="ot">NULL</span></a>
<a class="sourceLine" id="cb179-18" title="18">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb179-19" title="19"><span class="st">  </span></a>
<a class="sourceLine" id="cb179-20" title="20"><span class="st">  </span><span class="kw">scale_y_continuous</span>(</a>
<a class="sourceLine" id="cb179-21" title="21">    <span class="dt">n.breaks =</span> <span class="dv">6</span></a>
<a class="sourceLine" id="cb179-22" title="22">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb179-23" title="23"><span class="st">  </span></a>
<a class="sourceLine" id="cb179-24" title="24"><span class="st">  </span><span class="kw">geom_hline</span>(</a>
<a class="sourceLine" id="cb179-25" title="25">    <span class="dt">yintercept =</span> <span class="fl">0.8</span>,</a>
<a class="sourceLine" id="cb179-26" title="26">    <span class="dt">col =</span> <span class="st">&quot;grey25&quot;</span>,</a>
<a class="sourceLine" id="cb179-27" title="27">    <span class="dt">size =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb179-28" title="28">    <span class="dt">alpha =</span> <span class="fl">0.8</span></a>
<a class="sourceLine" id="cb179-29" title="29">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb179-30" title="30"><span class="st">  </span></a>
<a class="sourceLine" id="cb179-31" title="31"><span class="st">  </span>ggridges<span class="op">::</span><span class="kw">theme_ridges</span>(</a>
<a class="sourceLine" id="cb179-32" title="32">    <span class="dt">center_axis_labels =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb179-33" title="33">    <span class="dt">font_size =</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb179-34" title="34">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb179-35" title="35"><span class="st">  </span></a>
<a class="sourceLine" id="cb179-36" title="36"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb179-37" title="37">    <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span></a>
<a class="sourceLine" id="cb179-38" title="38">    )</a></code></pre></div>
<p><img src="OES_SOP_files/figure-html/unnamed-chunk-34-1.png" width=".9\textwidth"></p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-lin_agnostic_2013">
<p>Lin, Winston. 2013. &#x201C;Agnostic Notes on Regression Adjustments to Experimental Data: Reexamining Freedman&#x2019;s Critique.&#x201D; <em>The Annals of Applied Statistics</em> 7 (1): 295&#x2013;318.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="analysis-choices.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="glossary-of-terms.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/gsa-oes/sop/edit/master/Book/06-poweranalysis.Rmd",
"text": "Edit"
},
"download": ["OES_SOP.pdf", "OES_SOP.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
