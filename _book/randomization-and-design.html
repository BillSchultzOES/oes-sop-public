<!DOCTYPE html>
<html>

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>OES Standard Operating Procedures for The Design and Statistical Analysis of Experiments.</title>
  <meta name="description" content="These are the current standard operating procedures for statistical analysis of the Office of Evaluation Sciences in the GSA">
  <meta name="generator" content="bookdown &lt;!--bookdown:version--&gt; and GitBook 2.6.7">

  <meta property="og:title" content="OES Standard Operating Procedures for The Design and Statistical Analysis of Experiments.">
  <meta property="og:type" content="book">
  
  
  <meta property="og:description" content="These are the current standard operating procedures for statistical analysis of the Office of Evaluation Sciences in the GSA">
  <meta name="github-repo" content="gsa-oes/sop">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="OES Standard Operating Procedures for The Design and Statistical Analysis of Experiments.">
  
  <meta name="twitter:description" content="These are the current standard operating procedures for statistical analysis of the Office of Evaluation Sciences in the GSA">
  

<meta name="author" content="Jake Bowers, Ryan T. Moore, Lula Chen, Paul Testa, Nate Higgins, Oliver McClellan, Miles Williams, Tyler Simko, Bill Schultz">


<meta name="date" content="2023-09-05">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="design-based-principles-of-statistical-inference.html">
<link rel="next" href="analysis-choices.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet">







<script src="libs/kePrint/kePrint.js"></script>
<link href="libs/lightable/lightable.css" rel="stylesheet">

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}
</script>
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
.row { display: flex; }
.collapse { display: none; }
.in { display:block }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/katex.min.css" data-external="1"></head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The OES SOP</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#purposes-of-this-document"><i class="fa fa-check"></i>Purposes of this document</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#nature-and-limitations-of-this-document"><i class="fa fa-check"></i>Nature and limitations of this document</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#we-mostly-focus-on-randomized-field-experiments."><i class="fa fa-check"></i>We (mostly) focus on randomized field experiments.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#we-present-examples-using-r"><i class="fa fa-check"></i>We present examples using R</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#structure-of-the-document"><i class="fa fa-check"></i>Structure of the document</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#help-us-improve-our-work"><i class="fa fa-check"></i>Help us improve our work!</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-document"><i class="fa fa-check"></i>About this document</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="statistical-and-causal-inference-for-policy-change.html"><a href="statistical-and-causal-inference-for-policy-change.html"><i class="fa fa-check"></i><b>1</b> Statistical and causal inference for policy change</a></li>
<li class="chapter" data-level="2" data-path="basics-of-experimental-design-and-analysis.html"><a href="basics-of-experimental-design-and-analysis.html"><i class="fa fa-check"></i><b>2</b> Basics of Experimental Design and Analysis</a><ul>
<li class="chapter" data-level="2.1" data-path="basics-of-experimental-design-and-analysis.html"><a href="basics-of-experimental-design-and-analysis.html#statistical-power-designing-studies-that-effectively-distinguish-signal-from-noise"><i class="fa fa-check"></i><b>2.1</b> Statistical Power: Designing Studies that effectively distinguish signal from noise</a></li>
<li class="chapter" data-level="2.2" data-path="basics-of-experimental-design-and-analysis.html"><a href="basics-of-experimental-design-and-analysis.html#error-rates-of-tests"><i class="fa fa-check"></i><b>2.2</b> Error Rates of Tests</a></li>
<li class="chapter" data-level="2.3" data-path="basics-of-experimental-design-and-analysis.html"><a href="basics-of-experimental-design-and-analysis.html#bias-in-estimators"><i class="fa fa-check"></i><b>2.3</b> Bias in Estimators</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="design-based-principles-of-statistical-inference.html"><a href="design-based-principles-of-statistical-inference.html"><i class="fa fa-check"></i><b>3</b> Design-Based Principles of Statistical Inference</a><ul>
<li class="chapter" data-level="3.1" data-path="design-based-principles-of-statistical-inference.html"><a href="design-based-principles-of-statistical-inference.html#randinfex"><i class="fa fa-check"></i><b>3.1</b> An example using simulated data</a><ul>
<li class="chapter" data-level="3.1.1" data-path="design-based-principles-of-statistical-inference.html"><a href="design-based-principles-of-statistical-inference.html#how-do-we-calculate-randomization-based-standard-errors"><i class="fa fa-check"></i><b>3.1.1</b> How do we calculate randomization-based standard errors?</a></li>
<li class="chapter" data-level="3.1.2" data-path="design-based-principles-of-statistical-inference.html"><a href="design-based-principles-of-statistical-inference.html#how-do-we-calculate-randomization-based-confidence-intervals"><i class="fa fa-check"></i><b>3.1.2</b> How do we calculate randomization-based confidence intervals?</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="design-based-principles-of-statistical-inference.html"><a href="design-based-principles-of-statistical-inference.html#summary-what-does-a-design-based-approach-mean-for-policy-evaluation"><i class="fa fa-check"></i><b>3.2</b> Summary: What does a design based approach mean for policy evaluation?</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="randomization-and-design.html"><a href="randomization-and-design.html"><i class="fa fa-check"></i><b>4</b> Randomization and Design</a><ul>
<li class="chapter" data-level="4.1" data-path="randomization-and-design.html"><a href="randomization-and-design.html#coin-flipping-randomization-versus-urn-drawing-randomization"><i class="fa fa-check"></i><b>4.1</b> Coin flipping randomization versus Urn-drawing randomization</a></li>
<li class="chapter" data-level="4.2" data-path="randomization-and-design.html"><a href="randomization-and-design.html#urn-drawing-or-complete-randomization-into-2-or-more-groups"><i class="fa fa-check"></i><b>4.2</b> Urn-Drawing or Complete Randomization into 2 or more groups</a></li>
<li class="chapter" data-level="4.3" data-path="randomization-and-design.html"><a href="randomization-and-design.html#factorial-designs"><i class="fa fa-check"></i><b>4.3</b> Factorial Designs</a></li>
<li class="chapter" data-level="4.4" data-path="randomization-and-design.html"><a href="randomization-and-design.html#block-random-assignment"><i class="fa fa-check"></i><b>4.4</b> Block Random Assignment</a><ul>
<li class="chapter" data-level="4.4.1" data-path="randomization-and-design.html"><a href="randomization-and-design.html#using-only-a-few-covariates-to-create-blocks"><i class="fa fa-check"></i><b>4.4.1</b> Using only a few covariates to create blocks</a></li>
<li class="chapter" data-level="4.4.2" data-path="randomization-and-design.html"><a href="randomization-and-design.html#multivariate-blocking-using-many-covariates"><i class="fa fa-check"></i><b>4.4.2</b> Multivariate blocking using many covariates</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="randomization-and-design.html"><a href="randomization-and-design.html#cluster-random-assignment"><i class="fa fa-check"></i><b>4.5</b> Cluster random assignment</a></li>
<li class="chapter" data-level="4.6" data-path="randomization-and-design.html"><a href="randomization-and-design.html#other-designs"><i class="fa fa-check"></i><b>4.6</b> Other designs</a></li>
<li class="chapter" data-level="4.7" data-path="randomization-and-design.html"><a href="randomization-and-design.html#assessing-randomization-balance-testing"><i class="fa fa-check"></i><b>4.7</b> Assessing randomization (balance testing)</a><ul>
<li class="chapter" data-level="4.7.1" data-path="randomization-and-design.html"><a href="randomization-and-design.html#what-to-do-with-failed-randomization-assessments"><i class="fa fa-check"></i><b>4.7.1</b> What to do with &#x201C;failed&#x201D; randomization assessments?</a></li>
<li class="chapter" data-level="4.7.2" data-path="randomization-and-design.html"><a href="randomization-and-design.html#minimizing-the-chances-of-failed-randomization"><i class="fa fa-check"></i><b>4.7.2</b> Minimizing the chances of &#x201C;failed&#x201D; randomization</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="analysis-choices.html"><a href="analysis-choices.html"><i class="fa fa-check"></i><b>5</b> Analysis Choices</a><ul>
<li class="chapter" data-level="5.1" data-path="analysis-choices.html"><a href="analysis-choices.html#completely-or-urn-draw-randomized-trials"><i class="fa fa-check"></i><b>5.1</b> Completely or Urn-Draw Randomized Trials</a><ul>
<li class="chapter" data-level="5.1.1" data-path="analysis-choices.html"><a href="analysis-choices.html#two-arms"><i class="fa fa-check"></i><b>5.1.1</b> Two arms</a></li>
<li class="chapter" data-level="5.1.2" data-path="analysis-choices.html"><a href="analysis-choices.html#multiple-arms"><i class="fa fa-check"></i><b>5.1.2</b> Multiple arms</a></li>
<li class="chapter" data-level="5.1.3" data-path="analysis-choices.html"><a href="analysis-choices.html#multiple-outcomes"><i class="fa fa-check"></i><b>5.1.3</b> Multiple Outcomes</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="analysis-choices.html"><a href="analysis-choices.html#covariance-adjustment-the-use-of-background-information-to-increase-precision"><i class="fa fa-check"></i><b>5.2</b> Covariance Adjustment (the use of background information to increase precision)</a><ul>
<li class="chapter" data-level="5.2.1" data-path="analysis-choices.html"><a href="analysis-choices.html#intuition-about-bias-in-the-least-squares-estimator-of-the-ate-with-covariates"><i class="fa fa-check"></i><b>5.2.1</b> Intuition about bias in the least squares estimator of the ATE with covariates</a></li>
<li class="chapter" data-level="5.2.2" data-path="analysis-choices.html"><a href="analysis-choices.html#the-lin-approach-to-covariance-adjustment"><i class="fa fa-check"></i><b>5.2.2</b> The Lin Approach to Covariance Adjustment</a></li>
<li class="chapter" data-level="5.2.3" data-path="analysis-choices.html"><a href="analysis-choices.html#the-rosenbaum-approach-the-covariance-adjustment"><i class="fa fa-check"></i><b>5.2.3</b> The Rosenbaum Approach The Covariance Adjustment</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="analysis-choices.html"><a href="analysis-choices.html#how-to-choose-covariates-for-covariance-adjustment"><i class="fa fa-check"></i><b>5.3</b> How to choose covariates for covariance adjustment?</a></li>
<li class="chapter" data-level="5.4" data-path="analysis-choices.html"><a href="analysis-choices.html#blockrandanalysis"><i class="fa fa-check"></i><b>5.4</b> Block-randomized trials</a><ul>
<li class="chapter" data-level="5.4.1" data-path="analysis-choices.html"><a href="analysis-choices.html#testing-the-null-of-no-effects-with-binary-outcomes-and-block-randomization-cochran-mantel-haenszel-cmh-test-for-k-x-2-x-2-tables"><i class="fa fa-check"></i><b>5.4.1</b> Testing the null of no effects with binary outcomes and block randomization: Cochran-Mantel-Haenszel (CMH) test for K X 2 X 2 tables</a></li>
<li class="chapter" data-level="5.4.2" data-path="analysis-choices.html"><a href="analysis-choices.html#blockrandate"><i class="fa fa-check"></i><b>5.4.2</b> Estimating an overall Average Treatment Effect</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="analysis-choices.html"><a href="analysis-choices.html#clusterrandanalysis"><i class="fa fa-check"></i><b>5.5</b> Cluster-randomized trials</a><ul>
<li class="chapter" data-level="5.5.1" data-path="analysis-choices.html"><a href="analysis-choices.html#bias-when-cluster-size-is-correlated-with-potential-outcomes"><i class="fa fa-check"></i><b>5.5.1</b> Bias when cluster size is correlated with potential outcomes</a></li>
<li class="chapter" data-level="5.5.2" data-path="analysis-choices.html"><a href="analysis-choices.html#incorrect-false-positive-rates-from-tests-and-confidence-intervals"><i class="fa fa-check"></i><b>5.5.2</b> Incorrect false positive rates from tests and confidence intervals</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="poweranalysis.html"><a href="poweranalysis.html"><i class="fa fa-check"></i><b>6</b> Power Analysis</a><ul>
<li class="chapter" data-level="6.1" data-path="poweranalysis.html"><a href="poweranalysis.html#an-example-of-the-off-the-shelf-approach"><i class="fa fa-check"></i><b>6.1</b> An example of the off-the-shelf approach</a></li>
<li class="chapter" data-level="6.2" data-path="poweranalysis.html"><a href="poweranalysis.html#an-example-of-the-simulation-approach"><i class="fa fa-check"></i><b>6.2</b> An example of the simulation approach</a></li>
<li class="chapter" data-level="6.3" data-path="poweranalysis.html"><a href="poweranalysis.html#when-to-use-which-approach"><i class="fa fa-check"></i><b>6.3</b> When to use which approach</a></li>
<li class="chapter" data-level="6.4" data-path="poweranalysis.html"><a href="poweranalysis.html#additional-examples-of-the-simulation-approach"><i class="fa fa-check"></i><b>6.4</b> Additional examples of the simulation approach</a><ul>
<li class="chapter" data-level="6.4.1" data-path="poweranalysis.html"><a href="poweranalysis.html#a-two-by-two-design-with-interaction"><i class="fa fa-check"></i><b>6.4.1</b> A two-by-two design with interaction</a></li>
<li class="chapter" data-level="6.4.2" data-path="poweranalysis.html"><a href="poweranalysis.html#covariate-adjustment-with-the-lin-estimator"><i class="fa fa-check"></i><b>6.4.2</b> Covariate adjustment with the Lin estimator</a></li>
<li class="chapter" data-level="6.4.3" data-path="poweranalysis.html"><a href="poweranalysis.html#incorporating-declaredesign-into-oes-power-tools"><i class="fa fa-check"></i><b>6.4.3</b> Incorporating DeclareDesign into OES Power Tools</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="working-with-data.html"><a href="working-with-data.html"><i class="fa fa-check"></i><b>7</b> Working with data</a><ul>
<li class="chapter" data-level="7.1" data-path="working-with-data.html"><a href="working-with-data.html#general-questions-we-ask-of-a-data-set"><i class="fa fa-check"></i><b>7.1</b> General questions we ask of a data set</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="glossary-of-terms.html"><a href="glossary-of-terms.html"><i class="fa fa-check"></i><b>8</b> <span>Glossary of Terms</span></a></li>
<li class="chapter" data-level="9" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>9</b> <span>Appendix</span></a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://oes.gsa.gov" target="blank">Published by the OES</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">OES Standard Operating Procedures for The Design and Statistical Analysis of Experiments.</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="randomization-and-design" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Randomization and Design</h1>
<p>After working together with our agency partners to translate insights from the
social and behavioral sciences into potential policy recommendations following <a href="https://oes.gsa.gov/methods/">processes</a> described on our website, we assess these new ideas by observing differences or changes in real world outcomes (usually measured using existing administrative data). In most cases, we design a randomized control trial (an RCT) to ensure that the differences or changes we observe are driven by the policy intervention itself. Here, we show examples of the different methods we consider for randomly assigning units to treatment. These form the core of the different types of RCTs that we use to build evidence about the effectiveness of the new policies.</p>
<div id="coin-flipping-randomization-versus-urn-drawing-randomization" class="section level2">
<h2><span class="header-section-number">4.1</span> Coin flipping randomization versus Urn-drawing randomization</h2>
<p>Many discussions of RCTs begin by talking about the intervention being assigned to units (people, schools, offices, districts) &#x201C;by the flip of a coin,&#x201D; or <strong>simple</strong> random assignment. In other words, each unit&#x2019;s assignment to treatment occurs separately, and there is no <em>ex ante</em> guarantee as to exactly what the final number of treated or control units will be. We rarely use this method in practice, even though it is a useful way to introduce the idea that RCTs guarantee fair access to the new policy.</p>
<p>The following code contrasts coin-flipping style random assignment with drawing-from-an-urn style, or <strong>complete</strong> random assignment (where a fixed number of units are randomly chosen for treatment). Coin-flipping based experiments are still valid and tell us about the underlying counterfactuals, but they can have less statistical power, so we often try to avoid them.</p>
<p>Notice that the simple random assignment implemented in the code below results in more observations in the treatment group (group <code>T</code>) than in the control group (group <code>C</code>). Complete random assignment will always assign 5 units to the treatment, 5 to the control.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1"><span class="co">## Start with a small experiment with only 10 units</span></a>
<a class="sourceLine" id="cb27-2" title="2">n &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb27-3" title="3"><span class="co">## Set a seed for the pseudo-random number generator so that we always get the same results</span></a>
<a class="sourceLine" id="cb27-4" title="4"><span class="kw">set.seed</span>(<span class="dv">12345</span>)</a>
<a class="sourceLine" id="cb27-5" title="5"><span class="co">## Function to add more intuitive labels</span></a>
<a class="sourceLine" id="cb27-6" title="6">labelTC &lt;-<span class="st"> </span><span class="cf">function</span>(assignments) {<span class="kw">ifelse</span>(assignments <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;T&quot;</span>, <span class="st">&quot;C&quot;</span>)}</a>
<a class="sourceLine" id="cb27-7" title="7"><span class="co">## Simulation using functions from the randomizr package</span></a>
<a class="sourceLine" id="cb27-8" title="8">trt_coinflip &lt;-<span class="st"> </span><span class="kw">labelTC</span>(<span class="kw">simple_ra</span>(n))</a>
<a class="sourceLine" id="cb27-9" title="9">trt_urn &lt;-<span class="st"> </span><span class="kw">labelTC</span>(<span class="kw">complete_ra</span>(n))</a>
<a class="sourceLine" id="cb27-10" title="10"><span class="co">## Coin flipping does not guarantee half and half treated and control.</span></a>
<a class="sourceLine" id="cb27-11" title="11"><span class="co">## Drawing from an urn, guarantees half treated and control.</span></a>
<a class="sourceLine" id="cb27-12" title="12"><span class="kw">table</span>(trt_coinflip)</a></code></pre></div>
<pre><code>trt_coinflip
C T 
3 7 </code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1"><span class="kw">table</span>(trt_urn)</a></code></pre></div>
<pre><code>trt_urn
C T 
5 5 </code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1"><span class="co">## Alternative approach using base R</span></a>
<a class="sourceLine" id="cb31-2" title="2"><span class="co"># set.seed(12345)</span></a>
<a class="sourceLine" id="cb31-3" title="3"><span class="co"># trt_coinflip &lt;- labelTC(rbinom(10, size = 1, prob = .5))</span></a>
<a class="sourceLine" id="cb31-4" title="4"><span class="co"># trt_urn &lt;- labelTC(sample(rep(c(1, 0), n / 2)))</span></a>
<a class="sourceLine" id="cb31-5" title="5"><span class="co"># table(trt_coinflip)</span></a>
<a class="sourceLine" id="cb31-6" title="6"><span class="co"># table(trt_urn)</span></a></code></pre></div>
</div>
<div id="urn-drawing-or-complete-randomization-into-2-or-more-groups" class="section level2">
<h2><span class="header-section-number">4.2</span> Urn-Drawing or Complete Randomization into 2 or more groups</h2>
<p>We tend to use the <code>randomizr</code> R package <span class="citation">(Coppock <a href="#ref-R-randomizr">2022</a><a href="#ref-R-randomizr">a</a>)</span> for simple designs
rather than the base R <code>sample</code> function because <code>randomizr</code> does some
quality control checks. Notice that we implement a check on our code below with the <code>stopifnot</code> command: the code will stop and issue a warning if we didn&#x2019;t actually assign 1/4 of the observations to the treatment condition. Here, we assign the units first to 2 arms with equal probability (<code>Z2armEqual</code>). Then, to show how the code works, we assign them to 2 arms where one arm has only a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mn>4</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{4}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> probability of receiving treatment (e.g., imagine a design with an expensive intervention). Last, we assign them based on a design with 4 different arms, each with equal probability (e.g., one control group and three different treatments under consideration). We often use <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi></mrow><annotation encoding="application/x-tex">Z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span></span></span></span> to refer to the variable recording our intervention arms.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1">N &lt;-<span class="st"> </span><span class="kw">nrow</span>(dat1)</a>
<a class="sourceLine" id="cb32-2" title="2"><span class="kw">set.seed</span>(<span class="dv">12345</span>)</a>
<a class="sourceLine" id="cb32-3" title="3"><span class="co">## Two equal arms</span></a>
<a class="sourceLine" id="cb32-4" title="4">dat1<span class="op">$</span>Z2armEqual &lt;-<span class="st"> </span><span class="kw">labelTC</span>(<span class="kw">complete_ra</span>(N))</a>
<a class="sourceLine" id="cb32-5" title="5"><span class="co">## Two unequal arms: .25 chance of treatment (.75 chance of control0</span></a>
<a class="sourceLine" id="cb32-6" title="6">dat1<span class="op">$</span>Z2armUnequalA &lt;-<span class="st"> </span><span class="kw">labelTC</span>(<span class="kw">complete_ra</span>(N,<span class="dt">prob=</span>.<span class="dv">25</span>))</a>
<a class="sourceLine" id="cb32-7" title="7"><span class="kw">stopifnot</span>(<span class="kw">sum</span>(dat1<span class="op">$</span>Z2armUnequalA<span class="op">==</span><span class="st">&quot;T&quot;</span>)<span class="op">==</span>N<span class="op">/</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb32-8" title="8">dat1<span class="op">$</span>Z2armUnequalB &lt;-<span class="st"> </span><span class="kw">labelTC</span>(<span class="kw">complete_ra</span>(N,<span class="dt">m=</span>N<span class="op">/</span><span class="dv">4</span>))</a>
<a class="sourceLine" id="cb32-9" title="9"><span class="co">## Four equal arms</span></a>
<a class="sourceLine" id="cb32-10" title="10">dat1<span class="op">$</span>Z4arms &lt;-<span class="st"> </span><span class="kw">complete_ra</span>(N,<span class="dt">m_each=</span><span class="kw">rep</span>(N<span class="op">/</span><span class="dv">4</span>,<span class="dv">4</span>))</a>
<a class="sourceLine" id="cb32-11" title="11"></a>
<a class="sourceLine" id="cb32-12" title="12"><span class="kw">table</span>(<span class="dt">Z2armEqual=</span>dat1<span class="op">$</span>Z2armEqual)</a></code></pre></div>
<pre><code>Z2armEqual
 C  T 
50 50 </code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1"><span class="kw">table</span>(<span class="dt">Z2armUnequalA=</span>dat1<span class="op">$</span>Z2armUnequalA)</a></code></pre></div>
<pre><code>Z2armUnequalA
 C  T 
75 25 </code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1"><span class="kw">table</span>(<span class="dt">Z2armUnequalB=</span>dat1<span class="op">$</span>Z2armUnequalB)</a></code></pre></div>
<pre><code>Z2armUnequalB
 C  T 
75 25 </code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1"><span class="kw">table</span>(<span class="dt">Z4arms=</span>dat1<span class="op">$</span>Z4arms)</a></code></pre></div>
<pre><code>Z4arms
T1 T2 T3 T4 
25 25 25 25 </code></pre>
</div>
<div id="factorial-designs" class="section level2">
<h2><span class="header-section-number">4.3</span> Factorial Designs</h2>
<p>It&#x2019;s possible to test the effects of more than one intervention without losing much statistical power by randomly assigning multiple treatments independently of each other. The simplest design that we use for this purpose is the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>&#xD7;</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2 \times 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">&#xD7;</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span> <strong>factorial</strong> design. For example, in the next table we see that we have assigned 50 observations to each arm of two separate interventions. Since the randomization of <code>treatment1</code> is independent of <code>treatment2</code>, we can assess the effects of each treatment separately and pay less of a power penalty (unless one of the treatments dramatically increases the variance of the outcome compared to the experiment with only one treatment assigned).</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" title="1"><span class="co">## Two equal arms, adding a second cross treatment</span></a>
<a class="sourceLine" id="cb40-2" title="2">dat1<span class="op">$</span>Z2armEqual2 &lt;-<span class="st"> </span><span class="kw">labelTC</span>(<span class="kw">complete_ra</span>(N))</a>
<a class="sourceLine" id="cb40-3" title="3"><span class="kw">table</span>(<span class="dt">treatment1=</span>dat1<span class="op">$</span>Z2armEqual,<span class="dt">treatment2=</span>dat1<span class="op">$</span>Z2armEqual2)</a></code></pre></div>
<pre><code>          treatment2
treatment1  C  T
         C 23 27
         T 27 23</code></pre>
<p>Although factorial designs allow us to test more than one intervention at the
same time, they tend to provide less statistical power when testing
hypotheses about the <em>interaction</em> of the two treatments. If we want to
learn about how two different interventions work together, then the sample
size requirements will be much larger than if we were satisfied with learning about each treatment separately.<a href="references.html#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></p>
</div>
<div id="block-random-assignment" class="section level2">
<h2><span class="header-section-number">4.4</span> Block Random Assignment</h2>
<p>Statistical power depends not only on the size of the experiment and the strength of the treatment effect, but also on the amount of noise, or non-treatment-related variability, in outcomes. Block-randomized designs can help reduce this noise while simultaneously minimizing estimation error &#x2013; the amount that our particular experiment&#x2019;s estimate differs from the truth.</p>
<p>In a <strong>block-randomized</strong>, or stratified, design, we randomly assign units to the policy intervention <em>within</em> pre-specified groups.<a href="references.html#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></p>
<p>Suppose we are evaluating whether dedicated navigators can increase the percentage of students living in public housing who complete federal financial aid applications (FAFSA). Our experiment will send navigators to two of four eligible buildings, two of which are large and two of which are small. In a real study we can never know the outcome in all buildings both with and without navigators (the &#x201C;fundamental problem of causal inference&#x201D;). But if we could, we might have the data below:</p>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Building
</th>
<th style="text-align:left;">
Size
</th>
<th style="text-align:right;">
% FAFSA (No Navigator)
</th>
<th style="text-align:right;">
% FAFSA (With Navigator)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
Large
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
60
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
Large
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
70
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
Small
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
30
</td>
</tr>
<tr>
<td style="text-align:left;border-bottom: 1px solid">
4
</td>
<td style="text-align:left;border-bottom: 1px solid">
Small
</td>
<td style="text-align:right;border-bottom: 1px solid">
30
</td>
<td style="text-align:right;border-bottom: 1px solid">
40
</td>
</tr>
<tr>
<td style="text-align:left;border-bottom: 1px solid">
Mean
</td>
<td style="text-align:left;border-bottom: 1px solid">
</td>
<td style="text-align:right;border-bottom: 1px solid">
25
</td>
<td style="text-align:right;border-bottom: 1px solid">
50
</td>
</tr>
</tbody>
</table>
<p>The true average treatment effect for this sample is the average under treatment (i.e., the average treated potential outcome) minus the average under control (i.e., the average control potential outcome): <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>ATE</mtext><mo>=</mo><mn>50</mn><mo>&#x2212;</mo><mn>25</mn><mo>=</mo><mn>25</mn></mrow><annotation encoding="application/x-tex">\text{ATE} = 50-25=25</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord">ATE</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">50</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">25</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">25</span></span></span></span> percent more applications per building when a navigator is deployed.</p>
<p>In a real study, we might randomly allocate two buildings to treatment and two buildings to control. If complete random assignment led to us treating the first two buildings, then we might observe:</p>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Building
</th>
<th style="text-align:left;">
Size
</th>
<th style="text-align:left;">
Treated
</th>
<th style="text-align:left;">
% FAFSA (No Navigator)
</th>
<th style="text-align:left;">
% FAFSA (With Navigator)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
Large
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
60
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
Large
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
70
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
Small
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
20
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;border-bottom: 1px solid">
4
</td>
<td style="text-align:left;border-bottom: 1px solid">
Small
</td>
<td style="text-align:left;border-bottom: 1px solid">
0
</td>
<td style="text-align:left;border-bottom: 1px solid">
30
</td>
<td style="text-align:left;border-bottom: 1px solid">
</td>
</tr>
<tr>
<td style="text-align:left;border-bottom: 1px solid">
Mean
</td>
<td style="text-align:left;border-bottom: 1px solid">
</td>
<td style="text-align:left;border-bottom: 1px solid">
</td>
<td style="text-align:left;border-bottom: 1px solid">
25
</td>
<td style="text-align:left;border-bottom: 1px solid">
65
</td>
</tr>
</tbody>
</table>
<p>This yields a treatment effect estimate of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>65</mn><mo>&#x2212;</mo><mn>25</mn><mo>=</mo><mn>40</mn></mrow><annotation encoding="application/x-tex">65-25 = 40</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">65</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">25</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">40</span></span></span></span> percent more applications due to the presence of a navigator. This is <em>larger</em> than the true value of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>25</mn></mrow><annotation encoding="application/x-tex">25</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">25</span></span></span></span>.</p>
<p>Or, if random assignment led to the other two buildings being treated instead, we might then observe:</p>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Building
</th>
<th style="text-align:left;">
Size
</th>
<th style="text-align:left;">
Treated
</th>
<th style="text-align:left;">
% FAFSA (No Navigator)
</th>
<th style="text-align:left;">
% FAFSA (With Navigator)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
Large
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
20
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
Large
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
30
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
Small
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
30
</td>
</tr>
<tr>
<td style="text-align:left;border-bottom: 1px solid">
4
</td>
<td style="text-align:left;border-bottom: 1px solid">
Small
</td>
<td style="text-align:left;border-bottom: 1px solid">
1
</td>
<td style="text-align:left;border-bottom: 1px solid">
</td>
<td style="text-align:left;border-bottom: 1px solid">
40
</td>
</tr>
<tr>
<td style="text-align:left;border-bottom: 1px solid">
Mean
</td>
<td style="text-align:left;border-bottom: 1px solid">
</td>
<td style="text-align:left;border-bottom: 1px solid">
</td>
<td style="text-align:left;border-bottom: 1px solid">
25
</td>
<td style="text-align:left;border-bottom: 1px solid">
35
</td>
</tr>
</tbody>
</table>
<p>This, in contrast, yields an estimated treatment effect of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>35</mn><mo>&#x2212;</mo><mn>25</mn><mo>=</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">35-25 = 10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">35</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">25</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">10</span></span></span></span> percentage point more applications due to the navigators &#x2013; now <em>smaller</em> than the true value of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>25</mn></mrow><annotation encoding="application/x-tex">25</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">25</span></span></span></span>.</p>
<p>All of the possible (equiprobable) assignments with two treated and two control units, along with their estimated treatment effects, are listed in the table below:</p>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Assignments
</th>
<th style="text-align:right;">
Estimated Effect
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
TTCC
</td>
<td style="text-align:right;">
40
</td>
</tr>
<tr>
<td style="text-align:left;">
CTCT
</td>
<td style="text-align:right;">
35
</td>
</tr>
<tr>
<td style="text-align:left;">
TCCT
</td>
<td style="text-align:right;">
25
</td>
</tr>
<tr>
<td style="text-align:left;">
CTTC
</td>
<td style="text-align:right;">
25
</td>
</tr>
<tr>
<td style="text-align:left;">
TCTC
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
CCTT
</td>
<td style="text-align:right;">
10
</td>
</tr>
</tbody>
</table>
<p>These possible treatment effect estimates have a mean equal to the true value of 25, illustrating the difference in means is an unbiased estimator. However, some of these estimates are far from the truth, and they have a lot of variability.</p>
<p>To design an experiment that better estimates the true value, and does so with more statistical power (less variability), we can randomly assign units within <em>blocks</em>. In general, units should be sorted into different blocks based on their similarity across one or more characteristics that we expect to be correlated with our outcome. Here, blocking implies restricting the possible random assignments to those that have one large and one small building in each treatment group:</p>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Assignments
</th>
<th style="text-align:right;">
Estimated Effect
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
CTCT
</td>
<td style="text-align:right;">
35
</td>
</tr>
<tr>
<td style="text-align:left;">
TCCT
</td>
<td style="text-align:right;">
25
</td>
</tr>
<tr>
<td style="text-align:left;">
CTTC
</td>
<td style="text-align:right;">
25
</td>
</tr>
<tr>
<td style="text-align:left;">
TCTC
</td>
<td style="text-align:right;">
15
</td>
</tr>
</tbody>
</table>
<p>With this blocked design restricting the random assignments that are possible, we now get an estimate that is no more than 10 percentage points from the truth. Further, our estimates will have less variability (an SD of 8.16 rather than 11.4). This improves the statistical power of our design.</p>
<p>For a more realistic example, suppose we are designing an experiment
where the sample includes patients from two different hospitals. We might randomly assign patients to treatment and control <em>within</em> each hospital. For instance, we might assign half of the patients in hospital &#x201C;A&#x201D; to treatment and half to control, then do the same in hospital &#x201C;B.&#x201D;<a href="references.html#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a> Below, we have 50 units in hospital &#x201C;A&#x201D; and 50 in hospital &#x201C;B&#x201D;:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1">dat1<span class="op">$</span>blockID &lt;-<span class="st"> </span><span class="kw">gl</span>(<span class="dt">n =</span> <span class="dv">2</span>, <span class="dt">k =</span> N<span class="op">/</span><span class="dv">2</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Block A&quot;</span>, <span class="st">&quot;Block B&quot;</span>))</a>
<a class="sourceLine" id="cb42-2" title="2"><span class="kw">with</span>(dat1,<span class="kw">table</span>(<span class="dt">blockID=</span>dat1<span class="op">$</span>blockID))</a></code></pre></div>
<pre><code>blockID
Block A Block B 
     50      50 </code></pre>
<p>We assign half of the units in each hospital to each treatment condition:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" title="1">dat1<span class="op">$</span>Z2armBlocked &lt;-<span class="st"> </span><span class="kw">labelTC</span>(<span class="kw">block_ra</span>(<span class="dt">blocks=</span>dat1<span class="op">$</span>blockID))</a>
<a class="sourceLine" id="cb44-2" title="2"><span class="kw">with</span>(dat1,<span class="kw">table</span>(blockID,Z2armBlocked))</a></code></pre></div>
<pre><code>         Z2armBlocked
blockID    C  T
  Block A 25 25
  Block B 25 25</code></pre>
<p>If, say, there were fewer people eligible for treatment in hospital &#x201C;A&#x201D; &#x2014; or perhaps the intervention was more expensive in that block &#x2014; we might choose different treatment probabilities for each block. The code below assigns half of the hospital &#x201C;A&#x201D; patients to treatment, but only a quarter of those from hospital &#x201C;B&#x201D;. Again, we also check that this code worked. This approach is an informal version of one of the best practices for writing code in general, called &#x201C;unit testing.&#x201D; See the <a href="https://egap.org/resource/10-things-to-know-about-project-workflow/">EGAP Guide to Workflow</a> for more examples.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1"><span class="co">## Blocked assignment, unequal probability</span></a>
<a class="sourceLine" id="cb46-2" title="2">dat1<span class="op">$</span>Z2armBlockedUneqProb &lt;-<span class="st"> </span><span class="kw">labelTC</span>(<span class="kw">block_ra</span>(<span class="dt">blocks=</span>dat1<span class="op">$</span>blockID,<span class="dt">block_prob =</span> <span class="kw">c</span>(.<span class="dv">5</span>,.<span class="dv">25</span>)))</a>
<a class="sourceLine" id="cb46-3" title="3"><span class="kw">with</span>(dat1,<span class="kw">table</span>(blockID,Z2armBlockedUneqProb))</a></code></pre></div>
<pre><code>         Z2armBlockedUneqProb
blockID    C  T
  Block A 25 25
  Block B 38 12</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" title="1"><span class="co">## Unit testing</span></a>
<a class="sourceLine" id="cb48-2" title="2">NumTreatedB &lt;-<span class="st"> </span><span class="kw">sum</span>(dat1<span class="op">$</span>Z2armBlockedUneqProb<span class="op">==</span><span class="st">&quot;T&quot;</span><span class="op">&amp;</span>dat1<span class="op">$</span>blockID<span class="op">==</span><span class="st">&quot;Block B&quot;</span>)</a>
<a class="sourceLine" id="cb48-3" title="3">ExpectedNumTreatedB &lt;-<span class="st"> </span><span class="kw">sum</span>(dat1<span class="op">$</span>blockID<span class="op">==</span><span class="st">&quot;Block B&quot;</span>)<span class="op">/</span><span class="dv">4</span></a>
<a class="sourceLine" id="cb48-4" title="4"><span class="kw">stopifnot</span>(NumTreatedB<span class="op">==</span><span class="kw">ceiling</span>(ExpectedNumTreatedB)<span class="op">|</span>NumTreatedB<span class="op">==</span><span class="kw">floor</span>(ExpectedNumTreatedB))</a></code></pre></div>
<p>Our team tries to implement block-randomized assignment whenever possible in
order to increase the statistical power of our experiments. We also often find
it useful in cases where different administrative units are implementing the
treatment, or when we expect different groups of people to have different reactions to the treatment.</p>
<div id="using-only-a-few-covariates-to-create-blocks" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Using only a few covariates to create blocks</h3>
<p>If we have background information on a few covariates, we can create blocks by hand through a process like the one demonstrated here:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" title="1"><span class="co">## For example, make three groups from the cov2 variable</span></a>
<a class="sourceLine" id="cb49-2" title="2">dat1<span class="op">$</span>cov2cat &lt;-<span class="st"> </span><span class="kw">with</span>(dat1,<span class="kw">cut</span>(cov2,<span class="dt">breaks=</span><span class="dv">3</span>))</a>
<a class="sourceLine" id="cb49-3" title="3"><span class="kw">table</span>(dat1<span class="op">$</span>cov2cat,<span class="dt">exclude=</span><span class="kw">c</span>())</a></code></pre></div>
<pre><code>
(-7.32,-2.6]   (-2.6,2.1]   (2.1,6.82] 
          11           68           21 </code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" title="1"><span class="kw">with</span>(dat1,<span class="kw">tapply</span>(cov2,cov2cat,summary))</a></code></pre></div>
<pre><code>$`(-7.32,-2.6]`
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  -7.30   -5.03   -3.66   -4.14   -3.01   -2.77 

$`(-2.6,2.1]`
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-2.3916 -0.7630 -0.0194 -0.0218  0.7592  2.0864 

$`(2.1,6.82]`
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   2.13    2.46    2.95    3.24    3.68    6.80 </code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" title="1"><span class="co">## And we can make blocks that are the same on two covariates</span></a>
<a class="sourceLine" id="cb53-2" title="2">dat1<span class="op">$</span>cov1bin &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(dat1<span class="op">$</span>cov1<span class="op">&gt;</span><span class="kw">median</span>(dat1<span class="op">$</span>cov1)) <span class="co"># Binarize cov1</span></a>
<a class="sourceLine" id="cb53-3" title="3">dat1<span class="op">$</span>blockV2 &lt;-<span class="st"> </span><span class="kw">droplevels</span>(<span class="kw">with</span>(dat1,<span class="kw">interaction</span>(cov1bin,cov2cat)))</a>
<a class="sourceLine" id="cb53-4" title="4"><span class="kw">table</span>(dat1<span class="op">$</span>blockV2,<span class="dt">exclude=</span><span class="kw">c</span>())</a></code></pre></div>
<pre><code>
0.(-7.32,-2.6] 1.(-7.32,-2.6]   0.(-2.6,2.1]   1.(-2.6,2.1]   0.(2.1,6.82]   1.(2.1,6.82] 
             7              4             38             30              5             16 </code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" title="1"><span class="co">## And then assign within these blocks</span></a>
<a class="sourceLine" id="cb55-2" title="2"><span class="kw">set.seed</span>(<span class="dv">12345</span>)</a>
<a class="sourceLine" id="cb55-3" title="3">dat1<span class="op">$</span>ZblockV2 &lt;-<span class="st"> </span><span class="kw">labelTC</span>(<span class="kw">block_ra</span>(<span class="dt">blocks =</span> dat1<span class="op">$</span>blockV2))</a>
<a class="sourceLine" id="cb55-4" title="4"><span class="kw">with</span>(dat1,<span class="kw">table</span>(blockV2,ZblockV2,<span class="dt">exclude=</span><span class="kw">c</span>()))</a></code></pre></div>
<pre><code>                ZblockV2
blockV2           C  T
  0.(-7.32,-2.6]  4  3
  1.(-7.32,-2.6]  2  2
  0.(-2.6,2.1]   19 19
  1.(-2.6,2.1]   15 15
  0.(2.1,6.82]    2  3
  1.(2.1,6.82]    8  8</code></pre>
</div>
<div id="multivariate-blocking-using-many-covariates" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Multivariate blocking using many covariates</h3>
<p>If instead we have many background variables, we can increase precision by thinking about the problem of blocking as one of matching, or creating sets of
units which are as similar as possible overall, across the entire set of covariates <span class="citation">(Moore <a href="#ref-moore2012multivariate">2012</a>; Moore and Schnakenberg <a href="#ref-moore2016bT063">2016</a>)</span>. Here we show two approaches.</p>
<p>Creating pairs:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" title="1"><span class="co">## Using the blockTools package</span></a>
<a class="sourceLine" id="cb57-2" title="2">mvblocks &lt;-<span class="st"> </span><span class="kw">block</span>(dat1,<span class="dt">id.vars=</span><span class="st">&quot;id&quot;</span>,<span class="dt">block.vars=</span><span class="kw">c</span>(<span class="st">&quot;cov1&quot;</span>,<span class="st">&quot;cov2&quot;</span>),<span class="dt">algorithm=</span><span class="st">&quot;optimal&quot;</span>)</a>
<a class="sourceLine" id="cb57-3" title="3">dat1<span class="op">$</span>blocksV3 &lt;-<span class="st"> </span><span class="kw">createBlockIDs</span>(mvblocks,<span class="dt">data=</span>dat1,<span class="dt">id.var =</span> <span class="st">&quot;id&quot;</span>)</a>
<a class="sourceLine" id="cb57-4" title="4">dat1<span class="op">$</span>ZblockV3 &lt;-<span class="st"> </span><span class="kw">labelTC</span>(<span class="kw">block_ra</span>(<span class="dt">blocks =</span> dat1<span class="op">$</span>blocksV3))</a>
<a class="sourceLine" id="cb57-5" title="5"><span class="co">## Just show the first ten pairs</span></a>
<a class="sourceLine" id="cb57-6" title="6"><span class="kw">with</span>(dat1,<span class="kw">table</span>(blocksV3,ZblockV3,<span class="dt">exclude=</span><span class="kw">c</span>()))[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,]</a></code></pre></div>
<pre><code>        ZblockV3
blocksV3 C T
      1  1 1
      2  1 1
      3  1 1
      4  1 1
      5  1 1
      6  1 1
      7  1 1
      8  1 1
      9  1 1
      10 1 1</code></pre>
<p>Creating larger blocks:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" title="1"><span class="co">## Using the quickblock package</span></a>
<a class="sourceLine" id="cb59-2" title="2">distmat &lt;-<span class="st"> </span><span class="kw">distances</span>(dat1,<span class="dt">dist_variables =</span> <span class="kw">c</span>(<span class="st">&quot;cov1bin&quot;</span>, <span class="st">&quot;cov2&quot;</span>),<span class="dt">id_variable =</span> <span class="st">&quot;id&quot;</span>, <span class="dt">normalize=</span><span class="st">&quot;mahalanobiz&quot;</span>)</a>
<a class="sourceLine" id="cb59-3" title="3">distmat[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a></code></pre></div>
<pre><code>       1      2      3       4       5
1 0.0000 1.0697 0.3453 0.14026 0.14827
2 1.0697 0.0000 1.4150 0.92947 0.92146
3 0.3453 1.4150 0.0000 0.48555 0.49356
4 0.1403 0.9295 0.4856 0.00000 0.00801
5 0.1483 0.9215 0.4936 0.00801 0.00000</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" title="1"><span class="kw">quantile</span>(<span class="kw">as.vector</span>(distmat),<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,.<span class="dv">1</span>))</a></code></pre></div>
<pre><code>      0%      10%      20%      30%      40%      50%      60%      70%      80%      90%     100% 
-3.13279 -0.60902 -0.22924 -0.02745  0.09799  0.28989  0.68065  1.23306  1.76838  2.00726  2.91687 </code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" title="1"><span class="co">## The caliper argument helps prevent ill-matched points</span></a>
<a class="sourceLine" id="cb63-2" title="2">mvbigblock &lt;-<span class="st"> </span><span class="kw">quickblock</span>(distmat, <span class="dt">size_constraint =</span> 6L, <span class="dt">caliper =</span> <span class="fl">2.5</span>)</a>
<a class="sourceLine" id="cb63-3" title="3"><span class="co">## Look for missing points</span></a>
<a class="sourceLine" id="cb63-4" title="4"><span class="kw">table</span>(mvbigblock,<span class="dt">exclude=</span><span class="kw">c</span>()) <span class="co"># One point dropped due to caliper</span></a></code></pre></div>
<pre><code>mvbigblock
   0    1    2    3    4    5    6    7    8    9   10   11   12   13 &lt;NA&gt; 
   7    6    6    6    6    6    7    7    8    8    9    7    6   10    1 </code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" title="1">dat1<span class="op">$</span>blocksV4 &lt;-<span class="st"> </span>mvbigblock</a>
<a class="sourceLine" id="cb65-2" title="2">dat1<span class="op">$</span>notblocked &lt;-<span class="st"> </span><span class="kw">is.na</span>(dat1<span class="op">$</span>blocksV4) </a>
<a class="sourceLine" id="cb65-3" title="3">dat1<span class="op">$</span>ZblockV4[dat1<span class="op">$</span>notblocked<span class="op">==</span>F] &lt;-<span class="st"> </span><span class="kw">labelTC</span>(<span class="kw">block_ra</span>(<span class="dt">blocks =</span> dat1<span class="op">$</span>blocksV4))</a>
<a class="sourceLine" id="cb65-4" title="4"><span class="kw">with</span>(dat1,<span class="kw">table</span>(blocksV4,ZblockV4,<span class="dt">exclude=</span><span class="kw">c</span>()))[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,]</a></code></pre></div>
<pre><code>        ZblockV4
blocksV4 C T &lt;NA&gt;
       0 4 3    0
       1 3 3    0
       2 3 3    0
       3 3 3    0
       4 3 3    0
       5 3 3    0
       6 4 3    0
       7 4 3    0
       8 4 4    0
       9 4 4    0</code></pre>
<p>It&#x2019;s worth pausing to examine the differences within blocks. We&#x2019;ll focus on the proportion of people in category &#x201C;1&#x201D; on the binary covariate (notice that the blocks are homogeneous on this covariate), as well as the difference between the largest and smallest value of the continuous covariate. This table also illustrates that, due to our use of a caliper when calling <code>quickblock</code> above, one observation was not included in block random assignment.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" title="1">blockingDescEval &lt;-<span class="st"> </span>dat1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb67-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(blocksV4) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb67-3" title="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cov2diff =</span> <span class="kw">max</span>(<span class="kw">abs</span>(cov2)) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(<span class="kw">abs</span>(cov2)),</a>
<a class="sourceLine" id="cb67-4" title="4">            <span class="dt">cov1 =</span> <span class="kw">mean</span>(cov1bin),</a>
<a class="sourceLine" id="cb67-5" title="5">            <span class="dt">count_in_block =</span> <span class="kw">n</span>())</a>
<a class="sourceLine" id="cb67-6" title="6">blockingDescEval</a></code></pre></div>
<pre><code># A tibble: 15 &#xD7; 4
   blocksV4   cov2diff  cov1 count_in_block
   &lt;qb_blckn&gt;    &lt;dbl&gt; &lt;dbl&gt;          &lt;int&gt;
 1  0            4.54      0              7
 2  1            0.417     0              6
 3  2            3.13      1              6
 4  3            0.251     0              6
 5  4            1.16      1              6
 6  5            0.986     0              6
 7  6            0.537     1              7
 8  7            3.63      0              7
 9  8            0.980     0              8
10  9            0.966     1              8
11 10            0.691     1              9
12 11            0.714     1              7
13 12            0.834     1              6
14 13            0.671     0             10
15 NA            0         1              1</code></pre>
</div>
</div>
<div id="cluster-random-assignment" class="section level2">
<h2><span class="header-section-number">4.5</span> Cluster random assignment</h2>
<p>We often implement a new policy intervention at the level of some group of people &#x2014; like a doctor&#x2019;s practice, or a building, or some other administrative unit. Even though we have 100 units in our example data, imagine now that they are grouped into 10 buildings, and the policy intervention is at the building level. Below, we assign 50 of those units to treatment and 50 to control. Everyone in each building has the same treatment assignment.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" title="1">ndat1 &lt;-<span class="st"> </span><span class="kw">nrow</span>(dat1)</a>
<a class="sourceLine" id="cb69-2" title="2"><span class="co">## Make an indicator for cluster membership</span></a>
<a class="sourceLine" id="cb69-3" title="3">dat1<span class="op">$</span>buildingID &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>(ndat1<span class="op">/</span><span class="dv">10</span>),<span class="dt">length=</span>ndat1)</a>
<a class="sourceLine" id="cb69-4" title="4"><span class="kw">set.seed</span>(<span class="dv">12345</span>)</a>
<a class="sourceLine" id="cb69-5" title="5">dat1<span class="op">$</span>Zcluster &lt;-<span class="st"> </span><span class="kw">labelTC</span>(<span class="kw">cluster_ra</span>(<span class="dt">cluster=</span>dat1<span class="op">$</span>buildingID))</a>
<a class="sourceLine" id="cb69-6" title="6"><span class="kw">with</span>(dat1,<span class="kw">table</span>(Zcluster,buildingID))</a></code></pre></div>
<pre><code>        buildingID
Zcluster  1  2  3  4  5  6  7  8  9 10
       C 10  0 10 10  0  0  0  0 10 10
       T  0 10  0  0 10 10 10 10  0  0</code></pre>
<p>Cluster randomized designs raise new questions about estimation, testing, and statistical power. We describe our approaches to estimation and power
analysis of cluster randomized designs <a href="analysis-choices.html#clusterrandanalysis">in the next chapter</a>.</p>
</div>
<div id="other-designs" class="section level2">
<h2><span class="header-section-number">4.6</span> Other designs</h2>
<p>Our team has also employed stepped-wedge style designs, saturation designs
aimed at discovering whether the effects of the experimental intervention are
communicated across people (via some spillover or network mechanism), and
designs where we try to isolate certain experimental units (like buildings)
from each other so that we can focus our learning about the effects of the
intervention in isolation (rather than the effects when people can communicate with each other about the intervention). In later versions of this document we may include simple descriptions and code for those other, less common designs.</p>
</div>
<div id="assessing-randomization-balance-testing" class="section level2">
<h2><span class="header-section-number">4.7</span> Assessing randomization (balance testing)</h2>
<p>If we have covariates, we can evaluate the implementation of a random assignment procedure by testing the hypothesis that the treatment-vs-control differences in covariates, or differences across treatment arms, are consistent with our intended randomization strategy. Also, in the absence of covariates, we can at least assess whether the number of units assigned to each arm (conditional on other design features, such as blocking or stratification) is consistent with our intended strategy.</p>
<p>We provide an example below with a binary treatment, a continuous outcome, and 10 covariates. In this case we use the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>d</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">d^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> omnibus balance test function <code>xBalance()</code> in the package <code>RItools</code> <span class="citation">(see Hansen and Bowers <a href="#ref-hansen_covariate_2008">2008</a>; Bowers, Fredrickson, and Hansen <a href="#ref-bowers_ritools_2016">2016</a>)</span>.</p>
<p>The overall <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>-value below shows us that this test provides little evidence against the null hypothesis that treatment (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi></mrow><annotation encoding="application/x-tex">Z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span></span></span></span>) really was assigned at random &#x2014; at least in terms of the relationships between treatment assignment and the two covariates. The test statistic here is a summary measure of mean differences across each covariate.</p>
<p>Keep in mind that the overall or &#x201C;omnibus&#x201D; nature of this test is key. If we had many covariates or many observations, it would easy to discover one or a few covariates with individual differences-in-means that differ detectably from zero due to random chance (rather than real implementation problems). That is, in a well-operating experiment, we would expect some baseline imbalances for individual covariates &#x2013; roughly 5 in 100. The value of an omnibus test is that it should not be so easily misled by these chance false positives.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" title="1">randAssessV1 &lt;-<span class="st"> </span><span class="kw">balanceTest</span>(Z<span class="op">~</span>cov1<span class="op">+</span>cov2,<span class="dt">data=</span>dat1)</a>
<a class="sourceLine" id="cb71-2" title="2">randAssessV1<span class="op">$</span>overall[,]</a></code></pre></div>
<pre><code>   chisquare df p.value
--     1.998  2  0.3683</code></pre>
<p>We can also assess the implementation of block-randomized assignment:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" title="1">randAssessV3 &lt;-<span class="st"> </span><span class="kw">balanceTest</span>(ZblockV3<span class="op">~</span>cov1<span class="op">+</span>cov2<span class="op">+</span><span class="kw">strata</span>(blocksV3),<span class="dt">data=</span>dat1)</a>
<a class="sourceLine" id="cb73-2" title="2">randAssessV3<span class="op">$</span>overall[,]</a></code></pre></div>
<pre><code>         chisquare df p.value
blocksV3    2.8342  2  0.2424
--          0.1365  2  0.9340</code></pre>
<p>Lastly, it is possible to assess randomization under both blocked and clustered random assignment using a regression model like the following, where <code>strata(blockID)</code> and <code>cluster(clusterID)</code> refer to block and cluster fixed effects (FEs), respectively.</p>
<p><code>Z ~ cov1 + cov2 + strata(blockID) + cluster(clusterID)</code>.</p>
<p>Again, a test statistic summarizing the estimated differences across covariates would then be used to calculate a p-value. This approach, implemented for instance by the <code>RItools</code> package, works well for experiments that are not overly small. In a very small experiment (with relatively few clusters) we might estimate this same regression model, but we would not compare our test statistic to the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>&#x3C7;</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\chi^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0085em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">&#x3C7;</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> sampling distribution to calculate a p-value. Instead, we would perform a permutation-based test (see the previous chapter).</p>
<p>When possible, we prefer not use <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span>-tests or Likelihood Ratio tests to assess randomization. See <span class="citation">Hansen and Bowers (<a href="#ref-hansen_covariate_2008">2008</a>)</span> for some evidence that a test based on randomization-inference (like the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>d</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">d^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> test developed in that article) maintains appropriate false positive rates better than the sampling- or likelihood-justified <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span> and likelihood ratio tests.</p>
<div id="what-to-do-with-failed-randomization-assessments" class="section level3">
<h3><span class="header-section-number">4.7.1</span> What to do with &#x201C;failed&#x201D; randomization assessments?</h3>
<p>Observing a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>-value of less than .05 in an omnibus test like the one above ought to trigger extra scrutiny about implementation and/or how the data were recorded. For example, we might respond by contacting our agency partner to learn more about how random numbers were generated or the code was used (particularly if we didn&#x2019;t perform the random assignment ourselves). In many cases, this follow-up investigation will indicate that random assignment was implemented correctly, and that our understanding of the design or the data was simply incorrect. Sometimes, the follow-up investigation may not turn up any issues or misunderstandings at all. In those situations, we will tend to assume that our rejection of the null hypothesis of appropriate random assignment was a false positive (consider that we would expect to see about 5 such errors in every 100 experiments).</p>
<p>If our rejection of the null hypothesis appears to be driven by one or more covariates that are substantively important &#x2014; say, the variable <code>age</code> looks very imbalanced between treated and control groups in a health-related randomized trial &#x2014; then we might present both the unadjusted results and a separate set of results that adjust for the covariate(s) in question (e.g., through a stratified difference-in-means estimator, or by using them as controls in a linear regression). Importantly, under a chance rejection of the null (i.e., a false positive) we would not want to treat the adjusted estimate as our primary finding &#x2014; in such a situation, the adjusted estimate would be biased while the unadjusted estimate would not. However, large differences between the adjusted and unadjusted estimates might help us interpret our findings: estimating separate effects within different age groups, for example, might tell us something useful about the particular context of a study and inform the conclusions we draw.</p>
</div>
<div id="minimizing-the-chances-of-failed-randomization" class="section level3">
<h3><span class="header-section-number">4.7.2</span> Minimizing the chances of &#x201C;failed&#x201D; randomization</h3>
<p>Our preference for block-randomization helps us avoid these problems. We can also restrict random assignments in more flexible ways that minimize opportunities for error even more. That said, we prefer not to rely on <strong>re-randomization</strong> &#x2014; one of the other possible restricted randomization options &#x2014; in the interests of minimizing the complexity of our analyses. But since we adopt a randomization-based approach to the analysis of experiments, we can easily (in concept) estimate causal effects under a wide variety of random assignment strategies.</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-randomizr">
<p>Coppock, Alexander. 2022a. <em>Randomizr: Easy-to-Use Tools for Common Forms of Random Assignment and Sampling</em>. <a href="https://CRAN.R-project.org/package=randomizr">https://CRAN.R-project.org/package=randomizr</a>.</p>
</div>
<div id="ref-moore2012multivariate">
<p>Moore, Ryan T. 2012. &#x201C;Multivariate Continuous Blocking to Improve Political Science Experiments.&#x201D; <em>Political Analysis</em> 20 (4): 460&#x2013;79.</p>
</div>
<div id="ref-moore2016bT063">
<p>Moore, Ryan T., and Keith Schnakenberg. 2016. <em>BlockTools: Blocking, Assignment, and Diagnosing Interference in Randomized Experiments</em>. <a href="http://www.ryantmoore.org/html/software.blockTools.html">http://www.ryantmoore.org/html/software.blockTools.html</a>.</p>
</div>
<div id="ref-hansen_covariate_2008">
<p>Hansen, Ben B., and Jake Bowers. 2008. &#x201C;Covariate Balance in Simple, Stratified and Clustered Comparative Studies.&#x201D; <em>Statistical Science</em> 23 (2): 219&#x2013;36.</p>
</div>
<div id="ref-bowers_ritools_2016">
<p>Bowers, Jake, Mark Fredrickson, and Ben Hansen. 2016. <em>RItools: Randomization Inference Tools</em>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="design-based-principles-of-statistical-inference.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="analysis-choices.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/gsa-oes/sop/edit/master/Book/03-randomizeddesigns.Rmd",
"text": "Edit"
},
"download": ["OES_SOP.pdf", "OES_SOP.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
